{"file_contents":{"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/pages/trades.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TradesTable } from \"@/components/trades-table\";\nimport { TrendingUp, TrendingDown, Activity, Target, Clock } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { Trade } from \"@shared/schema\";\n\nexport default function Trades() {\n  const { data: trades = [], isLoading } = useQuery<Trade[]>({\n    queryKey: [\"/api/trades\"],\n  });\n\n  const totalTrades = trades.length;\n  const buyTrades = trades.filter(t => t.type === \"buy\").length;\n  const sellTrades = trades.filter(t => t.type === \"sell\").length;\n  \n  const totalProfit = trades.reduce((sum, t) => {\n    return sum + (t.profitLoss ? parseFloat(t.profitLoss) : 0);\n  }, 0);\n\n  const profitableTrades = trades.filter(t => t.profitLoss && parseFloat(t.profitLoss) > 0).length;\n  const winRate = totalTrades > 0 ? (profitableTrades / totalTrades) * 100 : 0;\n\n  const strategyCounts = trades.reduce((acc, t) => {\n    const strategy = t.strategy || \"MANUAL\";\n    acc[strategy] = (acc[strategy] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const strategyLabels: Record<string, string> = {\n    RSI: \"مؤشر RSI\",\n    MACD: \"MACD\",\n    AI_SENTIMENT: \"تحليل الذكاء الاصطناعي\",\n    MOVING_AVERAGES: \"المتوسطات المتحركة\",\n    MANUAL: \"يدوي\",\n  };\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">التداولات</h1>\n          <p className=\"text-muted-foreground text-sm\">سجل جميع عمليات التداول الآلي</p>\n        </div>\n        <Badge variant=\"outline\" className=\"text-sm\">\n          <Clock className=\"w-3 h-3 ml-1\" />\n          آخر تحديث: الآن\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n        <Card data-testid=\"card-total-trades\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-md bg-primary/10\">\n                <Activity className=\"w-4 h-4 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">إجمالي التداولات</p>\n                <p className=\"text-lg font-bold\">{totalTrades}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-buy-trades\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-md bg-success/10\">\n                <TrendingUp className=\"w-4 h-4 text-success\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">عمليات الشراء</p>\n                <p className=\"text-lg font-bold\">{buyTrades}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-sell-trades\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-md bg-destructive/10\">\n                <TrendingDown className=\"w-4 h-4 text-destructive\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">عمليات البيع</p>\n                <p className=\"text-lg font-bold\">{sellTrades}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-profit\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className={cn(\n                \"p-2 rounded-md\",\n                totalProfit >= 0 ? \"bg-success/10\" : \"bg-destructive/10\"\n              )}>\n                {totalProfit >= 0 ? (\n                  <TrendingUp className=\"w-4 h-4 text-success\" />\n                ) : (\n                  <TrendingDown className=\"w-4 h-4 text-destructive\" />\n                )}\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">إجمالي الربح</p>\n                <p className={cn(\n                  \"text-lg font-bold\",\n                  totalProfit >= 0 ? \"text-success\" : \"text-destructive\"\n                )} dir=\"ltr\">\n                  {totalProfit >= 0 && \"+\"}{formatCurrency(totalProfit)}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-win-rate\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-md bg-primary/10\">\n                <Target className=\"w-4 h-4 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">نسبة النجاح</p>\n                <p className=\"text-lg font-bold\" dir=\"ltr\">{winRate.toFixed(1)}%</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        <div className=\"lg:col-span-3\">\n          <TradesTable trades={trades} isLoading={isLoading} showAll />\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-strategies\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">الاستراتيجيات المستخدمة</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {Object.keys(strategyCounts).length === 0 ? (\n                <p className=\"text-muted-foreground text-sm text-center py-4\">\n                  لا توجد بيانات\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {Object.entries(strategyCounts).map(([strategy, count]) => {\n                    const percentage = (count / totalTrades) * 100;\n                    return (\n                      <div key={strategy}>\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <span className=\"text-sm\">{strategyLabels[strategy] || strategy}</span>\n                          <span className=\"text-sm text-muted-foreground\">{count}</span>\n                        </div>\n                        <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className=\"h-full bg-primary rounded-full transition-all\"\n                            style={{ width: `${percentage}%` }}\n                          />\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-pairs\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">أزواج التداول</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {trades.length === 0 ? (\n                <p className=\"text-muted-foreground text-sm text-center py-4\">\n                  لا توجد بيانات\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {Array.from(new Set(trades.map(t => t.pair))).map(pair => {\n                    const pairTrades = trades.filter(t => t.pair === pair);\n                    const pairProfit = pairTrades.reduce((sum, t) => \n                      sum + (t.profitLoss ? parseFloat(t.profitLoss) : 0), 0);\n                    \n                    return (\n                      <div \n                        key={pair} \n                        className=\"flex items-center justify-between p-2 bg-muted/50 rounded-md\"\n                      >\n                        <span className=\"font-medium text-sm\" dir=\"ltr\">{pair}</span>\n                        <div className=\"text-left\">\n                          <p className=\"text-xs text-muted-foreground\">{pairTrades.length} تداول</p>\n                          <p className={cn(\n                            \"text-sm font-medium\",\n                            pairProfit >= 0 ? \"text-success\" : \"text-destructive\"\n                          )} dir=\"ltr\">\n                            {pairProfit >= 0 && \"+\"}{formatCurrency(pairProfit)}\n                          </p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9002,"size_tokens":null},"client/src/components/bot-status.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Bot, ShieldCheck, TrendingUp, Brain, Activity } from \"lucide-react\";\nimport type { BotSettings } from \"@shared/schema\";\n\ninterface BotStatusProps {\n  settings: BotSettings | null;\n  isLoading?: boolean;\n  onToggle?: (active: boolean) => void;\n}\n\nexport function BotStatus({ settings, isLoading, onToggle }: BotStatusProps) {\n  const isActive = settings?.isActive ?? false;\n\n  const strategies = [\n    { key: \"useRsi\", label: \"RSI\", icon: Activity, enabled: settings?.useRsi },\n    { key: \"useMacd\", label: \"MACD\", icon: TrendingUp, enabled: settings?.useMacd },\n    { key: \"useMovingAverages\", label: \"MA\", icon: Activity, enabled: settings?.useMovingAverages },\n    { key: \"useAiSentiment\", label: \"AI\", icon: Brain, enabled: settings?.useAiSentiment },\n  ];\n\n  return (\n    <Card data-testid=\"card-bot-status\">\n      <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Bot className=\"w-5 h-5 text-primary\" />\n          <CardTitle className=\"text-lg\">حالة البوت</CardTitle>\n        </div>\n        <Badge \n          variant={isActive ? \"default\" : \"secondary\"}\n          className={isActive ? \"bg-success text-success-foreground\" : \"\"}\n        >\n          {isActive ? \"نشط\" : \"متوقف\"}\n        </Badge>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-4 animate-pulse\">\n            <div className=\"h-10 bg-muted rounded\" />\n            <div className=\"h-20 bg-muted rounded\" />\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <div className={`w-2 h-2 rounded-full ${isActive ? \"bg-success animate-pulse\" : \"bg-muted-foreground\"}`} />\n                <span className=\"text-sm font-medium\">تفعيل التداول الآلي</span>\n              </div>\n              <Switch\n                checked={isActive}\n                onCheckedChange={onToggle}\n                data-testid=\"switch-bot-active\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-2\">\n              {strategies.map((strategy) => {\n                const StrategyIcon = strategy.icon;\n                return (\n                  <div\n                    key={strategy.key}\n                    className={`flex items-center gap-2 p-2 rounded-md text-sm ${\n                      strategy.enabled ? \"bg-primary/10 text-foreground\" : \"bg-muted text-muted-foreground\"\n                    }`}\n                  >\n                    <StrategyIcon className=\"w-4 h-4\" />\n                    <span>{strategy.label}</span>\n                    {strategy.enabled && <span className=\"w-1.5 h-1.5 bg-success rounded-full mr-auto\" />}\n                  </div>\n                );\n              })}\n            </div>\n\n            <div className=\"pt-2 border-t border-border\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-2\">\n                <ShieldCheck className=\"w-4 h-4\" />\n                <span>إعدادات المخاطر</span>\n              </div>\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">وقف الخسارة:</span>\n                  <span className=\"font-medium\" dir=\"ltr\">{settings?.stopLossPercent || \"3\"}%</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">جني الأرباح:</span>\n                  <span className=\"font-medium\" dir=\"ltr\">{settings?.takeProfitPercent || \"10\"}%</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">الحد الأقصى:</span>\n                  <span className=\"font-medium\" dir=\"ltr\">${settings?.maxPositionSize || \"1000\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">نسبة المخاطرة:</span>\n                  <span className=\"font-medium\" dir=\"ltr\">{settings?.maxRiskPercent || \"5\"}%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4654,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 210 5% 98%;\n  --foreground: 210 6% 12%;\n  --border: 210 5% 91%;\n  --card: 210 5% 96%;\n  --card-foreground: 210 6% 14%;\n  --card-border: 210 5% 94%;\n  --sidebar: 210 5% 94%;\n  --sidebar-foreground: 210 6% 16%;\n  --sidebar-border: 210 5% 90%;\n  --sidebar-primary: 217 91% 35%;\n  --sidebar-primary-foreground: 217 91% 97%;\n  --sidebar-accent: 210 8% 88%;\n  --sidebar-accent-foreground: 210 6% 18%;\n  --sidebar-ring: 217 91% 35%;\n  --popover: 210 5% 92%;\n  --popover-foreground: 210 6% 18%;\n  --popover-border: 210 5% 88%;\n  --primary: 217 91% 35%;\n  --primary-foreground: 217 91% 97%;\n  --secondary: 210 8% 86%;\n  --secondary-foreground: 210 6% 20%;\n  --muted: 210 10% 90%;\n  --muted-foreground: 210 6% 35%;\n  --accent: 210 12% 92%;\n  --accent-foreground: 210 6% 18%;\n  --destructive: 0 84% 32%;\n  --destructive-foreground: 0 84% 97%;\n  --input: 210 6% 75%;\n  --ring: 217 91% 35%;\n  --chart-1: 217 91% 35%;\n  --chart-2: 142 76% 28%;\n  --chart-3: 262 83% 32%;\n  --chart-4: 32 95% 35%;\n  --chart-5: 340 82% 33%;\n  --font-sans: Cairo, Tajawal, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --success: 142 76% 36%;\n  --success-foreground: 142 76% 97%;\n  --warning: 32 95% 44%;\n  --warning-foreground: 32 95% 97%;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 5% 50% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 5% 50% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 5% 50% / 0.00), 0px 1px 2px -1px hsl(210 5% 50% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 5% 50% / 0.00), 0px 1px 2px -1px hsl(210 5% 50% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 5% 50% / 0.00), 0px 2px 4px -1px hsl(210 5% 50% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 5% 50% / 0.00), 0px 4px 6px -1px hsl(210 5% 50% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 5% 50% / 0.00), 0px 8px 10px -1px hsl(210 5% 50% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 5% 50% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 210 6% 8%;\n  --foreground: 210 5% 96%;\n  --border: 210 6% 16%;\n  --card: 210 6% 10%;\n  --card-foreground: 210 5% 94%;\n  --card-border: 210 6% 13%;\n  --sidebar: 210 6% 12%;\n  --sidebar-foreground: 210 5% 92%;\n  --sidebar-border: 210 6% 15%;\n  --sidebar-primary: 217 91% 50%;\n  --sidebar-primary-foreground: 217 91% 97%;\n  --sidebar-accent: 210 8% 18%;\n  --sidebar-accent-foreground: 210 5% 90%;\n  --sidebar-ring: 217 91% 50%;\n  --popover: 210 6% 14%;\n  --popover-foreground: 210 5% 90%;\n  --popover-border: 210 6% 18%;\n  --primary: 217 91% 50%;\n  --primary-foreground: 217 91% 97%;\n  --secondary: 210 8% 20%;\n  --secondary-foreground: 210 5% 88%;\n  --muted: 210 10% 16%;\n  --muted-foreground: 210 5% 65%;\n  --accent: 210 12% 15%;\n  --accent-foreground: 210 5% 90%;\n  --destructive: 0 84% 32%;\n  --destructive-foreground: 0 84% 97%;\n  --input: 210 6% 30%;\n  --ring: 217 91% 50%;\n  --chart-1: 217 91% 65%;\n  --chart-2: 142 76% 55%;\n  --chart-3: 262 83% 65%;\n  --chart-4: 32 95% 60%;\n  --chart-5: 340 82% 60%;\n  --success: 142 76% 45%;\n  --success-foreground: 142 76% 97%;\n  --warning: 32 95% 50%;\n  --warning-foreground: 32 95% 97%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 6% 5% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 6% 5% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 6% 5% / 0.00), 0px 1px 2px -1px hsl(210 6% 5% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 6% 5% / 0.00), 0px 1px 2px -1px hsl(210 6% 5% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 6% 5% / 0.00), 0px 2px 4px -1px hsl(210 6% 5% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 6% 5% / 0.00), 0px 4px 6px -1px hsl(210 6% 5% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 6% 5% / 0.00), 0px 8px 10px -1px hsl(210 6% 5% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 6% 5% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10952,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { StatsCard } from \"@/components/stats-card\";\nimport { PortfolioChart } from \"@/components/portfolio-chart\";\nimport { TradesTable } from \"@/components/trades-table\";\nimport { MarketTicker } from \"@/components/market-ticker\";\nimport { SentimentCard } from \"@/components/sentiment-card\";\nimport { BotStatus } from \"@/components/bot-status\";\nimport { UserPortfolio } from \"@/components/user-portfolio\";\nimport { Wallet, TrendingUp, PieChart, Activity } from \"lucide-react\";\nimport type { \n  PortfolioHistory, \n  Trade, \n  MarketData, \n  Sentiment, \n  BotSettings,\n  UserShares \n} from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const { data: portfolioHistory = [], isLoading: loadingHistory } = useQuery<PortfolioHistory[]>({\n    queryKey: [\"/api/portfolio/history\"],\n  });\n\n  const { data: trades = [], isLoading: loadingTrades } = useQuery<Trade[]>({\n    queryKey: [\"/api/trades\"],\n  });\n\n  const { data: marketData = [], isLoading: loadingMarket } = useQuery<MarketData[]>({\n    queryKey: [\"/api/market\"],\n  });\n\n  const { data: sentiments = [], isLoading: loadingSentiment } = useQuery<Sentiment[]>({\n    queryKey: [\"/api/sentiment\"],\n  });\n\n  const { data: botSettings, isLoading: loadingBot } = useQuery<BotSettings>({\n    queryKey: [\"/api/bot/settings\"],\n  });\n\n  const { data: userShares, isLoading: loadingShares } = useQuery<UserShares>({\n    queryKey: [\"/api/user/shares\"],\n  });\n\n  const { data: poolStats } = useQuery<{ totalValue: number; totalShares: number; pricePerShare: number }>({\n    queryKey: [\"/api/pool/stats\"],\n  });\n\n  const latestHistory = portfolioHistory[0];\n  const totalValue = latestHistory?.totalValue ? parseFloat(latestHistory.totalValue) : 0;\n  const dailyChange = latestHistory?.dailyChangePercent ? parseFloat(latestHistory.dailyChangePercent) : 0;\n  const pricePerShare = latestHistory?.pricePerShare ? parseFloat(latestHistory.pricePerShare) : 1;\n  const totalShares = latestHistory?.totalShares ? parseFloat(latestHistory.totalShares) : 0;\n\n  const todayProfit = trades\n    .filter(t => {\n      const today = new Date();\n      const tradeDate = t.createdAt ? new Date(t.createdAt) : null;\n      return tradeDate && \n        tradeDate.getDate() === today.getDate() &&\n        tradeDate.getMonth() === today.getMonth() &&\n        tradeDate.getFullYear() === today.getFullYear();\n    })\n    .reduce((sum, t) => sum + (t.profitLoss ? parseFloat(t.profitLoss) : 0), 0);\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">لوحة التحكم</h1>\n          <p className=\"text-muted-foreground text-sm\">نظرة عامة على أداء المحفظة</p>\n        </div>\n      </div>\n\n      <MarketTicker marketData={marketData} isLoading={loadingMarket} />\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatsCard\n          title=\"إجمالي المحفظة\"\n          value={formatCurrency(totalValue)}\n          change={dailyChange}\n          changeLabel=\"24س\"\n          icon={Wallet}\n          testId=\"stats-total-value\"\n        />\n        <StatsCard\n          title=\"أرباح اليوم\"\n          value={formatCurrency(todayProfit)}\n          change={totalValue > 0 ? (todayProfit / totalValue) * 100 : 0}\n          icon={TrendingUp}\n          iconColor=\"text-success\"\n          testId=\"stats-today-profit\"\n        />\n        <StatsCard\n          title=\"سعر الحصة\"\n          value={`$${pricePerShare.toFixed(4)}`}\n          icon={PieChart}\n          testId=\"stats-share-price\"\n        />\n        <StatsCard\n          title=\"إجمالي الحصص\"\n          value={totalShares.toLocaleString(\"en-US\", { maximumFractionDigits: 2 })}\n          icon={Activity}\n          testId=\"stats-total-shares\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <PortfolioChart data={portfolioHistory} isLoading={loadingHistory} />\n          <TradesTable trades={trades} isLoading={loadingTrades} />\n        </div>\n        \n        <div className=\"space-y-6\">\n          <UserPortfolio \n            shares={userShares || null} \n            isLoading={loadingShares}\n            totalPoolValue={poolStats?.totalValue}\n          />\n          <BotStatus settings={botSettings || null} isLoading={loadingBot} />\n          <SentimentCard sentiments={sentiments} isLoading={loadingSentiment} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4810,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/user-portfolio.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Wallet, ArrowUpCircle, ArrowDownCircle, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { UserShares } from \"@shared/schema\";\n\ninterface UserPortfolioProps {\n  shares: UserShares | null;\n  isLoading?: boolean;\n  totalPoolValue?: number;\n}\n\nexport function UserPortfolio({ shares, isLoading, totalPoolValue = 0 }: UserPortfolioProps) {\n  const totalDeposited = shares?.totalDeposited ? parseFloat(shares.totalDeposited) : 0;\n  const currentValue = shares?.currentValue ? parseFloat(shares.currentValue) : 0;\n  const profitLoss = shares?.profitLoss ? parseFloat(shares.profitLoss) : 0;\n  const profitLossPercent = shares?.profitLossPercent ? parseFloat(shares.profitLossPercent) : 0;\n  const userShares = shares?.totalShares ? parseFloat(shares.totalShares) : 0;\n\n  const poolPercentage = totalPoolValue > 0 ? (currentValue / totalPoolValue) * 100 : 0;\n  const isProfit = profitLoss > 0;\n  const isLoss = profitLoss < 0;\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  return (\n    <Card data-testid=\"card-user-portfolio\">\n      <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n        <Wallet className=\"w-5 h-5 text-primary\" />\n        <CardTitle className=\"text-lg\">محفظتي</CardTitle>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-4 animate-pulse\">\n            <div className=\"h-16 bg-muted rounded\" />\n            <div className=\"h-24 bg-muted rounded\" />\n            <div className=\"h-10 bg-muted rounded\" />\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            <div className=\"text-center py-4 bg-muted rounded-md\">\n              <p className=\"text-sm text-muted-foreground mb-1\">القيمة الحالية</p>\n              <p className=\"text-3xl font-bold\" dir=\"ltr\">{formatCurrency(currentValue)}</p>\n              <div className={cn(\n                \"flex items-center justify-center gap-1 mt-2\",\n                isProfit && \"text-success\",\n                isLoss && \"text-destructive\"\n              )}>\n                {isProfit && <TrendingUp className=\"w-4 h-4\" />}\n                {isLoss && <TrendingDown className=\"w-4 h-4\" />}\n                <span dir=\"ltr\">\n                  {isProfit && \"+\"}\n                  {formatCurrency(profitLoss)} ({profitLossPercent.toFixed(2)}%)\n                </span>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">المبلغ المودع</span>\n                <span className=\"font-medium\" dir=\"ltr\">{formatCurrency(totalDeposited)}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">عدد الحصص</span>\n                <span className=\"font-medium\" dir=\"ltr\">{userShares.toFixed(4)}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">نسبتك من المحفظة</span>\n                <span className=\"font-medium\" dir=\"ltr\">{poolPercentage.toFixed(2)}%</span>\n              </div>\n              <Progress value={poolPercentage} className=\"h-2\" />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-3 pt-2\">\n              <Button className=\"gap-2\" data-testid=\"button-deposit\">\n                <ArrowUpCircle className=\"w-4 h-4\" />\n                إيداع\n              </Button>\n              <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-withdraw\">\n                <ArrowDownCircle className=\"w-4 h-4\" />\n                سحب\n              </Button>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4171,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/pages/ai-analysis.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Bot, \n  TrendingUp, \n  TrendingDown, \n  Minus, \n  RefreshCw, \n  Brain,\n  AlertCircle,\n  Clock\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { Sentiment } from \"@shared/schema\";\n\nconst sentimentConfig = {\n  bullish: {\n    label: \"صاعد\",\n    labelEn: \"Bullish\",\n    color: \"text-success\",\n    bgColor: \"bg-success/10\",\n    borderColor: \"border-success/30\",\n    icon: TrendingUp,\n  },\n  bearish: {\n    label: \"هابط\",\n    labelEn: \"Bearish\",\n    color: \"text-destructive\",\n    bgColor: \"bg-destructive/10\",\n    borderColor: \"border-destructive/30\",\n    icon: TrendingDown,\n  },\n  neutral: {\n    label: \"محايد\",\n    labelEn: \"Neutral\",\n    color: \"text-muted-foreground\",\n    bgColor: \"bg-muted\",\n    borderColor: \"border-border\",\n    icon: Minus,\n  },\n};\n\nexport default function AiAnalysis() {\n  const { data: sentiments = [], isLoading, refetch, isFetching } = useQuery<Sentiment[]>({\n    queryKey: [\"/api/sentiment\"],\n  });\n\n  const bullishCount = sentiments.filter(s => s.sentiment === \"bullish\").length;\n  const bearishCount = sentiments.filter(s => s.sentiment === \"bearish\").length;\n  const neutralCount = sentiments.filter(s => s.sentiment === \"neutral\").length;\n  \n  const avgScore = sentiments.length > 0 \n    ? sentiments.reduce((sum, s) => sum + parseFloat(s.score), 0) / sentiments.length \n    : 0;\n\n  const avgConfidence = sentiments.length > 0\n    ? sentiments.reduce((sum, s) => sum + (s.confidence ? parseFloat(s.confidence) : 0), 0) / sentiments.length\n    : 0;\n\n  const overallSentiment = avgScore > 20 ? \"bullish\" : avgScore < -20 ? \"bearish\" : \"neutral\";\n  const overallConfig = sentimentConfig[overallSentiment];\n  const OverallIcon = overallConfig.icon;\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">تحليل الذكاء الاصطناعي</h1>\n          <p className=\"text-muted-foreground text-sm\">تحليل المشاعر وتوقعات السوق</p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Badge variant=\"outline\" className=\"text-sm\">\n            <Brain className=\"w-3 h-3 ml-1\" />\n            مدعوم بـ OpenAI\n          </Badge>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => refetch()}\n            disabled={isFetching}\n            data-testid=\"button-refresh-analysis\"\n          >\n            <RefreshCw className={cn(\"w-4 h-4\", isFetching && \"animate-spin\")} />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card className={cn(\"border-2\", overallConfig.borderColor)} data-testid=\"card-overall-sentiment\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className={cn(\"p-3 rounded-md\", overallConfig.bgColor)}>\n                <OverallIcon className={cn(\"w-6 h-6\", overallConfig.color)} />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">الاتجاه العام</p>\n                <p className={cn(\"text-xl font-bold\", overallConfig.color)}>\n                  {overallConfig.label}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-muted-foreground\">درجة الثقة</span>\n              <span className=\"font-medium\" dir=\"ltr\">{avgConfidence.toFixed(0)}%</span>\n            </div>\n            <Progress value={avgConfidence} className=\"h-1.5 mt-2\" />\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-bullish-count\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-success/10\">\n                <TrendingUp className=\"w-5 h-5 text-success\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إشارات صاعدة</p>\n                <p className=\"text-2xl font-bold text-success\">{bullishCount}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-bearish-count\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-destructive/10\">\n                <TrendingDown className=\"w-5 h-5 text-destructive\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إشارات هابطة</p>\n                <p className=\"text-2xl font-bold text-destructive\">{bearishCount}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-neutral-count\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-muted\">\n                <Minus className=\"w-5 h-5 text-muted-foreground\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إشارات محايدة</p>\n                <p className=\"text-2xl font-bold\">{neutralCount}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card data-testid=\"card-sentiment-details\">\n        <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n          <Bot className=\"w-5 h-5 text-primary\" />\n          <CardTitle className=\"text-lg\">تفاصيل التحليل</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3, 4].map((i) => (\n                <div key={i} className=\"animate-pulse p-4 bg-muted rounded-md\">\n                  <div className=\"h-4 bg-muted-foreground/20 rounded w-24 mb-3\" />\n                  <div className=\"h-2 bg-muted-foreground/20 rounded w-full mb-2\" />\n                  <div className=\"h-3 bg-muted-foreground/20 rounded w-3/4\" />\n                </div>\n              ))}\n            </div>\n          ) : sentiments.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <AlertCircle className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50\" />\n              <p className=\"text-muted-foreground mb-2\">لا يوجد تحليل متاح حالياً</p>\n              <p className=\"text-xs text-muted-foreground\">سيتم تحديث التحليل تلقائياً</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {sentiments.map((sentiment) => {\n                const config = sentimentConfig[sentiment.sentiment as keyof typeof sentimentConfig] || sentimentConfig.neutral;\n                const score = parseFloat(sentiment.score);\n                const normalizedScore = ((score + 100) / 200) * 100;\n                const confidence = sentiment.confidence ? parseFloat(sentiment.confidence) : 0;\n                const SentimentIcon = config.icon;\n\n                return (\n                  <div\n                    key={sentiment.id}\n                    className={cn(\"p-4 rounded-md border\", config.bgColor, config.borderColor)}\n                    data-testid={`analysis-${sentiment.symbol}`}\n                  >\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-bold text-lg\" dir=\"ltr\">{sentiment.symbol}</span>\n                        <Badge variant=\"outline\" className={cn(\"text-xs\", config.color)}>\n                          <SentimentIcon className=\"w-3 h-3 ml-1\" />\n                          {config.label}\n                        </Badge>\n                      </div>\n                      <span className={cn(\"text-xl font-bold\", config.color)} dir=\"ltr\">\n                        {score > 0 && \"+\"}{score.toFixed(0)}\n                      </span>\n                    </div>\n\n                    <div className=\"mb-3\">\n                      <div className=\"flex items-center justify-between text-xs text-muted-foreground mb-1\">\n                        <span>مؤشر المشاعر</span>\n                        <span dir=\"ltr\">{score.toFixed(0)} / 100</span>\n                      </div>\n                      <div className=\"h-2 bg-background rounded-full overflow-hidden\">\n                        <div \n                          className={cn(\"h-full rounded-full transition-all\", \n                            score > 0 ? \"bg-success\" : score < 0 ? \"bg-destructive\" : \"bg-muted-foreground\"\n                          )}\n                          style={{ width: `${normalizedScore}%` }}\n                        />\n                      </div>\n                    </div>\n\n                    {sentiment.summary && (\n                      <p className=\"text-sm text-muted-foreground mb-3 line-clamp-3\">\n                        {sentiment.summary}\n                      </p>\n                    )}\n\n                    <div className=\"flex items-center justify-between text-xs text-muted-foreground pt-2 border-t border-border/50\">\n                      <div className=\"flex items-center gap-1\">\n                        <Brain className=\"w-3 h-3\" />\n                        <span>ثقة: {confidence.toFixed(0)}%</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Clock className=\"w-3 h-3\" />\n                        <span>\n                          {sentiment.createdAt && new Date(sentiment.createdAt).toLocaleString(\"ar-SA\", {\n                            month: \"short\",\n                            day: \"numeric\",\n                            hour: \"2-digit\",\n                            minute: \"2-digit\",\n                          })}\n                        </span>\n                      </div>\n                    </div>\n\n                    {sentiment.newsSource && (\n                      <div className=\"mt-2 pt-2 border-t border-border/50\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          المصدر: {sentiment.newsSource}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10863,"size_tokens":null},"client/src/pages/stats.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  AreaChart,\n  Area,\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  CartesianGrid,\n  Legend,\n} from \"recharts\";\nimport { \n  TrendingUp, \n  TrendingDown, \n  Activity, \n  Target, \n  Calendar,\n  PieChart,\n  BarChart3\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { PortfolioHistory, Trade } from \"@shared/schema\";\n\nexport default function Stats() {\n  const { data: portfolioHistory = [], isLoading: loadingHistory } = useQuery<PortfolioHistory[]>({\n    queryKey: [\"/api/portfolio/history\"],\n  });\n\n  const { data: trades = [], isLoading: loadingTrades } = useQuery<Trade[]>({\n    queryKey: [\"/api/trades\"],\n  });\n\n  const totalTrades = trades.length;\n  const profitableTrades = trades.filter(t => t.profitLoss && parseFloat(t.profitLoss) > 0).length;\n  const losingTrades = trades.filter(t => t.profitLoss && parseFloat(t.profitLoss) < 0).length;\n  const winRate = totalTrades > 0 ? (profitableTrades / totalTrades) * 100 : 0;\n\n  const totalProfit = trades.reduce((sum, t) => {\n    const pl = t.profitLoss ? parseFloat(t.profitLoss) : 0;\n    return pl > 0 ? sum + pl : sum;\n  }, 0);\n\n  const totalLoss = trades.reduce((sum, t) => {\n    const pl = t.profitLoss ? parseFloat(t.profitLoss) : 0;\n    return pl < 0 ? sum + Math.abs(pl) : sum;\n  }, 0);\n\n  const profitFactor = totalLoss > 0 ? totalProfit / totalLoss : totalProfit > 0 ? Infinity : 0;\n\n  const avgProfit = profitableTrades > 0 ? totalProfit / profitableTrades : 0;\n  const avgLoss = losingTrades > 0 ? totalLoss / losingTrades : 0;\n\n  const portfolioChartData = portfolioHistory.slice().reverse().map((item) => ({\n    date: new Date(item.recordedAt!).toLocaleDateString(\"ar-SA\", {\n      month: \"short\",\n      day: \"numeric\",\n    }),\n    value: parseFloat(item.totalValue),\n    change: parseFloat(item.dailyChangePercent || \"0\"),\n  }));\n\n  const tradesByDay = trades.reduce((acc, trade) => {\n    if (!trade.createdAt) return acc;\n    const date = new Date(trade.createdAt).toLocaleDateString(\"ar-SA\", {\n      month: \"short\",\n      day: \"numeric\",\n    });\n    if (!acc[date]) {\n      acc[date] = { date, profit: 0, loss: 0, count: 0 };\n    }\n    const pl = trade.profitLoss ? parseFloat(trade.profitLoss) : 0;\n    if (pl > 0) {\n      acc[date].profit += pl;\n    } else {\n      acc[date].loss += Math.abs(pl);\n    }\n    acc[date].count += 1;\n    return acc;\n  }, {} as Record<string, { date: string; profit: number; loss: number; count: number }>);\n\n  const dailyPnLData = Object.values(tradesByDay).slice(-14);\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-popover border border-popover-border rounded-md p-3 shadow-lg\">\n          <p className=\"text-sm text-muted-foreground mb-1\">{label}</p>\n          {payload.map((p: any, i: number) => (\n            <p key={i} className=\"text-sm font-medium\" style={{ color: p.color }}>\n              {p.name}: {typeof p.value === \"number\" ? formatCurrency(p.value) : p.value}\n            </p>\n          ))}\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">الإحصائيات</h1>\n          <p className=\"text-muted-foreground text-sm\">تحليل الأداء والمقاييس المتقدمة</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card data-testid=\"card-win-rate\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-primary/10\">\n                <Target className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">نسبة النجاح</p>\n                <p className=\"text-2xl font-bold\" dir=\"ltr\">{winRate.toFixed(1)}%</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-profit-factor\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-success/10\">\n                <PieChart className=\"w-5 h-5 text-success\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">معامل الربح</p>\n                <p className=\"text-2xl font-bold text-success\" dir=\"ltr\">\n                  {profitFactor === Infinity ? \"∞\" : profitFactor.toFixed(2)}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-avg-profit\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-success/10\">\n                <TrendingUp className=\"w-5 h-5 text-success\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">متوسط الربح</p>\n                <p className=\"text-2xl font-bold text-success\" dir=\"ltr\">{formatCurrency(avgProfit)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-avg-loss\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-destructive/10\">\n                <TrendingDown className=\"w-5 h-5 text-destructive\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">متوسط الخسارة</p>\n                <p className=\"text-2xl font-bold text-destructive\" dir=\"ltr\">{formatCurrency(avgLoss)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-portfolio-growth\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <Activity className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">نمو المحفظة</CardTitle>\n          </CardHeader>\n          <CardContent className=\"h-[300px]\">\n            {loadingHistory ? (\n              <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                جاري التحميل...\n              </div>\n            ) : portfolioChartData.length === 0 ? (\n              <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                لا توجد بيانات\n              </div>\n            ) : (\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={portfolioChartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                  <defs>\n                    <linearGradient id=\"colorGrowth\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3} />\n                      <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n                  <XAxis dataKey=\"date\" tick={{ fontSize: 12 }} tickLine={false} axisLine={false} />\n                  <YAxis \n                    tick={{ fontSize: 12 }} \n                    tickLine={false} \n                    axisLine={false}\n                    tickFormatter={(v) => `$${v.toLocaleString()}`}\n                  />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Area\n                    name=\"القيمة\"\n                    type=\"monotone\"\n                    dataKey=\"value\"\n                    stroke=\"hsl(var(--primary))\"\n                    strokeWidth={2}\n                    fill=\"url(#colorGrowth)\"\n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-daily-pnl\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <BarChart3 className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">الأرباح والخسائر اليومية</CardTitle>\n          </CardHeader>\n          <CardContent className=\"h-[300px]\">\n            {loadingTrades ? (\n              <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                جاري التحميل...\n              </div>\n            ) : dailyPnLData.length === 0 ? (\n              <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                لا توجد بيانات\n              </div>\n            ) : (\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={dailyPnLData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n                  <XAxis dataKey=\"date\" tick={{ fontSize: 12 }} tickLine={false} axisLine={false} />\n                  <YAxis \n                    tick={{ fontSize: 12 }} \n                    tickLine={false} \n                    axisLine={false}\n                    tickFormatter={(v) => `$${v}`}\n                  />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Legend />\n                  <Bar name=\"الأرباح\" dataKey=\"profit\" fill=\"hsl(var(--success))\" radius={[4, 4, 0, 0]} />\n                  <Bar name=\"الخسائر\" dataKey=\"loss\" fill=\"hsl(var(--destructive))\" radius={[4, 4, 0, 0]} />\n                </BarChart>\n              </ResponsiveContainer>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card data-testid=\"card-trade-summary\">\n          <CardHeader className=\"pb-4\">\n            <CardTitle className=\"text-lg\">ملخص التداولات</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-muted-foreground\">إجمالي التداولات</span>\n                <span className=\"font-bold\">{totalTrades}</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-muted-foreground\">التداولات الرابحة</span>\n                <span className=\"font-bold text-success\">{profitableTrades}</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-muted-foreground\">التداولات الخاسرة</span>\n                <span className=\"font-bold text-destructive\">{losingTrades}</span>\n              </div>\n              <div className=\"pt-4 border-t border-border\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-muted-foreground\">إجمالي الأرباح</span>\n                  <span className=\"font-bold text-success\" dir=\"ltr\">+{formatCurrency(totalProfit)}</span>\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-muted-foreground\">إجمالي الخسائر</span>\n                <span className=\"font-bold text-destructive\" dir=\"ltr\">-{formatCurrency(totalLoss)}</span>\n              </div>\n              <div className=\"flex items-center justify-between pt-4 border-t border-border\">\n                <span className=\"font-medium\">صافي الربح</span>\n                <span className={cn(\n                  \"font-bold text-lg\",\n                  totalProfit - totalLoss >= 0 ? \"text-success\" : \"text-destructive\"\n                )} dir=\"ltr\">\n                  {totalProfit - totalLoss >= 0 && \"+\"}{formatCurrency(totalProfit - totalLoss)}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\" data-testid=\"card-monthly-performance\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <Calendar className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">الأداء الشهري</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {portfolioHistory.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                لا توجد بيانات كافية\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3\">\n                {Array.from({ length: 6 }, (_, i) => {\n                  const month = new Date();\n                  month.setMonth(month.getMonth() - (5 - i));\n                  const monthName = month.toLocaleDateString(\"ar-SA\", { month: \"short\" });\n                  const monthData = portfolioHistory.filter(p => {\n                    const d = new Date(p.recordedAt!);\n                    return d.getMonth() === month.getMonth() && d.getFullYear() === month.getFullYear();\n                  });\n                  const change = monthData.length > 0 \n                    ? monthData.reduce((sum, p) => sum + parseFloat(p.dailyChangePercent || \"0\"), 0)\n                    : 0;\n                  const isPositive = change > 0;\n                  \n                  return (\n                    <div\n                      key={i}\n                      className={cn(\n                        \"p-3 rounded-md text-center\",\n                        isPositive ? \"bg-success/10\" : change < 0 ? \"bg-destructive/10\" : \"bg-muted\"\n                      )}\n                    >\n                      <p className=\"text-xs text-muted-foreground mb-1\">{monthName}</p>\n                      <p className={cn(\n                        \"font-bold\",\n                        isPositive ? \"text-success\" : change < 0 ? \"text-destructive\" : \"text-foreground\"\n                      )} dir=\"ltr\">\n                        {isPositive && \"+\"}{change.toFixed(1)}%\n                      </p>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14868,"size_tokens":null},"client/src/components/market-ticker.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\nimport type { MarketData } from \"@shared/schema\";\n\ninterface MarketTickerProps {\n  marketData: MarketData[];\n  isLoading?: boolean;\n}\n\nexport function MarketTicker({ marketData, isLoading }: MarketTickerProps) {\n  if (isLoading) {\n    return (\n      <div className=\"flex gap-3 overflow-x-auto pb-2\">\n        {[1, 2, 3, 4].map((i) => (\n          <Card key={i} className=\"min-w-[180px] animate-pulse\">\n            <CardContent className=\"p-4\">\n              <div className=\"h-4 bg-muted rounded w-16 mb-2\" />\n              <div className=\"h-6 bg-muted rounded w-24 mb-1\" />\n              <div className=\"h-4 bg-muted rounded w-12\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (marketData.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex gap-3 overflow-x-auto pb-2\" data-testid=\"market-ticker\">\n      {marketData.map((item) => {\n        const changePercent = item.changePercent24h ? parseFloat(item.changePercent24h) : 0;\n        const isPositive = changePercent > 0;\n        const isNegative = changePercent < 0;\n\n        return (\n          <Card \n            key={item.id} \n            className=\"min-w-[180px] flex-shrink-0\"\n            data-testid={`ticker-${item.symbol}`}\n          >\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between mb-1\">\n                <span className=\"text-sm font-medium\" dir=\"ltr\">{item.symbol}</span>\n                <div className={cn(\n                  \"flex items-center gap-0.5 text-xs\",\n                  isPositive && \"text-success\",\n                  isNegative && \"text-destructive\",\n                  !isPositive && !isNegative && \"text-muted-foreground\"\n                )}>\n                  {isPositive && <TrendingUp className=\"w-3 h-3\" />}\n                  {isNegative && <TrendingDown className=\"w-3 h-3\" />}\n                  <span dir=\"ltr\">\n                    {isPositive && \"+\"}\n                    {changePercent.toFixed(2)}%\n                  </span>\n                </div>\n              </div>\n              <p className=\"text-xl font-bold\" dir=\"ltr\">\n                ${parseFloat(item.price).toLocaleString(\"en-US\", {\n                  minimumFractionDigits: 2,\n                  maximumFractionDigits: item.price.includes(\".\") && item.price.split(\".\")[1].length > 2 ? 4 : 2,\n                })}\n              </p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                حجم 24س: <span dir=\"ltr\">${item.volume24h ? (parseFloat(item.volume24h) / 1000000).toFixed(2) : \"0\"}M</span>\n              </p>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","path":null,"size_bytes":2839,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"light\" ? \"dark\" : \"light\")}\n      data-testid=\"button-theme-toggle\"\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">تبديل المظهر</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":688,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"dark\",\n  storageKey = \"mexai-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","path":null,"size_bytes":1599,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"design_guidelines.md":{"content":"# تصميم منصة التداول الجماعي الذكية MEXC\n\n## Design Approach\n**Reference-Based Approach** drawing from leading crypto trading platforms: Binance, Coinbase Pro, and TradingView. These platforms excel at presenting complex financial data clearly while maintaining professional credibility essential for trading applications.\n\n**Core Principle**: Data clarity and instant comprehension trump decorative elements. Every pixel serves the trader's decision-making process.\n\n## Typography System (Arabic RTL)\n\n**Primary Font**: Cairo or Tajawal (Google Fonts) - excellent Arabic support with multiple weights\n- **Display/Hero**: 32-40px, Bold (700) - for main headings and key metrics\n- **Section Headers**: 24-28px, SemiBold (600) \n- **Body Text**: 16px, Regular (400) - for descriptions and content\n- **Financial Data**: 18-20px, Medium (500) - for prices and numbers\n- **Labels/Captions**: 14px, Regular (400)\n\n**Number Display**: Use tabular figures (lining numerals) for financial data alignment\n\n## Layout System\n\n**Spacing Units**: Tailwind classes based on 4, 6, 8, 12, 16, 24 (e.g., p-4, gap-6, mb-8, py-12)\n\n**Grid Structure**:\n- Dashboard: 12-column grid with sidebar (fixed 280px right-side for Arabic RTL)\n- Card-based data panels in 2-3 column layouts on desktop\n- Single column stack on mobile (<768px)\n\n**Container Max-widths**:\n- Full dashboard: w-full\n- Content sections: max-w-7xl\n- Data cards: Full width within grid columns\n\n## Component Library\n\n### Navigation & Header\n- **Top Bar**: Fixed header (h-16) with logo, global stats ticker (current portfolio value, 24h change), user menu\n- **Sidebar**: Right-aligned (RTL), 280px wide, collapsible on mobile\n  - Main navigation sections: لوحة التحكم, المحفظة, التداولات, الإحصائيات, الإعدادات\n  - Active state with subtle border accent on the right edge\n\n### Dashboard Cards\n- **Metric Cards**: Elevated cards (shadow-md) with icon, label, large number, change indicator (+ green / - red)\n- **Chart Cards**: Larger cards containing TradingView-style candlestick/line charts\n- **Recent Activity**: List-style cards with timestamp, action type, amount\n\n### Data Display Components\n- **Stats Grid**: 3-4 column grid showing key metrics (Total Portfolio Value, Today's P/L, Total Shares, Active Trades)\n- **Performance Chart**: Large prominent area for portfolio value over time (line chart)\n- **Trade History Table**: Striped rows, sortable columns (Date, Pair, Type, Amount, Price, Status)\n- **Holdings Breakdown**: Donut chart showing asset allocation percentages\n\n### Financial Elements\n- **Price Displays**: Large, prominent numbers with currency symbol (USDT)\n- **Change Indicators**: Percentage badges with up/down arrows and appropriate styling\n- **Balance Cards**: User's share value, deposited amount, current value, profit/loss\n- **Action Buttons**: Primary CTAs for \"إيداع\" (Deposit), \"سحب\" (Withdraw) - prominent placement\n\n### Forms & Inputs\n- **Input Fields**: Clear labels above, consistent height (h-12), subtle borders\n- **Amount Inputs**: Large touch targets with currency selectors\n- **Validation**: Inline error messages in red, success in green\n- **Submit Buttons**: Full width on mobile, fixed width on desktop\n\n### Real-time Components\n- **Live Price Ticker**: Horizontal scrolling or grid of top crypto prices with 24h changes\n- **Status Indicators**: Colored dots (green=active, yellow=pending, red=failed)\n- **Loading States**: Skeleton screens for data-heavy sections\n\n## Visual Hierarchy\n\n**Primary Information**: Portfolio value, current P/L - largest, most prominent\n**Secondary Information**: Individual holdings, recent trades - medium emphasis  \n**Tertiary Information**: Historical data, settings - lower emphasis\n\n**Data Presentation**:\n- Large numbers draw immediate attention\n- Positive/negative changes use intuitive visual coding\n- Charts occupy generous space for pattern recognition\n- Dense data tables are cleanly formatted with ample whitespace\n\n## Arabic RTL Considerations\n\n- All layouts flip horizontally - sidebar on right, icons on right of text\n- Numbers remain LTR within RTL context\n- Directional arrows reverse appropriately\n- Navigation flows right-to-left\n- Charts and graphs maintain standard orientation\n\n## Images\n\n**Hero Section**: Full-width hero (h-[400px]) with abstract financial/crypto visualization\n- Gradient overlay with trading charts, crypto symbols, or network visualization\n- Hero content: Main value proposition headline + CTA buttons with backdrop blur\n\n**Dashboard**: No decorative images - focus entirely on data visualization and charts\n**About/Trust Section**: Optional team photos or office images if building trust section\n\n## Animations\n\n**Minimal and purposeful**:\n- Number counter animations when loading portfolio value\n- Subtle hover states on interactive elements (transform scale 1.02)\n- Smooth chart transitions when changing timeframes\n- Loading spinners for real-time data fetches\n- No elaborate scroll animations - data visibility is priority\n\n## Accessibility\n\n- High contrast ratios for all financial data (WCAG AAA for numbers)\n- Clear focus states on all interactive elements\n- Keyboard navigation fully supported\n- Screen reader labels for all charts and data visualizations\n- Touch targets minimum 44x44px for mobile trading\n\nThis design prioritizes instant data comprehension, professional credibility, and efficient trading workflows over decorative elements.","path":null,"size_bytes":5497,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  userShares,\n  transactions,\n  trades,\n  portfolioHistory,\n  sentimentAnalysis,\n  botSettings,\n  marketData,\n  walletAddresses,\n  notificationSettings,\n  rlAgentConfig,\n  rlTrainingEpisodes,\n  rlDecisions,\n  type User,\n  type UpsertUser,\n  type UserShares,\n  type InsertUserShares,\n  type Transaction,\n  type InsertTransaction,\n  type Trade,\n  type InsertTrade,\n  type PortfolioHistory,\n  type InsertPortfolioHistory,\n  type Sentiment,\n  type InsertSentiment,\n  type BotSettings,\n  type InsertBotSettings,\n  type MarketData,\n  type InsertMarketData,\n  type WalletAddress,\n  type InsertWalletAddress,\n  type NotificationSettings,\n  type InsertNotificationSettings,\n  type RlAgentConfig,\n  type InsertRlAgentConfig,\n  type RlTrainingEpisode,\n  type InsertRlTrainingEpisode,\n  type RlDecision,\n  type InsertRlDecision,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  \n  getUserShares(userId: string): Promise<UserShares | undefined>;\n  createUserShares(shares: InsertUserShares): Promise<UserShares>;\n  updateUserShares(userId: string, shares: Partial<InsertUserShares>): Promise<UserShares | undefined>;\n  \n  getTransactions(userId: string): Promise<Transaction[]>;\n  getTransactionById(id: string): Promise<Transaction | undefined>;\n  getTransactionByTxHash(txHash: string): Promise<Transaction | undefined>;\n  getPendingTransactions(): Promise<Transaction[]>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  updateTransactionStatus(id: string, status: string, txHash?: string): Promise<Transaction | undefined>;\n  \n  getTrades(limit?: number): Promise<Trade[]>;\n  createTrade(trade: InsertTrade): Promise<Trade>;\n  \n  getPortfolioHistory(limit?: number): Promise<PortfolioHistory[]>;\n  createPortfolioHistory(history: InsertPortfolioHistory): Promise<PortfolioHistory>;\n  \n  getSentiment(symbol: string): Promise<Sentiment | undefined>;\n  getAllSentiments(limit?: number): Promise<Sentiment[]>;\n  createSentiment(sentiment: InsertSentiment): Promise<Sentiment>;\n  \n  getBotSettings(): Promise<BotSettings | undefined>;\n  updateBotSettings(settings: Partial<InsertBotSettings>): Promise<BotSettings>;\n  \n  getMarketData(): Promise<MarketData[]>;\n  upsertMarketData(data: InsertMarketData): Promise<MarketData>;\n  \n  getWalletAddress(userId: string, coin: string, network: string): Promise<WalletAddress | undefined>;\n  getWalletAddresses(userId: string): Promise<WalletAddress[]>;\n  getWalletAddressByAddress(address: string): Promise<WalletAddress | undefined>;\n  createWalletAddress(address: InsertWalletAddress): Promise<WalletAddress>;\n  \n  getRlAgentConfig(symbol: string): Promise<RlAgentConfig | undefined>;\n  getAllRlAgentConfigs(): Promise<RlAgentConfig[]>;\n  createRlAgentConfig(config: InsertRlAgentConfig): Promise<RlAgentConfig>;\n  updateRlAgentConfig(symbol: string, config: Partial<InsertRlAgentConfig>): Promise<RlAgentConfig | undefined>;\n  \n  getRlTrainingEpisodes(agentId: string, limit?: number): Promise<RlTrainingEpisode[]>;\n  createRlTrainingEpisode(episode: InsertRlTrainingEpisode): Promise<RlTrainingEpisode>;\n  \n  getRlDecisions(agentId: string, limit?: number): Promise<RlDecision[]>;\n  createRlDecision(decision: InsertRlDecision): Promise<RlDecision>;\n  updateRlDecisionReward(id: string, reward: string, wasExecuted: boolean): Promise<RlDecision | undefined>;\n  \n  getNotificationSettings(userId: string): Promise<NotificationSettings | undefined>;\n  createNotificationSettings(settings: InsertNotificationSettings): Promise<NotificationSettings>;\n  updateNotificationSettings(userId: string, settings: Partial<InsertNotificationSettings>): Promise<NotificationSettings | undefined>;\n  getUsersWithTelegramEnabled(): Promise<NotificationSettings[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async getUserShares(userId: string): Promise<UserShares | undefined> {\n    const [shares] = await db.select().from(userShares).where(eq(userShares.userId, userId));\n    return shares;\n  }\n\n  async createUserShares(shares: InsertUserShares): Promise<UserShares> {\n    const [created] = await db.insert(userShares).values(shares).returning();\n    return created;\n  }\n\n  async updateUserShares(userId: string, shares: Partial<InsertUserShares>): Promise<UserShares | undefined> {\n    const [updated] = await db\n      .update(userShares)\n      .set({ ...shares, updatedAt: new Date() })\n      .where(eq(userShares.userId, userId))\n      .returning();\n    return updated;\n  }\n\n  async getTransactions(userId: string): Promise<Transaction[]> {\n    return await db.select().from(transactions)\n      .where(eq(transactions.userId, userId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const [created] = await db.insert(transactions).values(transaction).returning();\n    return created;\n  }\n\n  async getTransactionById(id: string): Promise<Transaction | undefined> {\n    const [transaction] = await db.select().from(transactions).where(eq(transactions.id, id));\n    return transaction;\n  }\n\n  async getTransactionByTxHash(txHash: string): Promise<Transaction | undefined> {\n    const [transaction] = await db.select().from(transactions).where(eq(transactions.txHash, txHash));\n    return transaction;\n  }\n\n  async getPendingTransactions(): Promise<Transaction[]> {\n    return await db.select().from(transactions)\n      .where(eq(transactions.status, \"pending\"))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async updateTransactionStatus(id: string, status: string, txHash?: string): Promise<Transaction | undefined> {\n    const updateData: { status: string; txHash?: string } = { status };\n    if (txHash) updateData.txHash = txHash;\n    \n    const [updated] = await db\n      .update(transactions)\n      .set(updateData)\n      .where(eq(transactions.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getTrades(limit?: number): Promise<Trade[]> {\n    const query = db.select().from(trades).orderBy(desc(trades.createdAt));\n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async createTrade(trade: InsertTrade): Promise<Trade> {\n    const [created] = await db.insert(trades).values(trade).returning();\n    return created;\n  }\n\n  async getPortfolioHistory(limit?: number): Promise<PortfolioHistory[]> {\n    const query = db.select().from(portfolioHistory).orderBy(desc(portfolioHistory.recordedAt));\n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async createPortfolioHistory(history: InsertPortfolioHistory): Promise<PortfolioHistory> {\n    const [created] = await db.insert(portfolioHistory).values(history).returning();\n    return created;\n  }\n\n  async getSentiment(symbol: string): Promise<Sentiment | undefined> {\n    const [sentiment] = await db.select().from(sentimentAnalysis)\n      .where(eq(sentimentAnalysis.symbol, symbol))\n      .orderBy(desc(sentimentAnalysis.createdAt))\n      .limit(1);\n    return sentiment;\n  }\n\n  async getAllSentiments(limit?: number): Promise<Sentiment[]> {\n    const query = db.select().from(sentimentAnalysis).orderBy(desc(sentimentAnalysis.createdAt));\n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async createSentiment(sentiment: InsertSentiment): Promise<Sentiment> {\n    const [created] = await db.insert(sentimentAnalysis).values(sentiment).returning();\n    return created;\n  }\n\n  async getBotSettings(): Promise<BotSettings | undefined> {\n    const [settings] = await db.select().from(botSettings).limit(1);\n    return settings;\n  }\n\n  async updateBotSettings(settings: Partial<InsertBotSettings>): Promise<BotSettings> {\n    const existing = await this.getBotSettings();\n    \n    if (existing) {\n      const [updated] = await db\n        .update(botSettings)\n        .set({ ...settings, updatedAt: new Date() })\n        .where(eq(botSettings.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db.insert(botSettings).values(settings as InsertBotSettings).returning();\n      return created;\n    }\n  }\n\n  async getMarketData(): Promise<MarketData[]> {\n    return await db.select().from(marketData).orderBy(desc(marketData.updatedAt));\n  }\n\n  async upsertMarketData(data: InsertMarketData): Promise<MarketData> {\n    const existing = await db.select().from(marketData).where(eq(marketData.symbol, data.symbol)).limit(1);\n    \n    if (existing.length > 0) {\n      const [updated] = await db\n        .update(marketData)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(marketData.symbol, data.symbol))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db.insert(marketData).values(data).returning();\n      return created;\n    }\n  }\n\n  async getWalletAddress(userId: string, coin: string, network: string): Promise<WalletAddress | undefined> {\n    const [address] = await db.select().from(walletAddresses)\n      .where(and(\n        eq(walletAddresses.userId, userId),\n        eq(walletAddresses.coin, coin.toUpperCase()),\n        eq(walletAddresses.network, network.toUpperCase())\n      ));\n    return address;\n  }\n\n  async getWalletAddresses(userId: string): Promise<WalletAddress[]> {\n    return await db.select().from(walletAddresses)\n      .where(eq(walletAddresses.userId, userId))\n      .orderBy(desc(walletAddresses.createdAt));\n  }\n\n  async getWalletAddressByAddress(address: string): Promise<WalletAddress | undefined> {\n    const [walletAddress] = await db.select().from(walletAddresses)\n      .where(eq(walletAddresses.address, address));\n    return walletAddress;\n  }\n\n  async createWalletAddress(address: InsertWalletAddress): Promise<WalletAddress> {\n    const [created] = await db.insert(walletAddresses).values({\n      ...address,\n      coin: address.coin.toUpperCase(),\n      network: address.network.toUpperCase(),\n    }).returning();\n    return created;\n  }\n\n  async getRlAgentConfig(symbol: string): Promise<RlAgentConfig | undefined> {\n    const [config] = await db.select().from(rlAgentConfig)\n      .where(eq(rlAgentConfig.symbol, symbol.toUpperCase()));\n    return config;\n  }\n\n  async getAllRlAgentConfigs(): Promise<RlAgentConfig[]> {\n    return await db.select().from(rlAgentConfig)\n      .orderBy(desc(rlAgentConfig.updatedAt));\n  }\n\n  async createRlAgentConfig(config: InsertRlAgentConfig): Promise<RlAgentConfig> {\n    const [created] = await db.insert(rlAgentConfig).values({\n      ...config,\n      symbol: config.symbol.toUpperCase(),\n    }).returning();\n    return created;\n  }\n\n  async updateRlAgentConfig(symbol: string, config: Partial<InsertRlAgentConfig>): Promise<RlAgentConfig | undefined> {\n    const [updated] = await db.update(rlAgentConfig)\n      .set({ ...config, updatedAt: new Date() })\n      .where(eq(rlAgentConfig.symbol, symbol.toUpperCase()))\n      .returning();\n    return updated;\n  }\n\n  async getRlTrainingEpisodes(agentId: string, limit?: number): Promise<RlTrainingEpisode[]> {\n    const query = db.select().from(rlTrainingEpisodes)\n      .where(eq(rlTrainingEpisodes.agentId, agentId))\n      .orderBy(desc(rlTrainingEpisodes.createdAt));\n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async createRlTrainingEpisode(episode: InsertRlTrainingEpisode): Promise<RlTrainingEpisode> {\n    const [created] = await db.insert(rlTrainingEpisodes).values(episode).returning();\n    return created;\n  }\n\n  async getRlDecisions(agentId: string, limit?: number): Promise<RlDecision[]> {\n    const query = db.select().from(rlDecisions)\n      .where(eq(rlDecisions.agentId, agentId))\n      .orderBy(desc(rlDecisions.createdAt));\n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async createRlDecision(decision: InsertRlDecision): Promise<RlDecision> {\n    const [created] = await db.insert(rlDecisions).values({\n      ...decision,\n      symbol: decision.symbol.toUpperCase(),\n    }).returning();\n    return created;\n  }\n\n  async updateRlDecisionReward(id: string, reward: string, wasExecuted: boolean): Promise<RlDecision | undefined> {\n    const [updated] = await db.update(rlDecisions)\n      .set({ reward, wasExecuted })\n      .where(eq(rlDecisions.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getNotificationSettings(userId: string): Promise<NotificationSettings | undefined> {\n    const [settings] = await db.select().from(notificationSettings)\n      .where(eq(notificationSettings.userId, userId));\n    return settings;\n  }\n\n  async createNotificationSettings(settings: InsertNotificationSettings): Promise<NotificationSettings> {\n    const [created] = await db.insert(notificationSettings).values(settings).returning();\n    return created;\n  }\n\n  async updateNotificationSettings(userId: string, settings: Partial<InsertNotificationSettings>): Promise<NotificationSettings | undefined> {\n    const existing = await this.getNotificationSettings(userId);\n    \n    if (existing) {\n      const [updated] = await db.update(notificationSettings)\n        .set({ ...settings, updatedAt: new Date() })\n        .where(eq(notificationSettings.userId, userId))\n        .returning();\n      return updated;\n    } else {\n      return await this.createNotificationSettings({ userId, ...settings });\n    }\n  }\n\n  async getUsersWithTelegramEnabled(): Promise<NotificationSettings[]> {\n    return await db.select().from(notificationSettings)\n      .where(and(\n        eq(notificationSettings.telegramEnabled, true)\n      ));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":14353,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"replit.md":{"content":"# Overview\n\nMexAI Trader is an Arabic-RTL cryptocurrency trading platform that combines collective investment pooling with AI-powered automated trading on MEXC exchange. The platform enables users to invest in a shared portfolio managed by an intelligent trading bot that uses technical indicators (RSI, MACD, Moving Averages) and OpenAI sentiment analysis to execute trades. Users track their share-based ownership, view real-time portfolio performance, and manage bot trading strategies through a modern dashboard interface.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n\n**Technology Stack**: React 18 with TypeScript, Vite build system, Wouter for client-side routing\n\n**UI Framework**: Shadcn UI components built on Radix UI primitives with Tailwind CSS for styling\n\n**Design System**: \n- RTL (right-to-left) layout optimized for Arabic language\n- Cairo/Tajawal Google Fonts for Arabic typography\n- Dark/light theme support with system preference detection\n- Responsive design with mobile-first breakpoints\n- Color system using HSL CSS variables for dynamic theming\n\n**State Management**: TanStack Query (React Query) for server state caching and synchronization\n\n**Component Organization**:\n- Feature-based page components (Dashboard, Portfolio, Trades, Market, AI Analysis, Stats, Settings)\n- Reusable UI components (StatsCard, PortfolioChart, TradesTable, BotStatus, SentimentCard, MarketTicker)\n- Shadcn UI component library in `client/src/components/ui/`\n\n**Data Visualization**: Recharts library for charts (AreaChart, BarChart, PieChart) showing portfolio performance, trade history, and market data\n\n## Backend Architecture\n\n**Runtime**: Node.js with Express.js framework\n\n**Language**: TypeScript with ES modules\n\n**API Design**: RESTful JSON API with the following endpoint categories:\n- Authentication endpoints (Replit Auth integration)\n- User data endpoints (shares, transactions)\n- Trading endpoints (trades history, bot settings)\n- Market data endpoints (prices, sentiment analysis)\n- Portfolio endpoints (history, statistics)\n\n**Authentication Strategy**: \n- Replit OpenID Connect (OIDC) integration using passport.js\n- Session-based authentication with express-session\n- PostgreSQL session store (connect-pg-simple)\n- Middleware-protected routes requiring authentication\n\n**AI Integration**: \n- OpenAI API for market sentiment analysis and trade signal generation\n- Rate limiting with p-limit and retry logic with p-retry\n- Sentiment scoring system (-100 to +100 range)\n- Confidence-based trading recommendations\n\n**Data Layer**: \n- Drizzle ORM for type-safe database operations\n- Repository pattern via storage abstraction layer\n- Transaction support for financial operations\n\n## Data Storage\n\n**Database**: PostgreSQL\n\n**ORM**: Drizzle ORM with schema-first approach\n\n**Schema Design**:\n- `users` - User profiles from Replit Auth (id, email, name, profile image)\n- `user_shares` - Individual user ownership in collective pool (shares, deposits, current value, P/L)\n- `transactions` - Deposit/withdrawal history (type, amount, status, timestamps)\n- `trades` - Bot trading activity (symbol, type, quantity, price, strategy, P/L)\n- `portfolio_history` - Time-series portfolio snapshots (total value, share price, daily changes)\n- `sentiment_analysis` - AI sentiment data per symbol (bullish/bearish/neutral, score, confidence)\n- `bot_settings` - Trading bot configuration (strategies enabled, risk parameters, thresholds)\n- `market_data` - Real-time market prices and metrics (symbol, price, 24h change, volume)\n- `sessions` - Express session storage for authentication\n\n**Decimal Precision**: Financial values use `decimal(20, 8)` for cryptocurrency precision\n\n**Migrations**: Drizzle Kit for schema migrations in `migrations/` directory\n\n## External Dependencies\n\n**Authentication Service**: Replit Identity (OpenID Connect provider)\n\n**AI Service**: OpenAI API via Replit AI Integrations\n- Base URL: `process.env.AI_INTEGRATIONS_OPENAI_BASE_URL`\n- API Key: `process.env.AI_INTEGRATIONS_OPENAI_API_KEY`\n- Model: GPT-5 for sentiment analysis and trade signals\n\n**Cryptocurrency Exchange**: MEXC (implied by design docs, API integration not yet implemented in codebase)\n\n**External Libraries**:\n- Form handling: react-hook-form with zod validation\n- Date manipulation: date-fns\n- Icons: Lucide React\n- Charts: Recharts\n- Toast notifications: Radix UI Toast\n- Session storage: PostgreSQL via connect-pg-simple\n\n**Build Tools**:\n- Vite for frontend bundling with HMR\n- esbuild for server-side bundling in production\n- TypeScript compiler for type checking\n- Tailwind CSS with PostCSS for styling\n\n**Development Tools**:\n- Replit-specific plugins (cartographer, dev-banner, runtime-error-modal)\n- Source map support for debugging","path":null,"size_bytes":4829,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { getQueryFn } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading, isError } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn<User | null>({ on401: \"returnNull\" }),\n    retry: false,\n    staleTime: 5 * 60 * 1000,\n    refetchOnWindowFocus: false,\n  });\n\n  const login = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const logout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    login,\n    logout,\n  };\n}\n","path":null,"size_bytes":664,"size_tokens":null},"client/src/components/transactions-list.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { ArrowUpCircle, ArrowDownCircle, Clock, CheckCircle, XCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { Transaction } from \"@shared/schema\";\n\ninterface TransactionsListProps {\n  transactions: Transaction[];\n  isLoading?: boolean;\n}\n\nconst statusConfig = {\n  pending: { label: \"قيد الانتظار\", icon: Clock, color: \"text-warning\" },\n  confirmed: { label: \"مؤكد\", icon: CheckCircle, color: \"text-success\" },\n  cancelled: { label: \"ملغي\", icon: XCircle, color: \"text-destructive\" },\n};\n\nexport function TransactionsList({ transactions, isLoading }: TransactionsListProps) {\n  const formatDate = (date: Date | string | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-SA\", {\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const formatCurrency = (value: string) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(parseFloat(value));\n  };\n\n  return (\n    <Card data-testid=\"card-transactions\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg\">سجل العمليات</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        {isLoading ? (\n          <div className=\"p-4 space-y-3\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"animate-pulse flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-muted rounded-full\" />\n                <div className=\"flex-1\">\n                  <div className=\"h-4 bg-muted rounded w-24 mb-2\" />\n                  <div className=\"h-3 bg-muted rounded w-16\" />\n                </div>\n                <div className=\"h-5 bg-muted rounded w-20\" />\n              </div>\n            ))}\n          </div>\n        ) : transactions.length === 0 ? (\n          <div className=\"p-8 text-center text-muted-foreground\">\n            لا توجد عمليات حتى الآن\n          </div>\n        ) : (\n          <ScrollArea className=\"h-[300px]\">\n            <div className=\"p-4 space-y-3\">\n              {transactions.map((tx) => {\n                const isDeposit = tx.type === \"deposit\";\n                const status = statusConfig[tx.status as keyof typeof statusConfig] || statusConfig.pending;\n                const StatusIcon = status.icon;\n\n                return (\n                  <div\n                    key={tx.id}\n                    className=\"flex items-center gap-3 p-3 rounded-md bg-muted/50 hover-elevate\"\n                    data-testid={`transaction-${tx.id}`}\n                  >\n                    <div className={cn(\n                      \"w-10 h-10 rounded-full flex items-center justify-center\",\n                      isDeposit ? \"bg-success/20\" : \"bg-destructive/20\"\n                    )}>\n                      {isDeposit ? (\n                        <ArrowUpCircle className=\"w-5 h-5 text-success\" />\n                      ) : (\n                        <ArrowDownCircle className=\"w-5 h-5 text-destructive\" />\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-sm\">\n                        {isDeposit ? \"إيداع\" : \"سحب\"}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {formatDate(tx.createdAt)}\n                      </p>\n                    </div>\n                    <div className=\"text-left\">\n                      <p className={cn(\n                        \"font-bold text-sm\",\n                        isDeposit ? \"text-success\" : \"text-destructive\"\n                      )} dir=\"ltr\">\n                        {isDeposit ? \"+\" : \"-\"}{formatCurrency(tx.amount)}\n                      </p>\n                      <Badge variant=\"outline\" className={cn(\"text-xs\", status.color)}>\n                        <StatusIcon className=\"w-3 h-3 ml-1\" />\n                        {status.label}\n                      </Badge>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </ScrollArea>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4450,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { analyzeSentiment, analyzeTradeSignal } from \"./openai\";\nimport { mexcService } from \"./mexc\";\nimport { smcService, analyzeSMC, generateSMCSignal, type Candle } from \"./smc\";\nimport { getOrCreateAgent, resetAgent } from \"./rl-agent\";\nimport { telegramService } from \"./telegram\";\nimport {\n  insertTransactionSchema,\n  insertUserSharesSchema,\n  insertBotSettingsSchema,\n  insertNotificationSettingsSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport pRetry, { AbortError } from \"p-retry\";\n\nconst klinesCache: Map<string, { candles: Candle[]; timestamp: number }> = new Map();\nconst KLINES_CACHE_TTL = 60000;\n\ninterface KlinesResult {\n  candles: Candle[];\n  source: \"live\" | \"cache\" | \"stale_cache\";\n  cacheAge?: number;\n}\n\nasync function fetchKlinesWithRetry(symbol: string): Promise<KlinesResult> {\n  const cacheKey = symbol.toUpperCase();\n  const cached = klinesCache.get(cacheKey);\n  \n  if (cached && Date.now() - cached.timestamp < KLINES_CACHE_TTL) {\n    return { \n      candles: cached.candles, \n      source: \"cache\",\n      cacheAge: Math.round((Date.now() - cached.timestamp) / 1000)\n    };\n  }\n  \n  try {\n    const candles = await pRetry(\n      async () => {\n        const klines = await mexcService.getKlines(symbol, \"15m\", 100);\n        return klines.map(kline => ({\n          time: kline.openTime,\n          open: kline.open,\n          high: kline.high,\n          low: kline.low,\n          close: kline.close,\n          volume: kline.volume,\n        }));\n      },\n      {\n        retries: 3,\n        minTimeout: 1000,\n        maxTimeout: 5000,\n        shouldRetry: (error) => {\n          const errorMsg = String(error.message || \"\");\n          if (errorMsg.includes(\"401\") || errorMsg.includes(\"403\")) {\n            return false;\n          }\n          return true;\n        },\n        onFailedAttempt: (error) => {\n          console.log(`Klines fetch attempt ${error.attemptNumber} failed. ${error.retriesLeft} retries left.`);\n        },\n      }\n    );\n    \n    klinesCache.set(cacheKey, { candles, timestamp: Date.now() });\n    return { candles, source: \"live\" };\n  } catch (error) {\n    if (cached) {\n      console.log(`Using stale cache for ${cacheKey} after API failure`);\n      return { \n        candles: cached.candles, \n        source: \"stale_cache\",\n        cacheAge: Math.round((Date.now() - cached.timestamp) / 1000)\n      };\n    }\n    throw error;\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  await setupAuth(app);\n\n  // Auth routes\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // User shares endpoints\n  app.get(\"/api/user/shares\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      let shares = await storage.getUserShares(userId);\n      \n      if (!shares) {\n        shares = await storage.createUserShares({\n          userId,\n          totalShares: \"0\",\n          totalDeposited: \"0\",\n          currentValue: \"0\",\n          profitLoss: \"0\",\n          profitLossPercent: \"0\",\n        });\n      }\n      \n      res.json(shares);\n    } catch (error) {\n      console.error(\"Error fetching user shares:\", error);\n      res.status(500).json({ message: \"Failed to fetch user shares\" });\n    }\n  });\n\n  app.post(\"/api/user/shares\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const data = insertUserSharesSchema.parse({ ...req.body, userId });\n      \n      const existing = await storage.getUserShares(userId);\n      if (existing) {\n        const updated = await storage.updateUserShares(userId, data);\n        res.json(updated);\n      } else {\n        const created = await storage.createUserShares(data);\n        res.json(created);\n      }\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n        return;\n      }\n      console.error(\"Error updating user shares:\", error);\n      res.status(500).json({ message: \"Failed to update user shares\" });\n    }\n  });\n\n  // Transactions endpoints - support both /api/transactions and /api/user/transactions\n  const transactionsHandler = async (req: any, res: any) => {\n    try {\n      const userId = req.user.claims.sub;\n      const txns = await storage.getTransactions(userId);\n      res.json(txns);\n    } catch (error) {\n      console.error(\"Error fetching transactions:\", error);\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  };\n  \n  app.get(\"/api/transactions\", isAuthenticated, transactionsHandler);\n  app.get(\"/api/user/transactions\", isAuthenticated, transactionsHandler);\n\n  app.post(\"/api/transactions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const data = insertTransactionSchema.parse({ ...req.body, userId });\n      const transaction = await storage.createTransaction(data);\n      \n      // Update user shares based on transaction\n      const shares = await storage.getUserShares(userId);\n      if (shares && data.type === \"deposit\") {\n        const newDeposited = (parseFloat(shares.totalDeposited) + parseFloat(data.amount)).toString();\n        const newShares = (parseFloat(shares.totalShares) + parseFloat(data.amount)).toString();\n        await storage.updateUserShares(userId, {\n          totalDeposited: newDeposited,\n          totalShares: newShares,\n          currentValue: newShares,\n        });\n      }\n      \n      res.json(transaction);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n        return;\n      }\n      console.error(\"Error creating transaction:\", error);\n      res.status(500).json({ message: \"Failed to create transaction\" });\n    }\n  });\n\n  // Trades endpoints\n  app.get(\"/api/trades\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const tradesList = await storage.getTrades(limit);\n      res.json(tradesList);\n    } catch (error) {\n      console.error(\"Error fetching trades:\", error);\n      res.status(500).json({ message: \"Failed to fetch trades\" });\n    }\n  });\n\n  // Portfolio history endpoints\n  app.get(\"/api/portfolio/history\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 30;\n      const history = await storage.getPortfolioHistory(limit);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching portfolio history:\", error);\n      res.status(500).json({ message: \"Failed to fetch portfolio history\" });\n    }\n  });\n\n  // Sentiment analysis endpoints\n  app.get(\"/api/sentiment\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 20;\n      const sentiments = await storage.getAllSentiments(limit);\n      res.json(sentiments);\n    } catch (error) {\n      console.error(\"Error fetching sentiments:\", error);\n      res.status(500).json({ message: \"Failed to fetch sentiments\" });\n    }\n  });\n\n  app.get(\"/api/sentiment/:symbol\", async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const sentiment = await storage.getSentiment(symbol.toUpperCase());\n      res.json(sentiment || { sentiment: \"neutral\", score: 0, summary: \"No analysis available\" });\n    } catch (error) {\n      console.error(\"Error fetching sentiment:\", error);\n      res.status(500).json({ message: \"Failed to fetch sentiment\" });\n    }\n  });\n\n  app.post(\"/api/sentiment/analyze\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol, newsContext } = req.body;\n      \n      if (!symbol) {\n        res.status(400).json({ message: \"Symbol is required\" });\n        return;\n      }\n\n      const result = await analyzeSentiment(symbol.toUpperCase(), newsContext);\n      \n      const saved = await storage.createSentiment({\n        symbol: symbol.toUpperCase(),\n        sentiment: result.sentiment,\n        score: result.score.toString(),\n        summary: result.summary,\n        confidence: result.confidence.toString(),\n        newsSource: newsContext || null,\n      });\n      \n      res.json(saved);\n    } catch (error) {\n      console.error(\"Error analyzing sentiment:\", error);\n      res.status(500).json({ message: \"Failed to analyze sentiment\" });\n    }\n  });\n\n  // Bot settings endpoints\n  app.get(\"/api/bot/settings\", async (req, res) => {\n    try {\n      let settings = await storage.getBotSettings();\n      \n      if (!settings) {\n        settings = await storage.updateBotSettings({\n          isActive: false,\n          maxRiskPercent: \"5\",\n          stopLossPercent: \"3\",\n          takeProfitPercent: \"10\",\n          maxPositionSize: \"1000\",\n          tradingPairs: [\"BTC/USDT\", \"ETH/USDT\"],\n          useAiSentiment: true,\n          useRsi: true,\n          useMacd: true,\n          useMovingAverages: true,\n        });\n      }\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching bot settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch bot settings\" });\n    }\n  });\n\n  app.patch(\"/api/bot/settings\", isAuthenticated, async (req, res) => {\n    try {\n      const data = insertBotSettingsSchema.partial().parse(req.body);\n      const settings = await storage.updateBotSettings(data);\n      res.json(settings);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n        return;\n      }\n      console.error(\"Error updating bot settings:\", error);\n      res.status(500).json({ message: \"Failed to update bot settings\" });\n    }\n  });\n\n  // Market data endpoints - support both /api/market and /api/market/data\n  const marketDataHandler = async (req: any, res: any) => {\n    try {\n      const data = await storage.getMarketData();\n      \n      if (data.length === 0) {\n        const defaultData = [\n          { symbol: \"BTC/USDT\", price: \"43250.50\", change24h: \"1250.00\", changePercent24h: \"2.98\", volume24h: \"1250000000\", high24h: \"43800.00\", low24h: \"41900.00\" },\n          { symbol: \"ETH/USDT\", price: \"2280.75\", change24h: \"85.25\", changePercent24h: \"3.88\", volume24h: \"520000000\", high24h: \"2320.00\", low24h: \"2180.00\" },\n          { symbol: \"SOL/USDT\", price: \"98.45\", change24h: \"-2.15\", changePercent24h: \"-2.14\", volume24h: \"180000000\", high24h: \"102.50\", low24h: \"96.20\" },\n          { symbol: \"XRP/USDT\", price: \"0.6245\", change24h: \"0.0125\", changePercent24h: \"2.04\", volume24h: \"95000000\", high24h: \"0.6350\", low24h: \"0.6080\" },\n        ];\n        \n        for (const item of defaultData) {\n          await storage.upsertMarketData(item);\n        }\n        \n        res.json(defaultData);\n        return;\n      }\n      \n      res.json(data);\n    } catch (error) {\n      console.error(\"Error fetching market data:\", error);\n      res.status(500).json({ message: \"Failed to fetch market data\" });\n    }\n  };\n  \n  app.get(\"/api/market/data\", marketDataHandler);\n  app.get(\"/api/market\", marketDataHandler);\n\n  // AI Trading signal endpoint\n  app.post(\"/api/ai/signal\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol, price, change24h, rsi, macd, sma } = req.body;\n      \n      if (!symbol || !price) {\n        res.status(400).json({ message: \"Symbol and price are required\" });\n        return;\n      }\n\n      const signal = await analyzeTradeSignal(\n        symbol,\n        { price: parseFloat(price), change24h: parseFloat(change24h || \"0\") },\n        { rsi, macd, sma }\n      );\n      \n      res.json(signal);\n    } catch (error) {\n      console.error(\"Error generating AI signal:\", error);\n      res.status(500).json({ message: \"Failed to generate trading signal\" });\n    }\n  });\n\n  // Dashboard stats endpoint\n  app.get(\"/api/stats\", async (req, res) => {\n    try {\n      const portfolioHistory = await storage.getPortfolioHistory(1);\n      const trades = await storage.getTrades(100);\n      const settings = await storage.getBotSettings();\n      \n      const latestPortfolio = portfolioHistory[0];\n      const winningTrades = trades.filter(t => t.profitLoss && parseFloat(t.profitLoss) > 0).length;\n      const totalTrades = trades.length;\n      \n      res.json({\n        totalValue: latestPortfolio?.totalValue || \"0\",\n        totalShares: latestPortfolio?.totalShares || \"0\",\n        pricePerShare: latestPortfolio?.pricePerShare || \"1\",\n        dailyChange: latestPortfolio?.dailyChange || \"0\",\n        dailyChangePercent: latestPortfolio?.dailyChangePercent || \"0\",\n        totalTrades,\n        winRate: totalTrades > 0 ? ((winningTrades / totalTrades) * 100).toFixed(2) : \"0\",\n        botActive: settings?.isActive || false,\n      });\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Pool stats endpoint\n  app.get(\"/api/pool/stats\", async (req, res) => {\n    try {\n      const portfolioHistory = await storage.getPortfolioHistory(1);\n      const latestPortfolio = portfolioHistory[0];\n      \n      res.json({\n        totalValue: latestPortfolio?.totalValue ? parseFloat(latestPortfolio.totalValue) : 0,\n        totalShares: latestPortfolio?.totalShares ? parseFloat(latestPortfolio.totalShares) : 0,\n        pricePerShare: latestPortfolio?.pricePerShare ? parseFloat(latestPortfolio.pricePerShare) : 1,\n      });\n    } catch (error) {\n      console.error(\"Error fetching pool stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch pool stats\" });\n    }\n  });\n\n  // MEXC API endpoints\n  app.get(\"/api/mexc/test\", isAuthenticated, async (req, res) => {\n    try {\n      const connected = await mexcService.testConnection();\n      res.json({ connected, message: connected ? \"MEXC API connected successfully\" : \"MEXC API connection failed\" });\n    } catch (error) {\n      console.error(\"Error testing MEXC connection:\", error);\n      res.status(500).json({ message: \"Failed to test MEXC connection\" });\n    }\n  });\n\n  app.get(\"/api/mexc/balance\", isAuthenticated, async (req, res) => {\n    try {\n      const balances = await mexcService.getAccountBalance();\n      res.json(balances);\n    } catch (error) {\n      console.error(\"Error fetching MEXC balance:\", error);\n      res.status(500).json({ message: \"Failed to fetch MEXC balance\" });\n    }\n  });\n\n  app.get(\"/api/mexc/coins\", isAuthenticated, async (req, res) => {\n    try {\n      const coins = await mexcService.getCoinInfo();\n      const supportedCoins = coins.filter(c => \n        c.networkList.some(n => n.depositEnable || n.withdrawEnable)\n      );\n      res.json(supportedCoins);\n    } catch (error) {\n      console.error(\"Error fetching coin info:\", error);\n      res.status(500).json({ message: \"Failed to fetch coin information\" });\n    }\n  });\n\n  app.get(\"/api/mexc/coin/:coin/networks\", isAuthenticated, async (req, res) => {\n    try {\n      const { coin } = req.params;\n      const coinInfo = await mexcService.getNetworksForCoin(coin);\n      if (!coinInfo) {\n        res.status(404).json({ message: \"Coin not found\" });\n        return;\n      }\n      res.json(coinInfo.networkList);\n    } catch (error) {\n      console.error(\"Error fetching networks:\", error);\n      res.status(500).json({ message: \"Failed to fetch networks\" });\n    }\n  });\n\n  // Deposit address endpoint\n  app.post(\"/api/mexc/deposit/address\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { coin, network } = req.body;\n\n      if (!coin || !network) {\n        res.status(400).json({ message: \"Coin and network are required\" });\n        return;\n      }\n\n      const existingAddress = await storage.getWalletAddress(userId, coin, network);\n      if (existingAddress) {\n        res.json(existingAddress);\n        return;\n      }\n\n      const addresses = await mexcService.getDepositAddress(coin, network);\n      if (!addresses || addresses.length === 0) {\n        res.status(404).json({ message: \"No deposit address available for this coin/network\" });\n        return;\n      }\n\n      const mexcAddress = addresses[0];\n      const savedAddress = await storage.createWalletAddress({\n        userId,\n        coin: mexcAddress.coin,\n        network: mexcAddress.network,\n        address: mexcAddress.address,\n        memo: mexcAddress.memo,\n      });\n\n      res.json(savedAddress);\n    } catch (error) {\n      console.error(\"Error getting deposit address:\", error);\n      res.status(500).json({ message: \"Failed to get deposit address\" });\n    }\n  });\n\n  // Get user's saved wallet addresses\n  app.get(\"/api/wallet/addresses\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const addresses = await storage.getWalletAddresses(userId);\n      res.json(addresses);\n    } catch (error) {\n      console.error(\"Error fetching wallet addresses:\", error);\n      res.status(500).json({ message: \"Failed to fetch wallet addresses\" });\n    }\n  });\n\n  // Deposit history from MEXC\n  app.get(\"/api/mexc/deposit/history\", isAuthenticated, async (req, res) => {\n    try {\n      const coin = req.query.coin as string | undefined;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const history = await mexcService.getDepositHistory(coin, undefined, undefined, undefined, limit);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching deposit history:\", error);\n      res.status(500).json({ message: \"Failed to fetch deposit history\" });\n    }\n  });\n\n  // Withdrawal endpoint\n  app.post(\"/api/mexc/withdraw\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { coin, address, amount, network, memo } = req.body;\n\n      if (!coin || !address || !amount || !network) {\n        res.status(400).json({ message: \"Coin, address, amount, and network are required\" });\n        return;\n      }\n\n      const transaction = await storage.createTransaction({\n        userId,\n        type: \"withdrawal\",\n        amount: amount.toString(),\n        status: \"pending\",\n      });\n\n      try {\n        const result = await mexcService.withdraw(coin, address, amount.toString(), network, memo);\n        \n        await storage.updateTransactionStatus(transaction.id, \"confirmed\", result.id);\n\n        const shares = await storage.getUserShares(userId);\n        if (shares) {\n          const newDeposited = Math.max(0, parseFloat(shares.totalDeposited) - parseFloat(amount)).toString();\n          const newShares = Math.max(0, parseFloat(shares.totalShares) - parseFloat(amount)).toString();\n          await storage.updateUserShares(userId, {\n            totalDeposited: newDeposited,\n            totalShares: newShares,\n            currentValue: newShares,\n          });\n        }\n\n        res.json({ \n          success: true, \n          withdrawId: result.id, \n          transactionId: transaction.id \n        });\n      } catch (withdrawError) {\n        await storage.updateTransactionStatus(transaction.id, \"failed\");\n        throw withdrawError;\n      }\n    } catch (error) {\n      console.error(\"Error processing withdrawal:\", error);\n      res.status(500).json({ message: \"Failed to process withdrawal\" });\n    }\n  });\n\n  // Withdrawal history from MEXC\n  app.get(\"/api/mexc/withdraw/history\", isAuthenticated, async (req, res) => {\n    try {\n      const coin = req.query.coin as string | undefined;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const history = await mexcService.getWithdrawHistory(coin, undefined, undefined, undefined, limit);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching withdrawal history:\", error);\n      res.status(500).json({ message: \"Failed to fetch withdrawal history\" });\n    }\n  });\n\n  // Sync market data from MEXC\n  app.post(\"/api/mexc/sync-market\", async (req, res) => {\n    try {\n      const marketDataFromMexc = await mexcService.syncMarketData();\n      \n      for (const item of marketDataFromMexc) {\n        await storage.upsertMarketData({\n          symbol: item.symbol,\n          price: item.price,\n          change24h: item.data.priceChange,\n          changePercent24h: item.data.priceChangePercent,\n          volume24h: item.data.quoteVolume,\n          high24h: item.data.highPrice,\n          low24h: item.data.lowPrice,\n        });\n      }\n      \n      res.json({ success: true, updated: marketDataFromMexc.length });\n    } catch (error) {\n      console.error(\"Error syncing market data:\", error);\n      res.status(500).json({ message: \"Failed to sync market data\" });\n    }\n  });\n\n  // Reconcile deposits from MEXC - syncs external deposit history with local transactions\n  app.post(\"/api/mexc/reconcile/deposits\", isAuthenticated, async (req, res) => {\n    try {\n      const depositHistory = await mexcService.getDepositHistory(undefined, undefined, undefined, undefined, 100);\n      \n      let created = 0;\n      let updated = 0;\n      let skipped = 0;\n\n      for (const deposit of depositHistory) {\n        const existingTx = await storage.getTransactionByTxHash(deposit.txId);\n        \n        if (existingTx) {\n          const mexcStatus = deposit.status === 1 ? \"confirmed\" : deposit.status === 0 ? \"pending\" : \"failed\";\n          \n          if (existingTx.status !== mexcStatus) {\n            await storage.updateTransactionStatus(existingTx.id, mexcStatus, deposit.txId);\n            \n            if (mexcStatus === \"confirmed\" && existingTx.status === \"pending\") {\n              const shares = await storage.getUserShares(existingTx.userId);\n              if (shares) {\n                const newDeposited = (parseFloat(shares.totalDeposited) + parseFloat(existingTx.amount)).toString();\n                const newShares = (parseFloat(shares.totalShares) + parseFloat(existingTx.amount)).toString();\n                await storage.updateUserShares(existingTx.userId, {\n                  totalDeposited: newDeposited,\n                  totalShares: newShares,\n                  currentValue: newShares,\n                });\n              }\n            }\n            updated++;\n          } else {\n            skipped++;\n          }\n        } else {\n          const walletAddress = await storage.getWalletAddressByAddress(deposit.address);\n          \n          if (walletAddress) {\n            const status = deposit.status === 1 ? \"confirmed\" : deposit.status === 0 ? \"pending\" : \"failed\";\n            \n            await storage.createTransaction({\n              userId: walletAddress.userId,\n              type: \"deposit\",\n              amount: deposit.amount,\n              status: status,\n              txHash: deposit.txId,\n            });\n            \n            if (status === \"confirmed\") {\n              const shares = await storage.getUserShares(walletAddress.userId);\n              if (shares) {\n                const newDeposited = (parseFloat(shares.totalDeposited) + parseFloat(deposit.amount)).toString();\n                const newShares = (parseFloat(shares.totalShares) + parseFloat(deposit.amount)).toString();\n                await storage.updateUserShares(walletAddress.userId, {\n                  totalDeposited: newDeposited,\n                  totalShares: newShares,\n                  currentValue: newShares,\n                });\n              }\n            }\n            \n            created++;\n          } else {\n            skipped++;\n          }\n        }\n      }\n\n      res.json({ success: true, created, updated, skipped, total: depositHistory.length });\n    } catch (error) {\n      console.error(\"Error reconciling deposits:\", error);\n      res.status(500).json({ message: \"Failed to reconcile deposits\" });\n    }\n  });\n\n  // Reconcile withdrawals from MEXC - syncs external withdrawal history with local transactions\n  app.post(\"/api/mexc/reconcile/withdrawals\", isAuthenticated, async (req, res) => {\n    try {\n      const withdrawHistory = await mexcService.getWithdrawHistory(undefined, undefined, undefined, undefined, 100);\n      \n      let updated = 0;\n      let skipped = 0;\n\n      for (const withdrawal of withdrawHistory) {\n        const existingTx = await storage.getTransactionByTxHash(withdrawal.id);\n        \n        if (existingTx) {\n          let mexcStatus = \"pending\";\n          switch (withdrawal.status) {\n            case \"CONFIRMED\":\n            case \"SUCCESS\":\n              mexcStatus = \"confirmed\";\n              break;\n            case \"CANCELLED\":\n            case \"FAILED\":\n              mexcStatus = \"failed\";\n              break;\n            default:\n              mexcStatus = \"pending\";\n          }\n          \n          if (existingTx.status !== mexcStatus) {\n            await storage.updateTransactionStatus(existingTx.id, mexcStatus, withdrawal.txId || withdrawal.id);\n            updated++;\n          } else {\n            skipped++;\n          }\n        } else {\n          skipped++;\n        }\n      }\n\n      res.json({ success: true, updated, skipped, total: withdrawHistory.length });\n    } catch (error) {\n      console.error(\"Error reconciling withdrawals:\", error);\n      res.status(500).json({ message: \"Failed to reconcile withdrawals\" });\n    }\n  });\n\n  // Update transaction status\n  app.patch(\"/api/transactions/:id/status\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { status, txHash } = req.body;\n      \n      if (!status) {\n        res.status(400).json({ message: \"Status is required\" });\n        return;\n      }\n\n      const updated = await storage.updateTransactionStatus(id, status, txHash);\n      if (!updated) {\n        res.status(404).json({ message: \"Transaction not found\" });\n        return;\n      }\n\n      if (status === \"confirmed\" && updated.type === \"deposit\") {\n        const shares = await storage.getUserShares(updated.userId);\n        if (shares) {\n          const newDeposited = (parseFloat(shares.totalDeposited) + parseFloat(updated.amount)).toString();\n          const newShares = (parseFloat(shares.totalShares) + parseFloat(updated.amount)).toString();\n          await storage.updateUserShares(updated.userId, {\n            totalDeposited: newDeposited,\n            totalShares: newShares,\n            currentValue: newShares,\n          });\n        }\n      }\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating transaction status:\", error);\n      res.status(500).json({ message: \"Failed to update transaction status\" });\n    }\n  });\n\n  // SMC (Smart Money Concepts) endpoints\n  app.get(\"/api/smc/killzones\", async (req, res) => {\n    try {\n      const killZones = smcService.getActiveKillZones();\n      const activeKillZone = killZones.find((kz) => kz.isActive) || null;\n      res.json({ killZones, activeKillZone });\n    } catch (error) {\n      console.error(\"Error fetching kill zones:\", error);\n      res.status(500).json({ message: \"Failed to fetch kill zones\" });\n    }\n  });\n\n  app.post(\"/api/smc/analyze\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol, candles } = req.body;\n      \n      if (!symbol) {\n        res.status(400).json({ message: \"Symbol is required\" });\n        return;\n      }\n\n      let candleData: Candle[] = candles || [];\n      let dataSource: \"live\" | \"cache\" | \"stale_cache\" | \"provided\" = \"provided\";\n      let cacheAge: number | undefined;\n      \n      if (!candleData || candleData.length === 0) {\n        try {\n          const klinesResult = await fetchKlinesWithRetry(symbol);\n          candleData = klinesResult.candles;\n          dataSource = klinesResult.source;\n          cacheAge = klinesResult.cacheAge;\n        } catch (klineError) {\n          console.error(\"Failed to fetch klines from MEXC:\", klineError);\n          res.status(503).json({ \n            message: \"Failed to fetch market data from MEXC\",\n            degraded: true,\n            suggestion: \"Please try again in a moment or select a different symbol\"\n          });\n          return;\n        }\n      }\n\n      if (candleData.length < 10) {\n        res.status(400).json({ message: \"Insufficient candle data for analysis\" });\n        return;\n      }\n\n      const analysis = await analyzeSMC(symbol.toUpperCase(), candleData);\n      const signal = generateSMCSignal(analysis);\n      \n      res.json({ \n        analysis, \n        signal,\n        dataSource,\n        degraded: dataSource === \"stale_cache\",\n        ...(cacheAge !== undefined && { cacheAge })\n      });\n    } catch (error) {\n      console.error(\"Error analyzing SMC:\", error);\n      res.status(500).json({ message: \"Failed to analyze SMC\" });\n    }\n  });\n\n  app.post(\"/api/smc/signal\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol, candles } = req.body;\n      \n      if (!symbol) {\n        res.status(400).json({ message: \"Symbol is required\" });\n        return;\n      }\n\n      let candleData: Candle[] = candles || [];\n      let dataSource: \"live\" | \"cache\" | \"stale_cache\" | \"provided\" = \"provided\";\n      let cacheAge: number | undefined;\n      \n      if (!candleData || candleData.length === 0) {\n        try {\n          const klinesResult = await fetchKlinesWithRetry(symbol);\n          candleData = klinesResult.candles;\n          dataSource = klinesResult.source;\n          cacheAge = klinesResult.cacheAge;\n        } catch (klineError) {\n          console.error(\"Failed to fetch klines from MEXC:\", klineError);\n          res.status(503).json({ \n            message: \"Failed to fetch market data from MEXC\",\n            degraded: true,\n            suggestion: \"Please try again in a moment or select a different symbol\"\n          });\n          return;\n        }\n      }\n\n      if (candleData.length < 10) {\n        res.status(400).json({ message: \"Insufficient candle data for analysis\" });\n        return;\n      }\n\n      const analysis = await analyzeSMC(symbol.toUpperCase(), candleData);\n      const signal = generateSMCSignal(analysis);\n      \n      res.json({\n        ...signal,\n        dataSource,\n        degraded: dataSource === \"stale_cache\",\n        ...(cacheAge !== undefined && { cacheAge })\n      });\n    } catch (error) {\n      console.error(\"Error generating SMC signal:\", error);\n      res.status(500).json({ message: \"Failed to generate SMC signal\" });\n    }\n  });\n\n  // RL (Reinforcement Learning) Agent endpoints\n  app.get(\"/api/rl/agents\", async (req, res) => {\n    try {\n      const agents = await storage.getAllRlAgentConfigs();\n      res.json(agents);\n    } catch (error) {\n      console.error(\"Error fetching RL agents:\", error);\n      res.status(500).json({ message: \"Failed to fetch RL agents\" });\n    }\n  });\n\n  app.get(\"/api/rl/agent/:symbol\", async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const config = await storage.getRlAgentConfig(symbol);\n      \n      if (!config) {\n        res.status(404).json({ message: \"RL agent not found for this symbol\" });\n        return;\n      }\n\n      const qTable = config.qTable as Record<string, { buy: number; sell: number; hold: number }> | undefined;\n      const statesLearned = qTable ? Object.keys(qTable).length : 0;\n      \n      const stats = {\n        totalEpisodes: config.totalEpisodes ?? 0,\n        totalReward: config.totalReward ? parseFloat(config.totalReward) : 0,\n        avgReward: config.avgReward ? parseFloat(config.avgReward) : 0,\n        explorationRate: config.explorationRate ? parseFloat(config.explorationRate) : 0.1,\n        statesLearned,\n      };\n      \n      res.json({ config, stats });\n    } catch (error) {\n      console.error(\"Error fetching RL agent:\", error);\n      res.status(500).json({ message: \"Failed to fetch RL agent\" });\n    }\n  });\n\n  app.post(\"/api/rl/agent\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol, learningRate, discountFactor, explorationRate, explorationDecay, minExploration, batchSize, memorySize } = req.body;\n      \n      if (!symbol) {\n        res.status(400).json({ message: \"Symbol is required\" });\n        return;\n      }\n\n      const existing = await storage.getRlAgentConfig(symbol);\n      if (existing) {\n        res.status(400).json({ message: \"RL agent already exists for this symbol\" });\n        return;\n      }\n\n      const config = await storage.createRlAgentConfig({\n        symbol: symbol.toUpperCase(),\n        isActive: false,\n        learningRate: learningRate?.toString() || \"0.001\",\n        discountFactor: discountFactor?.toString() || \"0.95\",\n        explorationRate: explorationRate?.toString() || \"0.1\",\n        explorationDecay: explorationDecay?.toString() || \"0.995\",\n        minExploration: minExploration?.toString() || \"0.01\",\n        batchSize: batchSize || 32,\n        memorySize: memorySize || 10000,\n      });\n\n      getOrCreateAgent(symbol, {\n        learningRate: learningRate || 0.001,\n        discountFactor: discountFactor || 0.95,\n        explorationRate: explorationRate || 0.1,\n        explorationDecay: explorationDecay || 0.995,\n        minExploration: minExploration || 0.01,\n        batchSize: batchSize || 32,\n        memorySize: memorySize || 10000,\n      });\n\n      res.json(config);\n    } catch (error) {\n      console.error(\"Error creating RL agent:\", error);\n      res.status(500).json({ message: \"Failed to create RL agent\" });\n    }\n  });\n\n  app.patch(\"/api/rl/agent/:symbol\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const { isActive, learningRate, discountFactor, explorationRate } = req.body;\n\n      const updateData: Record<string, unknown> = {};\n      if (isActive !== undefined) updateData.isActive = isActive;\n      if (learningRate !== undefined) updateData.learningRate = learningRate.toString();\n      if (discountFactor !== undefined) updateData.discountFactor = discountFactor.toString();\n      if (explorationRate !== undefined) updateData.explorationRate = explorationRate.toString();\n\n      const updated = await storage.updateRlAgentConfig(symbol, updateData);\n      if (!updated) {\n        res.status(404).json({ message: \"RL agent not found\" });\n        return;\n      }\n\n      const agent = getOrCreateAgent(symbol);\n      agent.setConfig({\n        learningRate: learningRate,\n        discountFactor: discountFactor,\n        explorationRate: explorationRate,\n      });\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating RL agent:\", error);\n      res.status(500).json({ message: \"Failed to update RL agent\" });\n    }\n  });\n\n  app.post(\"/api/rl/train/:symbol\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const { episodes = 1, initialCapital = 10000 } = req.body;\n\n      let config = await storage.getRlAgentConfig(symbol);\n      if (!config) {\n        config = await storage.createRlAgentConfig({\n          symbol: symbol.toUpperCase(),\n          isActive: false,\n        });\n      }\n\n      const agent = getOrCreateAgent(\n        symbol,\n        {\n          learningRate: config.learningRate ? parseFloat(config.learningRate) : undefined,\n          discountFactor: config.discountFactor ? parseFloat(config.discountFactor) : undefined,\n          explorationRate: config.explorationRate ? parseFloat(config.explorationRate) : undefined,\n        },\n        config.qTable as Record<string, { buy: number; sell: number; hold: number }> | undefined\n      );\n\n      let klinesResult;\n      try {\n        klinesResult = await fetchKlinesWithRetry(symbol);\n      } catch (klineError) {\n        console.error(\"Failed to fetch klines from MEXC:\", klineError);\n        res.status(503).json({ \n          message: \"Failed to fetch market data for training\",\n          suggestion: \"Please try again in a moment\"\n        });\n        return;\n      }\n\n      const candles = klinesResult.candles;\n      if (candles.length < 50) {\n        res.status(400).json({ message: \"Insufficient market data for training (need at least 50 candles)\" });\n        return;\n      }\n\n      const results = [];\n      for (let i = 0; i < episodes; i++) {\n        const result = agent.train(candles, initialCapital);\n        \n        await storage.createRlTrainingEpisode({\n          agentId: config.id,\n          episodeNumber: result.episodeNumber,\n          startingCapital: result.startingCapital.toString(),\n          endingCapital: result.endingCapital.toString(),\n          totalReward: result.totalReward.toString(),\n          totalActions: result.totalActions,\n          buyActions: result.buyActions,\n          sellActions: result.sellActions,\n          holdActions: result.holdActions,\n          profitLoss: result.profitLoss.toString(),\n          profitLossPercent: result.profitLossPercent.toString(),\n          maxDrawdown: result.maxDrawdown.toString(),\n          winRate: result.winRate.toString(),\n          explorationRate: result.explorationRate.toString(),\n        });\n\n        results.push(result);\n      }\n\n      const stats = agent.getStats();\n      const qTable = agent.getQTable();\n      \n      await storage.updateRlAgentConfig(symbol, {\n        qTable: qTable as unknown as Record<string, unknown>,\n        totalEpisodes: stats.totalEpisodes,\n        totalReward: stats.totalReward.toString(),\n        avgReward: stats.avgReward.toString(),\n        explorationRate: stats.explorationRate.toString(),\n      });\n\n      res.json({ \n        results, \n        stats,\n        dataSource: klinesResult.source,\n      });\n    } catch (error) {\n      console.error(\"Error training RL agent:\", error);\n      res.status(500).json({ message: \"Failed to train RL agent\" });\n    }\n  });\n\n  app.post(\"/api/rl/predict/:symbol\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol } = req.params;\n\n      const config = await storage.getRlAgentConfig(symbol);\n      if (!config) {\n        res.status(404).json({ message: \"RL agent not found. Create and train an agent first.\" });\n        return;\n      }\n\n      const agent = getOrCreateAgent(\n        symbol,\n        undefined,\n        config.qTable as Record<string, { buy: number; sell: number; hold: number }> | undefined\n      );\n\n      let klinesResult;\n      try {\n        klinesResult = await fetchKlinesWithRetry(symbol);\n      } catch (klineError) {\n        console.error(\"Failed to fetch klines from MEXC:\", klineError);\n        res.status(503).json({ \n          message: \"Failed to fetch market data for prediction\",\n          suggestion: \"Please try again in a moment\"\n        });\n        return;\n      }\n\n      const candles = klinesResult.candles;\n      if (candles.length < 30) {\n        res.status(400).json({ message: \"Insufficient market data for prediction\" });\n        return;\n      }\n\n      const prediction = agent.predict(candles);\n      const currentPrice = candles[candles.length - 1].close;\n\n      const decision = await storage.createRlDecision({\n        agentId: config.id,\n        symbol: symbol.toUpperCase(),\n        action: prediction.action,\n        confidence: prediction.confidence.toString(),\n        stateFeatures: prediction.stateFeatures as unknown as Record<string, unknown>,\n        qValues: prediction.qValues as unknown as Record<string, unknown>,\n        price: currentPrice.toString(),\n        wasExecuted: false,\n      });\n\n      res.json({\n        prediction,\n        decision,\n        currentPrice,\n        dataSource: klinesResult.source,\n      });\n    } catch (error) {\n      console.error(\"Error getting RL prediction:\", error);\n      res.status(500).json({ message: \"Failed to get RL prediction\" });\n    }\n  });\n\n  app.get(\"/api/rl/episodes/:symbol\", async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n\n      const config = await storage.getRlAgentConfig(symbol);\n      if (!config) {\n        res.status(404).json({ message: \"RL agent not found\" });\n        return;\n      }\n\n      const episodes = await storage.getRlTrainingEpisodes(config.id, limit);\n      res.json(episodes);\n    } catch (error) {\n      console.error(\"Error fetching training episodes:\", error);\n      res.status(500).json({ message: \"Failed to fetch training episodes\" });\n    }\n  });\n\n  app.get(\"/api/rl/decisions/:symbol\", async (req, res) => {\n    try {\n      const { symbol } = req.params;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n\n      const config = await storage.getRlAgentConfig(symbol);\n      if (!config) {\n        res.status(404).json({ message: \"RL agent not found\" });\n        return;\n      }\n\n      const decisions = await storage.getRlDecisions(config.id, limit);\n      res.json(decisions);\n    } catch (error) {\n      console.error(\"Error fetching RL decisions:\", error);\n      res.status(500).json({ message: \"Failed to fetch RL decisions\" });\n    }\n  });\n\n  app.post(\"/api/rl/reset/:symbol\", isAuthenticated, async (req, res) => {\n    try {\n      const { symbol } = req.params;\n\n      const config = await storage.getRlAgentConfig(symbol);\n      if (!config) {\n        res.status(404).json({ message: \"RL agent not found\" });\n        return;\n      }\n\n      resetAgent(symbol);\n\n      const updated = await storage.updateRlAgentConfig(symbol, {\n        qTable: null as unknown as Record<string, unknown>,\n        totalEpisodes: 0,\n        totalReward: \"0\",\n        avgReward: \"0\",\n        explorationRate: \"0.1\",\n      });\n\n      res.json({ message: \"RL agent reset successfully\", config: updated });\n    } catch (error) {\n      console.error(\"Error resetting RL agent:\", error);\n      res.status(500).json({ message: \"Failed to reset RL agent\" });\n    }\n  });\n\n  // Telegram notification endpoints\n  app.get(\"/api/telegram/status\", async (req, res) => {\n    try {\n      res.json({\n        enabled: telegramService.isEnabled(),\n        botUsername: telegramService.getBotUsername(),\n      });\n    } catch (error) {\n      console.error(\"Error getting Telegram status:\", error);\n      res.status(500).json({ message: \"Failed to get Telegram status\" });\n    }\n  });\n\n  app.get(\"/api/telegram/settings\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      let settings = await storage.getNotificationSettings(userId);\n      \n      if (!settings) {\n        settings = await storage.createNotificationSettings({\n          userId,\n          telegramChatId: null,\n          telegramEnabled: false,\n          emailEnabled: false,\n          tradeNotifications: true,\n          depositNotifications: true,\n          withdrawalNotifications: true,\n          aiSignalNotifications: true,\n        });\n      }\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching notification settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification settings\" });\n    }\n  });\n\n  app.patch(\"/api/telegram/settings\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const data = insertNotificationSettingsSchema.partial().parse(req.body);\n      \n      const settings = await storage.updateNotificationSettings(userId, data);\n      res.json(settings);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n        return;\n      }\n      console.error(\"Error updating notification settings:\", error);\n      res.status(500).json({ message: \"Failed to update notification settings\" });\n    }\n  });\n\n  app.post(\"/api/telegram/subscribe\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { chatId } = req.body;\n\n      if (!chatId) {\n        res.status(400).json({ message: \"Chat ID is required\" });\n        return;\n      }\n\n      const settings = await storage.updateNotificationSettings(userId, {\n        telegramChatId: chatId,\n        telegramEnabled: true,\n      });\n\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error subscribing to Telegram:\", error);\n      res.status(500).json({ message: \"Failed to subscribe to Telegram\" });\n    }\n  });\n\n  app.post(\"/api/telegram/unsubscribe\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n\n      const settings = await storage.updateNotificationSettings(userId, {\n        telegramChatId: null,\n        telegramEnabled: false,\n      });\n\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error unsubscribing from Telegram:\", error);\n      res.status(500).json({ message: \"Failed to unsubscribe from Telegram\" });\n    }\n  });\n\n  app.post(\"/api/telegram/test\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const settings = await storage.getNotificationSettings(userId);\n\n      if (!settings?.telegramChatId) {\n        res.status(400).json({ message: \"Telegram not connected. Please connect your Telegram first.\" });\n        return;\n      }\n\n      if (!telegramService.isEnabled()) {\n        res.status(503).json({ message: \"Telegram bot is not configured. Please contact administrator.\" });\n        return;\n      }\n\n      const success = await telegramService.sendTestNotification(settings.telegramChatId);\n      \n      if (success) {\n        res.json({ success: true, message: \"Test notification sent successfully\" });\n      } else {\n        res.status(500).json({ message: \"Failed to send test notification\" });\n      }\n    } catch (error) {\n      console.error(\"Error sending test notification:\", error);\n      res.status(500).json({ message: \"Failed to send test notification\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":46058,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4370,"size_tokens":null},"client/src/pages/portfolio.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { UserPortfolio } from \"@/components/user-portfolio\";\nimport { TransactionsList } from \"@/components/transactions-list\";\nimport { PortfolioChart } from \"@/components/portfolio-chart\";\nimport { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from \"recharts\";\nimport { Wallet, TrendingUp, TrendingDown, ArrowUpCircle, ArrowDownCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { UserShares, Transaction, PortfolioHistory, MarketData } from \"@shared/schema\";\n\nconst CHART_COLORS = [\n  \"hsl(var(--chart-1))\",\n  \"hsl(var(--chart-2))\",\n  \"hsl(var(--chart-3))\",\n  \"hsl(var(--chart-4))\",\n  \"hsl(var(--chart-5))\",\n];\n\nexport default function Portfolio() {\n  const { data: userShares, isLoading: loadingShares } = useQuery<UserShares>({\n    queryKey: [\"/api/user/shares\"],\n  });\n\n  const { data: transactions = [], isLoading: loadingTx } = useQuery<Transaction[]>({\n    queryKey: [\"/api/user/transactions\"],\n  });\n\n  const { data: portfolioHistory = [], isLoading: loadingHistory } = useQuery<PortfolioHistory[]>({\n    queryKey: [\"/api/portfolio/history\"],\n  });\n\n  const { data: poolStats } = useQuery<{ totalValue: number; totalShares: number; pricePerShare: number }>({\n    queryKey: [\"/api/pool/stats\"],\n  });\n\n  const { data: marketData = [] } = useQuery<MarketData[]>({\n    queryKey: [\"/api/market\"],\n  });\n\n  const totalDeposited = userShares?.totalDeposited ? parseFloat(userShares.totalDeposited) : 0;\n  const currentValue = userShares?.currentValue ? parseFloat(userShares.currentValue) : 0;\n  const profitLoss = userShares?.profitLoss ? parseFloat(userShares.profitLoss) : 0;\n  const profitLossPercent = userShares?.profitLossPercent ? parseFloat(userShares.profitLossPercent) : 0;\n\n  const allocationData = marketData.slice(0, 5).map((item, index) => ({\n    name: item.symbol,\n    value: Math.random() * 30 + 10,\n    color: CHART_COLORS[index % CHART_COLORS.length],\n  }));\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  const totalDeposits = transactions\n    .filter(t => t.type === \"deposit\" && t.status === \"confirmed\")\n    .reduce((sum, t) => sum + parseFloat(t.amount), 0);\n\n  const totalWithdrawals = transactions\n    .filter(t => t.type === \"withdrawal\" && t.status === \"confirmed\")\n    .reduce((sum, t) => sum + parseFloat(t.amount), 0);\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">المحفظة</h1>\n          <p className=\"text-muted-foreground text-sm\">تفاصيل استثماراتك وحصصك</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card data-testid=\"card-deposited\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-primary/10\">\n                <ArrowUpCircle className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إجمالي الإيداعات</p>\n                <p className=\"text-xl font-bold\" dir=\"ltr\">{formatCurrency(totalDeposits)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-withdrawals\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-destructive/10\">\n                <ArrowDownCircle className=\"w-5 h-5 text-destructive\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">إجمالي السحوبات</p>\n                <p className=\"text-xl font-bold\" dir=\"ltr\">{formatCurrency(totalWithdrawals)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-current-value\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-3 rounded-md bg-muted\">\n                <Wallet className=\"w-5 h-5 text-foreground\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">القيمة الحالية</p>\n                <p className=\"text-xl font-bold\" dir=\"ltr\">{formatCurrency(currentValue)}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-profit-loss\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className={cn(\n                \"p-3 rounded-md\",\n                profitLoss >= 0 ? \"bg-success/10\" : \"bg-destructive/10\"\n              )}>\n                {profitLoss >= 0 ? (\n                  <TrendingUp className=\"w-5 h-5 text-success\" />\n                ) : (\n                  <TrendingDown className=\"w-5 h-5 text-destructive\" />\n                )}\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">الربح / الخسارة</p>\n                <p className={cn(\n                  \"text-xl font-bold\",\n                  profitLoss >= 0 ? \"text-success\" : \"text-destructive\"\n                )} dir=\"ltr\">\n                  {profitLoss >= 0 && \"+\"}{formatCurrency(profitLoss)}\n                  <span className=\"text-sm font-normal mr-1\">({profitLossPercent.toFixed(2)}%)</span>\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <PortfolioChart data={portfolioHistory} isLoading={loadingHistory} />\n\n          <Card data-testid=\"card-allocation\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">توزيع الأصول</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {allocationData.length === 0 ? (\n                <div className=\"h-[250px] flex items-center justify-center text-muted-foreground\">\n                  لا توجد بيانات متاحة\n                </div>\n              ) : (\n                <div className=\"h-[250px]\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <PieChart>\n                      <Pie\n                        data={allocationData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        innerRadius={60}\n                        outerRadius={100}\n                        paddingAngle={2}\n                        dataKey=\"value\"\n                      >\n                        {allocationData.map((entry, index) => (\n                          <Cell key={`cell-${index}`} fill={entry.color} />\n                        ))}\n                      </Pie>\n                      <Tooltip\n                        content={({ active, payload }) => {\n                          if (active && payload && payload.length) {\n                            return (\n                              <div className=\"bg-popover border border-popover-border rounded-md p-2 shadow-lg\">\n                                <p className=\"text-sm font-medium\">{payload[0].name}</p>\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {(payload[0].value as number).toFixed(1)}%\n                                </p>\n                              </div>\n                            );\n                          }\n                          return null;\n                        }}\n                      />\n                      <Legend \n                        verticalAlign=\"middle\" \n                        align=\"left\"\n                        layout=\"vertical\"\n                        wrapperStyle={{ paddingRight: 20 }}\n                      />\n                    </PieChart>\n                  </ResponsiveContainer>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <UserPortfolio \n            shares={userShares || null} \n            isLoading={loadingShares}\n            totalPoolValue={poolStats?.totalValue}\n          />\n          <TransactionsList transactions={transactions} isLoading={loadingTx} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8702,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Portfolio from \"@/pages/portfolio\";\nimport Trades from \"@/pages/trades\";\nimport Market from \"@/pages/market\";\nimport AiAnalysis from \"@/pages/ai-analysis\";\nimport Stats from \"@/pages/stats\";\nimport Settings from \"@/pages/settings\";\nimport Wallet from \"@/pages/wallet\";\nimport SMCAnalysis from \"@/pages/smc-analysis\";\nimport RLAgent from \"@/pages/rl-agent\";\nimport TelegramNotifications from \"@/pages/telegram\";\n\nfunction AuthenticatedRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/portfolio\" component={Portfolio} />\n      <Route path=\"/wallet\" component={Wallet} />\n      <Route path=\"/trades\" component={Trades} />\n      <Route path=\"/market\" component={Market} />\n      <Route path=\"/ai-analysis\" component={AiAnalysis} />\n      <Route path=\"/smc-analysis\" component={SMCAnalysis} />\n      <Route path=\"/rl-agent\" component={RLAgent} />\n      <Route path=\"/telegram\" component={TelegramNotifications} />\n      <Route path=\"/stats\" component={Stats} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AuthenticatedLayout() {\n  const style = {\n    \"--sidebar-width\": \"18rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\" dir=\"rtl\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 min-w-0\">\n          <header className=\"flex items-center justify-between gap-4 p-3 border-b border-border sticky top-0 z-50 bg-background\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <ThemeToggle />\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            <AuthenticatedRouter />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\" dir=\"rtl\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">جاري التحميل...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <Landing />;\n  }\n\n  return <AuthenticatedLayout />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <AppContent />\n          <Toaster />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3391,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/components/portfolio-chart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  CartesianGrid,\n} from \"recharts\";\nimport { useState } from \"react\";\nimport type { PortfolioHistory } from \"@shared/schema\";\n\ninterface PortfolioChartProps {\n  data: PortfolioHistory[];\n  isLoading?: boolean;\n}\n\nconst timeRanges = [\n  { label: \"24س\", value: \"1d\" },\n  { label: \"7أ\", value: \"7d\" },\n  { label: \"30ي\", value: \"30d\" },\n  { label: \"90ي\", value: \"90d\" },\n  { label: \"سنة\", value: \"1y\" },\n];\n\nexport function PortfolioChart({ data, isLoading }: PortfolioChartProps) {\n  const [selectedRange, setSelectedRange] = useState(\"7d\");\n\n  const chartData = data.map((item) => ({\n    date: new Date(item.recordedAt!).toLocaleDateString(\"ar-SA\", {\n      month: \"short\",\n      day: \"numeric\",\n    }),\n    value: parseFloat(item.totalValue),\n    pricePerShare: parseFloat(item.pricePerShare),\n  }));\n\n  const formatValue = (value: number) => {\n    return new Intl.NumberFormat(\"ar-SA\", {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: 2,\n    }).format(value);\n  };\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-popover border border-popover-border rounded-md p-3 shadow-lg\">\n          <p className=\"text-sm text-muted-foreground mb-1\">{label}</p>\n          <p className=\"text-lg font-bold\" dir=\"ltr\">\n            {formatValue(payload[0].value)}\n          </p>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            سعر الحصة: <span dir=\"ltr\">${payload[0].payload.pricePerShare.toFixed(4)}</span>\n          </p>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <Card data-testid=\"card-portfolio-chart\">\n      <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-2\">\n        <CardTitle className=\"text-lg\">أداء المحفظة</CardTitle>\n        <div className=\"flex gap-1\">\n          {timeRanges.map((range) => (\n            <Button\n              key={range.value}\n              variant={selectedRange === range.value ? \"default\" : \"ghost\"}\n              size=\"sm\"\n              onClick={() => setSelectedRange(range.value)}\n              data-testid={`button-range-${range.value}`}\n            >\n              {range.label}\n            </Button>\n          ))}\n        </div>\n      </CardHeader>\n      <CardContent className=\"h-[300px]\">\n        {isLoading ? (\n          <div className=\"h-full flex items-center justify-center\">\n            <div className=\"animate-pulse text-muted-foreground\">جاري التحميل...</div>\n          </div>\n        ) : chartData.length === 0 ? (\n          <div className=\"h-full flex items-center justify-center\">\n            <p className=\"text-muted-foreground\">لا توجد بيانات متاحة</p>\n          </div>\n        ) : (\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <AreaChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n              <defs>\n                <linearGradient id=\"colorValue\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                  <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3} />\n                  <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0} />\n                </linearGradient>\n              </defs>\n              <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n              <XAxis\n                dataKey=\"date\"\n                tick={{ fontSize: 12 }}\n                tickLine={false}\n                axisLine={false}\n                className=\"fill-muted-foreground\"\n              />\n              <YAxis\n                tick={{ fontSize: 12 }}\n                tickLine={false}\n                axisLine={false}\n                tickFormatter={(value) => `$${value.toLocaleString()}`}\n                className=\"fill-muted-foreground\"\n                orientation=\"left\"\n              />\n              <Tooltip content={<CustomTooltip />} />\n              <Area\n                type=\"monotone\"\n                dataKey=\"value\"\n                stroke=\"hsl(var(--primary))\"\n                strokeWidth={2}\n                fill=\"url(#colorValue)\"\n              />\n            </AreaChart>\n          </ResponsiveContainer>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4468,"size_tokens":null},"client/src/components/trades-table.tsx":{"content":"import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport type { Trade } from \"@shared/schema\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\n\ninterface TradesTableProps {\n  trades: Trade[];\n  isLoading?: boolean;\n  showAll?: boolean;\n}\n\nconst strategyLabels: Record<string, string> = {\n  RSI: \"مؤشر RSI\",\n  MACD: \"MACD\",\n  AI_SENTIMENT: \"تحليل الذكاء الاصطناعي\",\n  MOVING_AVERAGES: \"المتوسطات المتحركة\",\n  MANUAL: \"يدوي\",\n};\n\nexport function TradesTable({ trades, isLoading, showAll = false }: TradesTableProps) {\n  const displayedTrades = showAll ? trades : trades.slice(0, 5);\n\n  const formatDate = (date: Date | string | null) => {\n    if (!date) return \"-\";\n    return new Date(date).toLocaleDateString(\"ar-SA\", {\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const formatNumber = (value: string | null, decimals = 2) => {\n    if (!value) return \"-\";\n    return parseFloat(value).toLocaleString(\"en-US\", {\n      minimumFractionDigits: decimals,\n      maximumFractionDigits: decimals,\n    });\n  };\n\n  return (\n    <Card data-testid=\"card-trades-table\">\n      <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n        <CardTitle className=\"text-lg\">آخر التداولات</CardTitle>\n        {!showAll && trades.length > 5 && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {trades.length} تداول\n          </Badge>\n        )}\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        {isLoading ? (\n          <div className=\"p-8 text-center text-muted-foreground\">\n            جاري التحميل...\n          </div>\n        ) : displayedTrades.length === 0 ? (\n          <div className=\"p-8 text-center text-muted-foreground\">\n            لا توجد تداولات حتى الآن\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-right\">التاريخ</TableHead>\n                  <TableHead className=\"text-right\">الزوج</TableHead>\n                  <TableHead className=\"text-right\">النوع</TableHead>\n                  <TableHead className=\"text-left\">الكمية</TableHead>\n                  <TableHead className=\"text-left\">السعر</TableHead>\n                  <TableHead className=\"text-left\">الإجمالي</TableHead>\n                  <TableHead className=\"text-left\">الربح/الخسارة</TableHead>\n                  <TableHead className=\"text-right\">الاستراتيجية</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {displayedTrades.map((trade) => {\n                  const profitLoss = trade.profitLoss ? parseFloat(trade.profitLoss) : 0;\n                  const isProfit = profitLoss > 0;\n                  const isLoss = profitLoss < 0;\n\n                  return (\n                    <TableRow key={trade.id} data-testid={`row-trade-${trade.id}`}>\n                      <TableCell className=\"text-muted-foreground text-sm\">\n                        {formatDate(trade.createdAt)}\n                      </TableCell>\n                      <TableCell className=\"font-medium\" dir=\"ltr\">\n                        {trade.pair}\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant={trade.type === \"buy\" ? \"default\" : \"secondary\"}\n                          className={cn(\n                            trade.type === \"buy\" \n                              ? \"bg-success/20 text-success border-success/30\" \n                              : \"bg-destructive/20 text-destructive border-destructive/30\"\n                          )}\n                        >\n                          {trade.type === \"buy\" ? \"شراء\" : \"بيع\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell dir=\"ltr\" className=\"font-mono text-sm\">\n                        {formatNumber(trade.amount, 6)}\n                      </TableCell>\n                      <TableCell dir=\"ltr\" className=\"font-mono text-sm\">\n                        ${formatNumber(trade.price)}\n                      </TableCell>\n                      <TableCell dir=\"ltr\" className=\"font-mono text-sm\">\n                        ${formatNumber(trade.total)}\n                      </TableCell>\n                      <TableCell>\n                        {trade.profitLoss && (\n                          <div className={cn(\n                            \"flex items-center gap-1\",\n                            isProfit && \"text-success\",\n                            isLoss && \"text-destructive\"\n                          )}>\n                            {isProfit && <TrendingUp className=\"w-3 h-3\" />}\n                            {isLoss && <TrendingDown className=\"w-3 h-3\" />}\n                            <span dir=\"ltr\" className=\"font-mono text-sm\">\n                              {isProfit && \"+\"}${formatNumber(trade.profitLoss)}\n                            </span>\n                          </div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {strategyLabels[trade.strategy || \"\"] || trade.strategy || \"-\"}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":5943,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport {\n  index,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  decimal,\n  integer,\n  boolean,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table for Replit Auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// User shares in the collective pool\nexport const userShares = pgTable(\"user_shares\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  totalShares: decimal(\"total_shares\", { precision: 20, scale: 8 }).default(\"0\").notNull(),\n  totalDeposited: decimal(\"total_deposited\", { precision: 20, scale: 8 }).default(\"0\").notNull(),\n  currentValue: decimal(\"current_value\", { precision: 20, scale: 8 }).default(\"0\").notNull(),\n  profitLoss: decimal(\"profit_loss\", { precision: 20, scale: 8 }).default(\"0\").notNull(),\n  profitLossPercent: decimal(\"profit_loss_percent\", { precision: 10, scale: 4 }).default(\"0\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Deposits and withdrawals\nexport const transactions = pgTable(\"transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  type: varchar(\"type\", { length: 20 }).notNull(), // 'deposit' or 'withdrawal'\n  amount: decimal(\"amount\", { precision: 20, scale: 8 }).notNull(),\n  sharesAtTime: decimal(\"shares_at_time\", { precision: 20, scale: 8 }),\n  pricePerShare: decimal(\"price_per_share\", { precision: 20, scale: 8 }),\n  status: varchar(\"status\", { length: 20 }).default(\"pending\").notNull(), // pending, confirmed, cancelled\n  txHash: varchar(\"tx_hash\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Bot trades history\nexport const trades = pgTable(\"trades\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  pair: varchar(\"pair\", { length: 20 }).notNull(), // BTC/USDT\n  type: varchar(\"type\", { length: 10 }).notNull(), // buy or sell\n  amount: decimal(\"amount\", { precision: 20, scale: 8 }).notNull(),\n  price: decimal(\"price\", { precision: 20, scale: 8 }).notNull(),\n  total: decimal(\"total\", { precision: 20, scale: 8 }).notNull(),\n  fee: decimal(\"fee\", { precision: 20, scale: 8 }).default(\"0\"),\n  profitLoss: decimal(\"profit_loss\", { precision: 20, scale: 8 }),\n  status: varchar(\"status\", { length: 20 }).default(\"completed\").notNull(),\n  strategy: varchar(\"strategy\", { length: 50 }), // RSI, MACD, AI_SENTIMENT\n  aiReason: text(\"ai_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Portfolio metrics over time\nexport const portfolioHistory = pgTable(\"portfolio_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  totalValue: decimal(\"total_value\", { precision: 20, scale: 8 }).notNull(),\n  totalShares: decimal(\"total_shares\", { precision: 20, scale: 8 }).notNull(),\n  pricePerShare: decimal(\"price_per_share\", { precision: 20, scale: 8 }).notNull(),\n  dailyChange: decimal(\"daily_change\", { precision: 10, scale: 4 }).default(\"0\"),\n  dailyChangePercent: decimal(\"daily_change_percent\", { precision: 10, scale: 4 }).default(\"0\"),\n  recordedAt: timestamp(\"recorded_at\").defaultNow(),\n});\n\n// AI Sentiment analysis results\nexport const sentimentAnalysis = pgTable(\"sentiment_analysis\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  sentiment: varchar(\"sentiment\", { length: 20 }).notNull(), // bullish, bearish, neutral\n  score: decimal(\"score\", { precision: 5, scale: 2 }).notNull(), // -100 to 100\n  summary: text(\"summary\"),\n  newsSource: text(\"news_source\"),\n  confidence: decimal(\"confidence\", { precision: 5, scale: 2 }).default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Bot settings and risk management\nexport const botSettings = pgTable(\"bot_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  isActive: boolean(\"is_active\").default(false),\n  maxRiskPercent: decimal(\"max_risk_percent\", { precision: 5, scale: 2 }).default(\"5\"),\n  stopLossPercent: decimal(\"stop_loss_percent\", { precision: 5, scale: 2 }).default(\"3\"),\n  takeProfitPercent: decimal(\"take_profit_percent\", { precision: 5, scale: 2 }).default(\"10\"),\n  maxPositionSize: decimal(\"max_position_size\", { precision: 20, scale: 8 }).default(\"1000\"),\n  tradingPairs: text(\"trading_pairs\").array().default(sql`ARRAY['BTC/USDT', 'ETH/USDT']`),\n  useAiSentiment: boolean(\"use_ai_sentiment\").default(true),\n  useRsi: boolean(\"use_rsi\").default(true),\n  useMacd: boolean(\"use_macd\").default(true),\n  useMovingAverages: boolean(\"use_moving_averages\").default(true),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Market data cache\nexport const marketData = pgTable(\"market_data\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  price: decimal(\"price\", { precision: 20, scale: 8 }).notNull(),\n  change24h: decimal(\"change_24h\", { precision: 10, scale: 4 }),\n  changePercent24h: decimal(\"change_percent_24h\", { precision: 10, scale: 4 }),\n  volume24h: decimal(\"volume_24h\", { precision: 30, scale: 8 }),\n  high24h: decimal(\"high_24h\", { precision: 20, scale: 8 }),\n  low24h: decimal(\"low_24h\", { precision: 20, scale: 8 }),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// MEXC wallet addresses for deposits\nexport const walletAddresses = pgTable(\"wallet_addresses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  coin: varchar(\"coin\", { length: 20 }).notNull(),\n  network: varchar(\"network\", { length: 20 }).notNull(),\n  address: varchar(\"address\", { length: 256 }).notNull(),\n  memo: varchar(\"memo\", { length: 256 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User notification preferences\nexport const notificationSettings = pgTable(\"notification_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id).unique(),\n  telegramChatId: varchar(\"telegram_chat_id\", { length: 100 }),\n  telegramEnabled: boolean(\"telegram_enabled\").default(false),\n  emailEnabled: boolean(\"email_enabled\").default(true),\n  tradeNotifications: boolean(\"trade_notifications\").default(true),\n  depositNotifications: boolean(\"deposit_notifications\").default(true),\n  withdrawalNotifications: boolean(\"withdrawal_notifications\").default(true),\n  aiSignalNotifications: boolean(\"ai_signal_notifications\").default(true),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Backtesting results\nexport const backtestResults = pgTable(\"backtest_results\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  strategyName: varchar(\"strategy_name\", { length: 100 }).notNull(),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  initialCapital: decimal(\"initial_capital\", { precision: 20, scale: 8 }).notNull(),\n  finalCapital: decimal(\"final_capital\", { precision: 20, scale: 8 }).notNull(),\n  totalTrades: integer(\"total_trades\").notNull(),\n  winningTrades: integer(\"winning_trades\").notNull(),\n  losingTrades: integer(\"losing_trades\").notNull(),\n  winRate: decimal(\"win_rate\", { precision: 5, scale: 2 }).notNull(),\n  profitFactor: decimal(\"profit_factor\", { precision: 10, scale: 4 }),\n  maxDrawdown: decimal(\"max_drawdown\", { precision: 10, scale: 4 }),\n  sharpeRatio: decimal(\"sharpe_ratio\", { precision: 10, scale: 4 }),\n  parameters: jsonb(\"parameters\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// RL Agent configuration and state\nexport const rlAgentConfig = pgTable(\"rl_agent_config\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  isActive: boolean(\"is_active\").default(false),\n  learningRate: decimal(\"learning_rate\", { precision: 10, scale: 8 }).default(\"0.001\"),\n  discountFactor: decimal(\"discount_factor\", { precision: 5, scale: 4 }).default(\"0.95\"),\n  explorationRate: decimal(\"exploration_rate\", { precision: 5, scale: 4 }).default(\"0.1\"),\n  explorationDecay: decimal(\"exploration_decay\", { precision: 10, scale: 8 }).default(\"0.995\"),\n  minExploration: decimal(\"min_exploration\", { precision: 5, scale: 4 }).default(\"0.01\"),\n  batchSize: integer(\"batch_size\").default(32),\n  memorySize: integer(\"memory_size\").default(10000),\n  qTable: jsonb(\"q_table\"),\n  totalEpisodes: integer(\"total_episodes\").default(0),\n  totalReward: decimal(\"total_reward\", { precision: 20, scale: 8 }).default(\"0\"),\n  avgReward: decimal(\"avg_reward\", { precision: 20, scale: 8 }).default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// RL Training episodes\nexport const rlTrainingEpisodes = pgTable(\"rl_training_episodes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  agentId: varchar(\"agent_id\").notNull().references(() => rlAgentConfig.id),\n  episodeNumber: integer(\"episode_number\").notNull(),\n  startingCapital: decimal(\"starting_capital\", { precision: 20, scale: 8 }).notNull(),\n  endingCapital: decimal(\"ending_capital\", { precision: 20, scale: 8 }).notNull(),\n  totalReward: decimal(\"total_reward\", { precision: 20, scale: 8 }).notNull(),\n  totalActions: integer(\"total_actions\").notNull(),\n  buyActions: integer(\"buy_actions\").default(0),\n  sellActions: integer(\"sell_actions\").default(0),\n  holdActions: integer(\"hold_actions\").default(0),\n  profitLoss: decimal(\"profit_loss\", { precision: 20, scale: 8 }),\n  profitLossPercent: decimal(\"profit_loss_percent\", { precision: 10, scale: 4 }),\n  maxDrawdown: decimal(\"max_drawdown\", { precision: 10, scale: 4 }),\n  winRate: decimal(\"win_rate\", { precision: 5, scale: 2 }),\n  explorationRate: decimal(\"exploration_rate\", { precision: 5, scale: 4 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// RL Agent decisions/predictions\nexport const rlDecisions = pgTable(\"rl_decisions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  agentId: varchar(\"agent_id\").notNull().references(() => rlAgentConfig.id),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  action: varchar(\"action\", { length: 10 }).notNull(), // buy, sell, hold\n  confidence: decimal(\"confidence\", { precision: 5, scale: 4 }),\n  stateFeatures: jsonb(\"state_features\"),\n  qValues: jsonb(\"q_values\"),\n  price: decimal(\"price\", { precision: 20, scale: 8 }),\n  wasExecuted: boolean(\"was_executed\").default(false),\n  reward: decimal(\"reward\", { precision: 20, scale: 8 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  shares: one(userShares, {\n    fields: [users.id],\n    references: [userShares.userId],\n  }),\n  transactions: many(transactions),\n}));\n\nexport const userSharesRelations = relations(userShares, ({ one }) => ({\n  user: one(users, {\n    fields: [userShares.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const transactionsRelations = relations(transactions, ({ one }) => ({\n  user: one(users, {\n    fields: [transactions.userId],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertUserSharesSchema = createInsertSchema(userShares).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({ id: true, createdAt: true });\nexport const insertTradeSchema = createInsertSchema(trades).omit({ id: true, createdAt: true });\nexport const insertPortfolioHistorySchema = createInsertSchema(portfolioHistory).omit({ id: true, recordedAt: true });\nexport const insertSentimentSchema = createInsertSchema(sentimentAnalysis).omit({ id: true, createdAt: true });\nexport const insertBotSettingsSchema = createInsertSchema(botSettings).omit({ id: true, updatedAt: true });\nexport const insertMarketDataSchema = createInsertSchema(marketData).omit({ id: true, updatedAt: true });\nexport const insertWalletAddressSchema = createInsertSchema(walletAddresses).omit({ id: true, createdAt: true });\nexport const insertNotificationSettingsSchema = createInsertSchema(notificationSettings).omit({ id: true, updatedAt: true });\nexport const insertBacktestResultSchema = createInsertSchema(backtestResults).omit({ id: true, createdAt: true });\nexport const insertRlAgentConfigSchema = createInsertSchema(rlAgentConfig).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertRlTrainingEpisodeSchema = createInsertSchema(rlTrainingEpisodes).omit({ id: true, createdAt: true });\nexport const insertRlDecisionSchema = createInsertSchema(rlDecisions).omit({ id: true, createdAt: true });\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertUserShares = z.infer<typeof insertUserSharesSchema>;\nexport type UserShares = typeof userShares.$inferSelect;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\nexport type InsertTrade = z.infer<typeof insertTradeSchema>;\nexport type Trade = typeof trades.$inferSelect;\nexport type InsertPortfolioHistory = z.infer<typeof insertPortfolioHistorySchema>;\nexport type PortfolioHistory = typeof portfolioHistory.$inferSelect;\nexport type InsertSentiment = z.infer<typeof insertSentimentSchema>;\nexport type Sentiment = typeof sentimentAnalysis.$inferSelect;\nexport type InsertBotSettings = z.infer<typeof insertBotSettingsSchema>;\nexport type BotSettings = typeof botSettings.$inferSelect;\nexport type InsertMarketData = z.infer<typeof insertMarketDataSchema>;\nexport type MarketData = typeof marketData.$inferSelect;\nexport type InsertWalletAddress = z.infer<typeof insertWalletAddressSchema>;\nexport type WalletAddress = typeof walletAddresses.$inferSelect;\nexport type InsertNotificationSettings = z.infer<typeof insertNotificationSettingsSchema>;\nexport type NotificationSettings = typeof notificationSettings.$inferSelect;\nexport type InsertBacktestResult = z.infer<typeof insertBacktestResultSchema>;\nexport type BacktestResult = typeof backtestResults.$inferSelect;\nexport type InsertRlAgentConfig = z.infer<typeof insertRlAgentConfigSchema>;\nexport type RlAgentConfig = typeof rlAgentConfig.$inferSelect;\nexport type InsertRlTrainingEpisode = z.infer<typeof insertRlTrainingEpisodeSchema>;\nexport type RlTrainingEpisode = typeof rlTrainingEpisodes.$inferSelect;\nexport type InsertRlDecision = z.infer<typeof insertRlDecisionSchema>;\nexport type RlDecision = typeof rlDecisions.$inferSelect;\n","path":null,"size_bytes":15535,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4366,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { \n  Settings as SettingsIcon, \n  Bot, \n  Shield, \n  Activity, \n  Brain,\n  Save,\n  AlertTriangle\n} from \"lucide-react\";\nimport type { BotSettings } from \"@shared/schema\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  \n  const { data: settings, isLoading } = useQuery<BotSettings>({\n    queryKey: [\"/api/bot/settings\"],\n  });\n\n  const [formData, setFormData] = useState<Partial<BotSettings>>({});\n\n  const currentSettings = { ...settings, ...formData };\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<BotSettings>) => {\n      return apiRequest(\"/api/bot/settings\", {\n        method: \"PATCH\",\n        body: JSON.stringify(data),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bot/settings\"] });\n      toast({\n        title: \"تم الحفظ\",\n        description: \"تم حفظ الإعدادات بنجاح\",\n      });\n      setFormData({});\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"حدث خطأ أثناء حفظ الإعدادات\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    if (Object.keys(formData).length > 0) {\n      updateMutation.mutate(formData);\n    }\n  };\n\n  const handleToggle = (key: keyof BotSettings, value: boolean) => {\n    setFormData(prev => ({ ...prev, [key]: value }));\n  };\n\n  const handleSliderChange = (key: keyof BotSettings, value: number[]) => {\n    setFormData(prev => ({ ...prev, [key]: value[0].toString() }));\n  };\n\n  const hasChanges = Object.keys(formData).length > 0;\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 md:p-6 space-y-6\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"h-8 bg-muted rounded w-48\" />\n          <div className=\"h-64 bg-muted rounded\" />\n          <div className=\"h-64 bg-muted rounded\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">الإعدادات</h1>\n          <p className=\"text-muted-foreground text-sm\">تكوين البوت وإدارة المخاطر</p>\n        </div>\n        {hasChanges && (\n          <Button \n            onClick={handleSave} \n            disabled={updateMutation.isPending}\n            data-testid=\"button-save-settings\"\n          >\n            <Save className=\"w-4 h-4 ml-2\" />\n            {updateMutation.isPending ? \"جاري الحفظ...\" : \"حفظ التغييرات\"}\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-bot-settings\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Bot className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">إعدادات البوت</CardTitle>\n            </div>\n            <CardDescription>تفعيل وتعطيل التداول الآلي</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between p-4 bg-muted rounded-md\">\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-3 h-3 rounded-full ${currentSettings.isActive ? \"bg-success animate-pulse\" : \"bg-muted-foreground\"}`} />\n                <div>\n                  <p className=\"font-medium\">حالة البوت</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {currentSettings.isActive ? \"البوت نشط ويتداول الآن\" : \"البوت متوقف\"}\n                  </p>\n                </div>\n              </div>\n              <Switch\n                checked={currentSettings.isActive || false}\n                onCheckedChange={(checked) => handleToggle(\"isActive\", checked)}\n                data-testid=\"switch-bot-active\"\n              />\n            </div>\n\n            {currentSettings.isActive && (\n              <div className=\"p-3 bg-warning/10 border border-warning/30 rounded-md flex items-start gap-2\">\n                <AlertTriangle className=\"w-5 h-5 text-warning flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"text-sm font-medium text-warning\">تحذير</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    البوت سيبدأ التداول بناءً على الإعدادات الحالية. تأكد من مراجعة إعدادات المخاطر.\n                  </p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-strategies\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Activity className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">الاستراتيجيات</CardTitle>\n            </div>\n            <CardDescription>اختر الاستراتيجيات التي يستخدمها البوت</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Activity className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">مؤشر RSI</p>\n                  <p className=\"text-xs text-muted-foreground\">مؤشر القوة النسبية</p>\n                </div>\n              </div>\n              <Switch\n                checked={currentSettings.useRsi || false}\n                onCheckedChange={(checked) => handleToggle(\"useRsi\", checked)}\n                data-testid=\"switch-use-rsi\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Activity className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">MACD</p>\n                  <p className=\"text-xs text-muted-foreground\">تقارب وتباعد المتوسطات</p>\n                </div>\n              </div>\n              <Switch\n                checked={currentSettings.useMacd || false}\n                onCheckedChange={(checked) => handleToggle(\"useMacd\", checked)}\n                data-testid=\"switch-use-macd\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Activity className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">المتوسطات المتحركة</p>\n                  <p className=\"text-xs text-muted-foreground\">MA و EMA</p>\n                </div>\n              </div>\n              <Switch\n                checked={currentSettings.useMovingAverages || false}\n                onCheckedChange={(checked) => handleToggle(\"useMovingAverages\", checked)}\n                data-testid=\"switch-use-ma\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Brain className=\"w-4 h-4 text-primary\" />\n                <div>\n                  <p className=\"text-sm font-medium\">تحليل الذكاء الاصطناعي</p>\n                  <p className=\"text-xs text-muted-foreground\">OpenAI Sentiment</p>\n                </div>\n              </div>\n              <Switch\n                checked={currentSettings.useAiSentiment || false}\n                onCheckedChange={(checked) => handleToggle(\"useAiSentiment\", checked)}\n                data-testid=\"switch-use-ai\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\" data-testid=\"card-risk-management\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">إدارة المخاطر</CardTitle>\n            </div>\n            <CardDescription>ضبط حدود المخاطر لحماية رأس المال</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-4\">\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Label>وقف الخسارة (%)</Label>\n                    <Badge variant=\"outline\">\n                      {currentSettings.stopLossPercent || \"3\"}%\n                    </Badge>\n                  </div>\n                  <Slider\n                    value={[parseFloat(currentSettings.stopLossPercent?.toString() || \"3\")]}\n                    onValueChange={(v) => handleSliderChange(\"stopLossPercent\", v)}\n                    max={20}\n                    min={1}\n                    step={0.5}\n                    data-testid=\"slider-stop-loss\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    إغلاق الصفقة تلقائياً عند خسارة هذه النسبة\n                  </p>\n                </div>\n\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Label>جني الأرباح (%)</Label>\n                    <Badge variant=\"outline\">\n                      {currentSettings.takeProfitPercent || \"10\"}%\n                    </Badge>\n                  </div>\n                  <Slider\n                    value={[parseFloat(currentSettings.takeProfitPercent?.toString() || \"10\")]}\n                    onValueChange={(v) => handleSliderChange(\"takeProfitPercent\", v)}\n                    max={50}\n                    min={1}\n                    step={1}\n                    data-testid=\"slider-take-profit\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    إغلاق الصفقة تلقائياً عند تحقيق هذه النسبة\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Label>نسبة المخاطرة القصوى (%)</Label>\n                    <Badge variant=\"outline\">\n                      {currentSettings.maxRiskPercent || \"5\"}%\n                    </Badge>\n                  </div>\n                  <Slider\n                    value={[parseFloat(currentSettings.maxRiskPercent?.toString() || \"5\")]}\n                    onValueChange={(v) => handleSliderChange(\"maxRiskPercent\", v)}\n                    max={25}\n                    min={1}\n                    step={0.5}\n                    data-testid=\"slider-max-risk\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    الحد الأقصى للمخاطرة في الصفقة الواحدة\n                  </p>\n                </div>\n\n                <div>\n                  <Label className=\"mb-2 block\">الحد الأقصى لحجم الصفقة (USDT)</Label>\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      type=\"number\"\n                      value={currentSettings.maxPositionSize?.toString() || \"1000\"}\n                      onChange={(e) => setFormData(prev => ({ ...prev, maxPositionSize: e.target.value }))}\n                      className=\"font-mono\"\n                      dir=\"ltr\"\n                      data-testid=\"input-max-position\"\n                    />\n                    <Badge variant=\"secondary\">USDT</Badge>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    أقصى مبلغ يمكن استخدامه في صفقة واحدة\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\" data-testid=\"card-trading-pairs\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <SettingsIcon className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">أزواج التداول</CardTitle>\n            </div>\n            <CardDescription>العملات التي يتداول عليها البوت</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {(currentSettings.tradingPairs || [\"BTC/USDT\", \"ETH/USDT\"]).map((pair) => (\n                <Badge key={pair} variant=\"secondary\" className=\"text-sm py-1.5 px-3\">\n                  {pair}\n                </Badge>\n              ))}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-4\">\n              يتم تحديث أزواج التداول تلقائياً بناءً على تحليل السوق والسيولة\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14072,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/market.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { TrendingUp, TrendingDown, RefreshCw, Clock } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { MarketData } from \"@shared/schema\";\n\nexport default function Market() {\n  const { data: marketData = [], isLoading, refetch, isFetching } = useQuery<MarketData[]>({\n    queryKey: [\"/api/market\"],\n  });\n\n  const formatPrice = (price: string) => {\n    const num = parseFloat(price);\n    if (num >= 1000) {\n      return num.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    }\n    return num.toLocaleString(\"en-US\", { minimumFractionDigits: 4, maximumFractionDigits: 6 });\n  };\n\n  const formatVolume = (volume: string | null) => {\n    if (!volume) return \"-\";\n    const num = parseFloat(volume);\n    if (num >= 1_000_000_000) {\n      return `$${(num / 1_000_000_000).toFixed(2)}B`;\n    }\n    if (num >= 1_000_000) {\n      return `$${(num / 1_000_000).toFixed(2)}M`;\n    }\n    return `$${num.toLocaleString(\"en-US\")}`;\n  };\n\n  const topGainers = [...marketData]\n    .filter(m => m.changePercent24h && parseFloat(m.changePercent24h) > 0)\n    .sort((a, b) => parseFloat(b.changePercent24h || \"0\") - parseFloat(a.changePercent24h || \"0\"))\n    .slice(0, 5);\n\n  const topLosers = [...marketData]\n    .filter(m => m.changePercent24h && parseFloat(m.changePercent24h) < 0)\n    .sort((a, b) => parseFloat(a.changePercent24h || \"0\") - parseFloat(b.changePercent24h || \"0\"))\n    .slice(0, 5);\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">السوق</h1>\n          <p className=\"text-muted-foreground text-sm\">أسعار العملات المشفرة المباشرة</p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Badge variant=\"outline\" className=\"text-sm\">\n            <Clock className=\"w-3 h-3 ml-1\" />\n            تحديث مباشر\n          </Badge>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => refetch()}\n            disabled={isFetching}\n            data-testid=\"button-refresh-market\"\n          >\n            <RefreshCw className={cn(\"w-4 h-4\", isFetching && \"animate-spin\")} />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-top-gainers\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <TrendingUp className=\"w-5 h-5 text-success\" />\n            <CardTitle className=\"text-lg\">الأكثر ارتفاعاً</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            {topGainers.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                لا توجد بيانات\n              </div>\n            ) : (\n              <div className=\"divide-y divide-border\">\n                {topGainers.map((item) => (\n                  <div \n                    key={item.id} \n                    className=\"flex items-center justify-between p-4\"\n                    data-testid={`gainer-${item.symbol}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center\">\n                        <TrendingUp className=\"w-5 h-5 text-success\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium\" dir=\"ltr\">{item.symbol}</p>\n                        <p className=\"text-xs text-muted-foreground\">حجم: {formatVolume(item.volume24h)}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-bold\" dir=\"ltr\">${formatPrice(item.price)}</p>\n                      <p className=\"text-sm text-success\" dir=\"ltr\">\n                        +{parseFloat(item.changePercent24h || \"0\").toFixed(2)}%\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-top-losers\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <TrendingDown className=\"w-5 h-5 text-destructive\" />\n            <CardTitle className=\"text-lg\">الأكثر انخفاضاً</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            {topLosers.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                لا توجد بيانات\n              </div>\n            ) : (\n              <div className=\"divide-y divide-border\">\n                {topLosers.map((item) => (\n                  <div \n                    key={item.id} \n                    className=\"flex items-center justify-between p-4\"\n                    data-testid={`loser-${item.symbol}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center\">\n                        <TrendingDown className=\"w-5 h-5 text-destructive\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium\" dir=\"ltr\">{item.symbol}</p>\n                        <p className=\"text-xs text-muted-foreground\">حجم: {formatVolume(item.volume24h)}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-bold\" dir=\"ltr\">${formatPrice(item.price)}</p>\n                      <p className=\"text-sm text-destructive\" dir=\"ltr\">\n                        {parseFloat(item.changePercent24h || \"0\").toFixed(2)}%\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card data-testid=\"card-all-markets\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg\">جميع الأسواق</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          {isLoading ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              جاري التحميل...\n            </div>\n          ) : marketData.length === 0 ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              لا توجد بيانات متاحة\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\">الزوج</TableHead>\n                    <TableHead className=\"text-left\">السعر</TableHead>\n                    <TableHead className=\"text-left\">التغير 24س</TableHead>\n                    <TableHead className=\"text-left\">الأعلى 24س</TableHead>\n                    <TableHead className=\"text-left\">الأدنى 24س</TableHead>\n                    <TableHead className=\"text-left\">الحجم 24س</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {marketData.map((item) => {\n                    const changePercent = item.changePercent24h ? parseFloat(item.changePercent24h) : 0;\n                    const isPositive = changePercent > 0;\n                    const isNegative = changePercent < 0;\n\n                    return (\n                      <TableRow key={item.id} data-testid={`row-market-${item.symbol}`}>\n                        <TableCell className=\"font-medium\" dir=\"ltr\">\n                          {item.symbol}\n                        </TableCell>\n                        <TableCell dir=\"ltr\" className=\"font-mono\">\n                          ${formatPrice(item.price)}\n                        </TableCell>\n                        <TableCell>\n                          <div className={cn(\n                            \"flex items-center gap-1\",\n                            isPositive && \"text-success\",\n                            isNegative && \"text-destructive\"\n                          )}>\n                            {isPositive && <TrendingUp className=\"w-3 h-3\" />}\n                            {isNegative && <TrendingDown className=\"w-3 h-3\" />}\n                            <span dir=\"ltr\" className=\"font-mono\">\n                              {isPositive && \"+\"}\n                              {changePercent.toFixed(2)}%\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell dir=\"ltr\" className=\"font-mono text-muted-foreground\">\n                          ${item.high24h ? formatPrice(item.high24h) : \"-\"}\n                        </TableCell>\n                        <TableCell dir=\"ltr\" className=\"font-mono text-muted-foreground\">\n                          ${item.low24h ? formatPrice(item.low24h) : \"-\"}\n                        </TableCell>\n                        <TableCell dir=\"ltr\" className=\"text-muted-foreground\">\n                          {formatVolume(item.volume24h)}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9898,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Bot, TrendingUp, Shield, Users, ArrowLeft, BarChart3, Brain, Wallet } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nconst features = [\n  {\n    icon: Bot,\n    title: \"تداول آلي ذكي\",\n    description: \"بوت تداول متقدم يستخدم استراتيجيات RSI وMACD والمتوسطات المتحركة\",\n  },\n  {\n    icon: Brain,\n    title: \"تحليل بالذكاء الاصطناعي\",\n    description: \"تحليل المشاعر وتوقعات السوق باستخدام OpenAI\",\n  },\n  {\n    icon: Users,\n    title: \"محفظة جماعية\",\n    description: \"استثمر مع الآخرين وتقاسم الأرباح بنظام الحصص\",\n  },\n  {\n    icon: Shield,\n    title: \"إدارة المخاطر\",\n    description: \"وقف خسارة تلقائي وجني أرباح لحماية استثماراتك\",\n  },\n  {\n    icon: BarChart3,\n    title: \"إحصائيات متقدمة\",\n    description: \"تتبع أداء محفظتك مع رسوم بيانية تفاعلية\",\n  },\n  {\n    icon: Wallet,\n    title: \"إيداع وسحب سهل\",\n    description: \"عمليات مالية سريعة وآمنة على منصة MEXC\",\n  },\n];\n\nexport default function Landing() {\n  const { login } = useAuth();\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-primary/10 via-background to-background\" />\n        <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-primary/20 via-transparent to-transparent\" />\n        \n        <header className=\"relative z-10 flex items-center justify-between p-4 md:p-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-md bg-primary flex items-center justify-center\">\n              <Bot className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <span className=\"font-bold text-xl\">MexAI Trader</span>\n          </div>\n          <Button onClick={login} data-testid=\"button-login-header\">\n            تسجيل الدخول\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          </Button>\n        </header>\n\n        <section className=\"relative z-10 px-4 py-16 md:py-24 text-center max-w-4xl mx-auto\">\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm mb-6\">\n            <TrendingUp className=\"w-4 h-4\" />\n            <span>منصة تداول ذكية على MEXC</span>\n          </div>\n          \n          <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-6 leading-tight\">\n            استثمر بذكاء مع\n            <span className=\"text-primary block\">التداول الآلي</span>\n          </h1>\n          \n          <p className=\"text-lg md:text-xl text-muted-foreground mb-8 max-w-2xl mx-auto\">\n            انضم إلى المحفظة الجماعية واترك الذكاء الاصطناعي يتداول نيابة عنك.\n            تحليل السوق، إدارة المخاطر، وتوزيع الأرباح تلقائياً.\n          </p>\n          \n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Button size=\"lg\" onClick={login} className=\"text-lg gap-2\" data-testid=\"button-start-now\">\n              ابدأ الآن\n              <ArrowLeft className=\"w-5 h-5\" />\n            </Button>\n            <Button size=\"lg\" variant=\"outline\" className=\"text-lg\" data-testid=\"button-learn-more\">\n              تعرف على المزيد\n            </Button>\n          </div>\n          \n          <div className=\"flex items-center justify-center gap-8 mt-12 text-sm text-muted-foreground\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 rounded-full bg-success animate-pulse\" />\n              <span>البوت نشط</span>\n            </div>\n            <div dir=\"ltr\">\n              <span className=\"font-bold text-foreground\">$50,000+</span>\n              <span className=\"mr-2\">إجمالي الأصول</span>\n            </div>\n            <div dir=\"ltr\">\n              <span className=\"font-bold text-success\">+12.5%</span>\n              <span className=\"mr-2\">هذا الشهر</span>\n            </div>\n          </div>\n        </section>\n      </div>\n\n      <section className=\"px-4 py-16 md:py-24\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">مميزات المنصة</h2>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              كل ما تحتاجه للتداول الذكي في مكان واحد\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {features.map((feature) => {\n              const FeatureIcon = feature.icon;\n              return (\n                <Card key={feature.title} className=\"overflow-visible\" data-testid={`card-feature-${feature.title}`}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center mb-4\">\n                      <FeatureIcon className=\"w-6 h-6 text-primary\" />\n                    </div>\n                    <h3 className=\"text-lg font-bold mb-2\">{feature.title}</h3>\n                    <p className=\"text-muted-foreground text-sm\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      <section className=\"px-4 py-16 md:py-24 bg-muted/30\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-4\">جاهز للبدء؟</h2>\n          <p className=\"text-muted-foreground mb-8 max-w-2xl mx-auto\">\n            سجل دخولك الآن وانضم إلى المحفظة الجماعية لبدء الاستثمار الذكي\n          </p>\n          <Button size=\"lg\" onClick={login} className=\"text-lg gap-2\" data-testid=\"button-join-now\">\n            انضم الآن\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n        </div>\n      </section>\n\n      <footer className=\"px-4 py-8 border-t border-border\">\n        <div className=\"max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-8 h-8 rounded-md bg-primary flex items-center justify-center\">\n              <Bot className=\"w-5 h-5 text-primary-foreground\" />\n            </div>\n            <span className=\"font-bold\">MexAI Trader</span>\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            جميع الحقوق محفوظة 2024\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":7117,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport {\n  LayoutDashboard,\n  Wallet,\n  CreditCard,\n  History,\n  TrendingUp,\n  Settings,\n  Bot,\n  PieChart,\n  LogOut,\n  Brain,\n  Cpu,\n  Send,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nconst menuItems = [\n  {\n    title: \"لوحة التحكم\",\n    url: \"/\",\n    icon: LayoutDashboard,\n  },\n  {\n    title: \"المحفظة\",\n    url: \"/portfolio\",\n    icon: Wallet,\n  },\n  {\n    title: \"الإيداع والسحب\",\n    url: \"/wallet\",\n    icon: CreditCard,\n  },\n  {\n    title: \"التداولات\",\n    url: \"/trades\",\n    icon: History,\n  },\n  {\n    title: \"السوق\",\n    url: \"/market\",\n    icon: TrendingUp,\n  },\n  {\n    title: \"تحليل الذكاء الاصطناعي\",\n    url: \"/ai-analysis\",\n    icon: Bot,\n  },\n  {\n    title: \"تحليل Smart Money\",\n    url: \"/smc-analysis\",\n    icon: Brain,\n  },\n  {\n    title: \"وكيل التعلم الآلي\",\n    url: \"/rl-agent\",\n    icon: Cpu,\n  },\n  {\n    title: \"الإحصائيات\",\n    url: \"/stats\",\n    icon: PieChart,\n  },\n  {\n    title: \"إشعارات Telegram\",\n    url: \"/telegram\",\n    icon: Send,\n  },\n  {\n    title: \"الإعدادات\",\n    url: \"/settings\",\n    icon: Settings,\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const getUserInitials = () => {\n    if (user?.firstName && user?.lastName) {\n      return `${user.firstName[0]}${user.lastName[0]}`;\n    }\n    if (user?.email) {\n      return user.email[0].toUpperCase();\n    }\n    return \"م\";\n  };\n\n  return (\n    <Sidebar side=\"right\" collapsible=\"icon\">\n      <SidebarHeader className=\"p-4 border-b border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 rounded-md bg-primary flex items-center justify-center\">\n            <Bot className=\"w-6 h-6 text-primary-foreground\" />\n          </div>\n          <div className=\"flex flex-col group-data-[collapsible=icon]:hidden\">\n            <span className=\"font-bold text-lg\">MexAI Trader</span>\n            <span className=\"text-xs text-muted-foreground\">منصة التداول الذكية</span>\n          </div>\n        </div>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>القائمة الرئيسية</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    tooltip={item.title}\n                  >\n                    <Link href={item.url} data-testid={`link-${item.url.slice(1) || 'dashboard'}`}>\n                      <item.icon className=\"w-5 h-5\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t border-sidebar-border\">\n        <div className=\"flex items-center gap-3 group-data-[collapsible=icon]:justify-center\">\n          <Avatar className=\"w-9 h-9\">\n            <AvatarImage src={user?.profileImageUrl || undefined} className=\"object-cover\" />\n            <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n              {getUserInitials()}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 group-data-[collapsible=icon]:hidden\">\n            <p className=\"text-sm font-medium truncate\">\n              {user?.firstName && user?.lastName \n                ? `${user.firstName} ${user.lastName}`\n                : user?.email || \"مستخدم\"}\n            </p>\n            <p className=\"text-xs text-muted-foreground truncate\">{user?.email}</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"group-data-[collapsible=icon]:hidden\"\n            onClick={() => window.location.href = \"/api/logout\"}\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":4702,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/openai.ts":{"content":"import OpenAI from \"openai\";\nimport pLimit from \"p-limit\";\nimport pRetry, { AbortError } from \"p-retry\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n// This is using Replit's AI Integrations service, which provides OpenAI-compatible API access without requiring your own OpenAI API key.\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n});\n\nexport interface SentimentResult {\n  sentiment: \"bullish\" | \"bearish\" | \"neutral\";\n  score: number;\n  summary: string;\n  confidence: number;\n}\n\nfunction isRateLimitError(error: any): boolean {\n  const errorMsg = error?.message || String(error);\n  return (\n    errorMsg.includes(\"429\") ||\n    errorMsg.includes(\"RATELIMIT_EXCEEDED\") ||\n    errorMsg.toLowerCase().includes(\"quota\") ||\n    errorMsg.toLowerCase().includes(\"rate limit\")\n  );\n}\n\nexport async function analyzeSentiment(symbol: string, newsContext?: string): Promise<SentimentResult> {\n  const limit = pLimit(2);\n  \n  return limit(() =>\n    pRetry(\n      async () => {\n        const prompt = `Analyze the current market sentiment for ${symbol} cryptocurrency.\n${newsContext ? `Recent news context: ${newsContext}` : \"\"}\n\nProvide a detailed sentiment analysis with the following JSON structure:\n{\n  \"sentiment\": \"bullish\" | \"bearish\" | \"neutral\",\n  \"score\": <number from -100 to 100, where -100 is extremely bearish and 100 is extremely bullish>,\n  \"summary\": \"<brief 2-3 sentence summary of the sentiment analysis>\",\n  \"confidence\": <number from 0 to 100 indicating confidence level>\n}\n\nConsider factors like:\n- Recent price action trends\n- Market momentum indicators\n- General crypto market conditions\n- Any relevant news or events\n\nRespond ONLY with valid JSON, no additional text.`;\n\n        const response = await openai.chat.completions.create({\n          model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025\n          messages: [{ role: \"user\", content: prompt }],\n          max_completion_tokens: 1024,\n          response_format: { type: \"json_object\" }\n        });\n\n        const content = response.choices[0]?.message?.content || \"{}\";\n        const result = JSON.parse(content);\n        \n        return {\n          sentiment: result.sentiment || \"neutral\",\n          score: Number(result.score) || 0,\n          summary: result.summary || \"Unable to determine sentiment\",\n          confidence: Number(result.confidence) || 50\n        };\n      },\n      {\n        retries: 3,\n        minTimeout: 2000,\n        maxTimeout: 16000,\n        factor: 2,\n        onFailedAttempt: (ctx) => {\n          if (!isRateLimitError(ctx.error)) {\n            throw new AbortError(ctx.error?.message || \"Non-retriable error\");\n          }\n        }\n      }\n    )\n  );\n}\n\nexport async function analyzeTradeSignal(\n  symbol: string,\n  priceData: { price: number; change24h: number },\n  technicalIndicators?: { rsi?: number; macd?: string; sma?: number }\n): Promise<{ action: \"buy\" | \"sell\" | \"hold\"; reason: string; confidence: number }> {\n  const limit = pLimit(2);\n  \n  return limit(() =>\n    pRetry(\n      async () => {\n        const prompt = `Analyze ${symbol} for a trading signal.\n\nCurrent data:\n- Price: $${priceData.price}\n- 24h Change: ${priceData.change24h}%\n${technicalIndicators ? `\nTechnical Indicators:\n- RSI: ${technicalIndicators.rsi ?? \"N/A\"}\n- MACD: ${technicalIndicators.macd ?? \"N/A\"}\n- SMA: ${technicalIndicators.sma ?? \"N/A\"}\n` : \"\"}\n\nProvide a trading recommendation in JSON format:\n{\n  \"action\": \"buy\" | \"sell\" | \"hold\",\n  \"reason\": \"<brief explanation for the recommendation>\",\n  \"confidence\": <number from 0 to 100>\n}\n\nRespond ONLY with valid JSON, no additional text.`;\n\n        const response = await openai.chat.completions.create({\n          model: \"gpt-5\",\n          messages: [{ role: \"user\", content: prompt }],\n          max_completion_tokens: 512,\n          response_format: { type: \"json_object\" }\n        });\n\n        const content = response.choices[0]?.message?.content || \"{}\";\n        const result = JSON.parse(content);\n        \n        return {\n          action: result.action || \"hold\",\n          reason: result.reason || \"Unable to determine signal\",\n          confidence: Number(result.confidence) || 50\n        };\n      },\n      {\n        retries: 3,\n        minTimeout: 2000,\n        maxTimeout: 16000,\n        factor: 2,\n        onFailedAttempt: (ctx) => {\n          if (!isRateLimitError(ctx.error)) {\n            throw new AbortError(ctx.error?.message || \"Non-retriable error\");\n          }\n        }\n      }\n    )\n  );\n}\n","path":null,"size_bytes":4674,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/stats-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\nimport { TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface StatsCardProps {\n  title: string;\n  value: string;\n  change?: number;\n  changeLabel?: string;\n  icon: LucideIcon;\n  iconColor?: string;\n  testId?: string;\n}\n\nexport function StatsCard({\n  title,\n  value,\n  change,\n  changeLabel,\n  icon: Icon,\n  iconColor = \"text-primary\",\n  testId,\n}: StatsCardProps) {\n  const isPositive = change !== undefined && change > 0;\n  const isNegative = change !== undefined && change < 0;\n  const isNeutral = change === undefined || change === 0;\n\n  return (\n    <Card className=\"overflow-visible\" data-testid={testId}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm text-muted-foreground mb-1\">{title}</p>\n            <p className=\"text-2xl font-bold tracking-tight\" dir=\"ltr\">{value}</p>\n            {change !== undefined && (\n              <div className=\"flex items-center gap-1 mt-2\">\n                {isPositive && (\n                  <TrendingUp className=\"w-4 h-4 text-success\" />\n                )}\n                {isNegative && (\n                  <TrendingDown className=\"w-4 h-4 text-destructive\" />\n                )}\n                {isNeutral && (\n                  <Minus className=\"w-4 h-4 text-muted-foreground\" />\n                )}\n                <span\n                  className={cn(\n                    \"text-sm font-medium\",\n                    isPositive && \"text-success\",\n                    isNegative && \"text-destructive\",\n                    isNeutral && \"text-muted-foreground\"\n                  )}\n                  dir=\"ltr\"\n                >\n                  {isPositive && \"+\"}\n                  {change.toFixed(2)}%\n                </span>\n                {changeLabel && (\n                  <span className=\"text-xs text-muted-foreground\">{changeLabel}</span>\n                )}\n              </div>\n            )}\n          </div>\n          <div className={cn(\"p-3 rounded-md bg-muted\", iconColor)}>\n            <Icon className=\"w-5 h-5\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2330,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/sentiment-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { cn } from \"@/lib/utils\";\nimport { Bot, TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport type { Sentiment } from \"@shared/schema\";\n\ninterface SentimentCardProps {\n  sentiments: Sentiment[];\n  isLoading?: boolean;\n}\n\nconst sentimentConfig = {\n  bullish: {\n    label: \"صاعد\",\n    color: \"text-success\",\n    bgColor: \"bg-success/10\",\n    icon: TrendingUp,\n  },\n  bearish: {\n    label: \"هابط\",\n    color: \"text-destructive\",\n    bgColor: \"bg-destructive/10\",\n    icon: TrendingDown,\n  },\n  neutral: {\n    label: \"محايد\",\n    color: \"text-muted-foreground\",\n    bgColor: \"bg-muted\",\n    icon: Minus,\n  },\n};\n\nexport function SentimentCard({ sentiments, isLoading }: SentimentCardProps) {\n  const latestSentiments = sentiments.slice(0, 4);\n\n  return (\n    <Card data-testid=\"card-sentiment\">\n      <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n        <Bot className=\"w-5 h-5 text-primary\" />\n        <CardTitle className=\"text-lg\">تحليل الذكاء الاصطناعي</CardTitle>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"animate-pulse\">\n                <div className=\"h-4 bg-muted rounded w-20 mb-2\" />\n                <div className=\"h-2 bg-muted rounded w-full mb-1\" />\n                <div className=\"h-3 bg-muted rounded w-3/4\" />\n              </div>\n            ))}\n          </div>\n        ) : latestSentiments.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Bot className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>لا يوجد تحليل متاح حالياً</p>\n            <p className=\"text-xs mt-1\">سيتم تحديث التحليل قريباً</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {latestSentiments.map((sentiment) => {\n              const config = sentimentConfig[sentiment.sentiment as keyof typeof sentimentConfig] || sentimentConfig.neutral;\n              const score = parseFloat(sentiment.score);\n              const normalizedScore = ((score + 100) / 200) * 100;\n              const confidence = sentiment.confidence ? parseFloat(sentiment.confidence) : 0;\n              const SentimentIcon = config.icon;\n\n              return (\n                <div\n                  key={sentiment.id}\n                  className={cn(\"p-3 rounded-md\", config.bgColor)}\n                  data-testid={`sentiment-${sentiment.symbol}`}\n                >\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-sm\" dir=\"ltr\">{sentiment.symbol}</span>\n                      <Badge variant=\"outline\" className={cn(\"text-xs\", config.color)}>\n                        <SentimentIcon className=\"w-3 h-3 ml-1\" />\n                        {config.label}\n                      </Badge>\n                    </div>\n                    <span className={cn(\"text-sm font-bold\", config.color)} dir=\"ltr\">\n                      {score > 0 && \"+\"}{score.toFixed(0)}\n                    </span>\n                  </div>\n                  <Progress value={normalizedScore} className=\"h-1.5 mb-2\" />\n                  {sentiment.summary && (\n                    <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                      {sentiment.summary}\n                    </p>\n                  )}\n                  <div className=\"flex items-center justify-between mt-2\">\n                    <span className=\"text-xs text-muted-foreground\">\n                      ثقة: {confidence.toFixed(0)}%\n                    </span>\n                    <span className=\"text-xs text-muted-foreground\">\n                      {sentiment.createdAt && new Date(sentiment.createdAt).toLocaleTimeString(\"ar-SA\", {\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                      })}\n                    </span>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4398,"size_tokens":null},"client/src/pages/smc-analysis.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { \n  Clock, \n  TrendingUp, \n  TrendingDown, \n  Minus, \n  RefreshCw, \n  Target,\n  AlertCircle,\n  Zap,\n  BarChart3,\n  Activity\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface KillZone {\n  name: string;\n  nameAr: string;\n  startHour: number;\n  endHour: number;\n  isActive: boolean;\n  description: string;\n}\n\ninterface FairValueGap {\n  type: \"bullish\" | \"bearish\";\n  startPrice: number;\n  endPrice: number;\n  gapSize: number;\n  gapPercent: number;\n  timestamp: number;\n  filled: boolean;\n}\n\ninterface OrderBlock {\n  type: \"bullish\" | \"bearish\";\n  priceHigh: number;\n  priceLow: number;\n  strength: number;\n  timestamp: number;\n  tested: boolean;\n}\n\ninterface LiquiditySweep {\n  type: \"buy_side\" | \"sell_side\";\n  level: number;\n  sweptAt: number;\n  priceAfterSweep: number;\n  reversal: boolean;\n}\n\ninterface SMCAnalysis {\n  symbol: string;\n  timestamp: number;\n  killZones: KillZone[];\n  activeKillZone: KillZone | null;\n  fairValueGaps: FairValueGap[];\n  orderBlocks: OrderBlock[];\n  liquiditySweeps: LiquiditySweep[];\n  marketStructure: \"bullish\" | \"bearish\" | \"ranging\";\n  bias: \"long\" | \"short\" | \"neutral\";\n  confidenceScore: number;\n}\n\ninterface SMCSignal {\n  action: \"buy\" | \"sell\" | \"hold\";\n  reason: string;\n  confidence: number;\n  killZoneBonus: boolean;\n}\n\ninterface KillZonesResponse {\n  killZones: KillZone[];\n  activeKillZone: KillZone | null;\n}\n\nconst biasConfig = {\n  long: {\n    label: \"شراء\",\n    labelEn: \"Long\",\n    color: \"text-success\",\n    bgColor: \"bg-success/10\",\n    borderColor: \"border-success/30\",\n    icon: TrendingUp,\n  },\n  short: {\n    label: \"بيع\",\n    labelEn: \"Short\",\n    color: \"text-destructive\",\n    bgColor: \"bg-destructive/10\",\n    borderColor: \"border-destructive/30\",\n    icon: TrendingDown,\n  },\n  neutral: {\n    label: \"محايد\",\n    labelEn: \"Neutral\",\n    color: \"text-muted-foreground\",\n    bgColor: \"bg-muted\",\n    borderColor: \"border-border\",\n    icon: Minus,\n  },\n};\n\nconst actionConfig = {\n  buy: {\n    label: \"شراء\",\n    labelEn: \"Buy\",\n    color: \"text-success\",\n    bgColor: \"bg-success/10\",\n  },\n  sell: {\n    label: \"بيع\",\n    labelEn: \"Sell\",\n    color: \"text-destructive\",\n    bgColor: \"bg-destructive/10\",\n  },\n  hold: {\n    label: \"انتظار\",\n    labelEn: \"Hold\",\n    color: \"text-muted-foreground\",\n    bgColor: \"bg-muted\",\n  },\n};\n\nconst tradingPairs = [\n  \"BTC/USDT\",\n  \"ETH/USDT\",\n  \"SOL/USDT\",\n  \"XRP/USDT\",\n  \"BNB/USDT\",\n  \"ADA/USDT\",\n  \"DOGE/USDT\",\n  \"AVAX/USDT\",\n];\n\nexport default function SMCAnalysisPage() {\n  const [selectedSymbol, setSelectedSymbol] = useState(\"BTC/USDT\");\n  \n  const { data: killZonesData, isLoading: killZonesLoading } = useQuery<KillZonesResponse>({\n    queryKey: [\"/api/smc/killzones\"],\n    refetchInterval: 60000,\n  });\n\n  const analyzeMutation = useMutation({\n    mutationFn: async (symbol: string) => {\n      const response = await apiRequest(\"POST\", \"/api/smc/analyze\", { symbol });\n      return response.json();\n    },\n  });\n\n  const handleAnalyze = () => {\n    analyzeMutation.mutate(selectedSymbol);\n  };\n\n  const analysis: SMCAnalysis | undefined = analyzeMutation.data?.analysis;\n  const signal: SMCSignal | undefined = analyzeMutation.data?.signal;\n\n  const activeKillZone = killZonesData?.activeKillZone;\n  const killZones = killZonesData?.killZones || [];\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">تحليل Smart Money</h1>\n          <p className=\"text-muted-foreground text-sm\">مفاهيم الأموال الذكية و ICT Kill Zones</p>\n        </div>\n        <div className=\"flex items-center gap-3 flex-wrap\">\n          {activeKillZone && (\n            <Badge variant=\"default\" className=\"bg-primary text-primary-foreground\">\n              <Zap className=\"w-3 h-3 ml-1\" />\n              {activeKillZone.nameAr}\n            </Badge>\n          )}\n          <Select value={selectedSymbol} onValueChange={setSelectedSymbol}>\n            <SelectTrigger className=\"w-36\" data-testid=\"select-symbol\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {tradingPairs.map((pair) => (\n                <SelectItem key={pair} value={pair}>{pair}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          <Button \n            onClick={handleAnalyze}\n            disabled={analyzeMutation.isPending}\n            data-testid=\"button-analyze-smc\"\n          >\n            <RefreshCw className={cn(\"w-4 h-4 ml-2\", analyzeMutation.isPending && \"animate-spin\")} />\n            تحليل\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card data-testid=\"card-kill-zone-status\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className={cn(\"p-3 rounded-md\", activeKillZone ? \"bg-primary/10\" : \"bg-muted\")}>\n                <Clock className={cn(\"w-6 h-6\", activeKillZone ? \"text-primary\" : \"text-muted-foreground\")} />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Kill Zone</p>\n                <p className={cn(\"text-lg font-bold\", activeKillZone ? \"text-primary\" : \"text-muted-foreground\")}>\n                  {activeKillZone ? activeKillZone.nameAr : \"غير نشط\"}\n                </p>\n              </div>\n            </div>\n            {activeKillZone && (\n              <p className=\"text-xs text-muted-foreground\">{activeKillZone.description}</p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-market-structure\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className={cn(\"p-3 rounded-md\", \n                analysis?.marketStructure === \"bullish\" ? \"bg-success/10\" :\n                analysis?.marketStructure === \"bearish\" ? \"bg-destructive/10\" : \"bg-muted\"\n              )}>\n                <Activity className={cn(\"w-5 h-5\",\n                  analysis?.marketStructure === \"bullish\" ? \"text-success\" :\n                  analysis?.marketStructure === \"bearish\" ? \"text-destructive\" : \"text-muted-foreground\"\n                )} />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">هيكل السوق</p>\n                <p className={cn(\"text-lg font-bold\",\n                  analysis?.marketStructure === \"bullish\" ? \"text-success\" :\n                  analysis?.marketStructure === \"bearish\" ? \"text-destructive\" : \"text-muted-foreground\"\n                )}>\n                  {analysis?.marketStructure === \"bullish\" ? \"صاعد\" :\n                   analysis?.marketStructure === \"bearish\" ? \"هابط\" : \"متذبذب\"}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-trading-bias\">\n          <CardContent className=\"p-6\">\n            {analysis ? (\n              <div className=\"flex items-center gap-3\">\n                <div className={cn(\"p-3 rounded-md\", biasConfig[analysis.bias].bgColor)}>\n                  {(() => {\n                    const BiasIcon = biasConfig[analysis.bias].icon;\n                    return <BiasIcon className={cn(\"w-5 h-5\", biasConfig[analysis.bias].color)} />;\n                  })()}\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">الاتجاه المتوقع</p>\n                  <p className={cn(\"text-lg font-bold\", biasConfig[analysis.bias].color)}>\n                    {biasConfig[analysis.bias].label}\n                  </p>\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-3 rounded-md bg-muted\">\n                  <Target className=\"w-5 h-5 text-muted-foreground\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">الاتجاه المتوقع</p>\n                  <p className=\"text-lg font-bold text-muted-foreground\">-</p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-confidence-score\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"p-3 rounded-md bg-primary/10\">\n                <BarChart3 className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">درجة الثقة</p>\n                <p className=\"text-lg font-bold\" dir=\"ltr\">\n                  {analysis ? `${analysis.confidenceScore.toFixed(0)}%` : \"-\"}\n                </p>\n              </div>\n            </div>\n            {analysis && (\n              <Progress value={analysis.confidenceScore} className=\"h-1.5\" />\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {signal && (\n        <Card className={cn(\"border-2\", actionConfig[signal.action].bgColor)} data-testid=\"card-smc-signal\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between gap-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Target className=\"w-5 h-5\" />\n                إشارة التداول\n              </CardTitle>\n              <Badge className={cn(actionConfig[signal.action].bgColor, actionConfig[signal.action].color)}>\n                {actionConfig[signal.action].label}\n              </Badge>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-4\">{signal.reason}</p>\n            <div className=\"flex items-center justify-between text-sm\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-muted-foreground\">درجة الثقة:</span>\n                <span className=\"font-medium\" dir=\"ltr\">{signal.confidence}%</span>\n              </div>\n              {signal.killZoneBonus && (\n                <Badge variant=\"outline\" className=\"text-primary border-primary\">\n                  <Zap className=\"w-3 h-3 ml-1\" />\n                  تعزيز Kill Zone\n                </Badge>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-kill-zones\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <Clock className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">ICT Kill Zones</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {killZonesLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3, 4].map((i) => (\n                  <div key={i} className=\"animate-pulse p-3 bg-muted rounded-md h-16\" />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {killZones.map((kz, index) => (\n                  <div \n                    key={index}\n                    className={cn(\n                      \"p-4 rounded-md border transition-colors\",\n                      kz.isActive \n                        ? \"bg-primary/10 border-primary/30\" \n                        : \"bg-muted/50 border-border\"\n                    )}\n                    data-testid={`killzone-${kz.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium\">{kz.nameAr}</span>\n                        {kz.isActive && (\n                          <Badge variant=\"default\">نشط</Badge>\n                        )}\n                      </div>\n                      <span className=\"text-sm text-muted-foreground\" dir=\"ltr\">\n                        {String(kz.startHour).padStart(2, '0')}:00 - {String(kz.endHour).padStart(2, '0')}:00 UTC\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">{kz.description}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-order-blocks\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <BarChart3 className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">Order Blocks</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {!analysis ? (\n              <div className=\"text-center py-8\">\n                <AlertCircle className=\"w-10 h-10 mx-auto mb-3 text-muted-foreground opacity-50\" />\n                <p className=\"text-muted-foreground text-sm\">اضغط تحليل لعرض Order Blocks</p>\n              </div>\n            ) : analysis.orderBlocks.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-muted-foreground text-sm\">لا توجد Order Blocks حالياً</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {analysis.orderBlocks.map((ob, index) => (\n                  <div \n                    key={index}\n                    className={cn(\n                      \"p-3 rounded-md border\",\n                      ob.type === \"bullish\" ? \"bg-success/5 border-success/20\" : \"bg-destructive/5 border-destructive/20\"\n                    )}\n                    data-testid={`orderblock-${index}`}\n                  >\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        {ob.type === \"bullish\" ? (\n                          <TrendingUp className=\"w-4 h-4 text-success\" />\n                        ) : (\n                          <TrendingDown className=\"w-4 h-4 text-destructive\" />\n                        )}\n                        <span className={cn(\"font-medium\", ob.type === \"bullish\" ? \"text-success\" : \"text-destructive\")}>\n                          {ob.type === \"bullish\" ? \"صاعد\" : \"هابط\"}\n                        </span>\n                        {ob.tested && (\n                          <Badge variant=\"outline\">مختبر</Badge>\n                        )}\n                      </div>\n                      <span className=\"text-xs text-muted-foreground\">\n                        قوة: {ob.strength.toFixed(0)}%\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\" dir=\"ltr\">\n                      ${ob.priceLow.toFixed(2)} - ${ob.priceHigh.toFixed(2)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-fvg\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <Activity className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">Fair Value Gaps</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {!analysis ? (\n              <div className=\"text-center py-8\">\n                <AlertCircle className=\"w-10 h-10 mx-auto mb-3 text-muted-foreground opacity-50\" />\n                <p className=\"text-muted-foreground text-sm\">اضغط تحليل لعرض FVGs</p>\n              </div>\n            ) : analysis.fairValueGaps.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-muted-foreground text-sm\">لا توجد Fair Value Gaps حالياً</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {analysis.fairValueGaps.map((fvg, index) => (\n                  <div \n                    key={index}\n                    className={cn(\n                      \"p-3 rounded-md border\",\n                      fvg.type === \"bullish\" ? \"bg-success/5 border-success/20\" : \"bg-destructive/5 border-destructive/20\"\n                    )}\n                    data-testid={`fvg-${index}`}\n                  >\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        {fvg.type === \"bullish\" ? (\n                          <TrendingUp className=\"w-4 h-4 text-success\" />\n                        ) : (\n                          <TrendingDown className=\"w-4 h-4 text-destructive\" />\n                        )}\n                        <span className={cn(\"font-medium\", fvg.type === \"bullish\" ? \"text-success\" : \"text-destructive\")}>\n                          {fvg.type === \"bullish\" ? \"صاعد\" : \"هابط\"}\n                        </span>\n                        {fvg.filled && (\n                          <Badge variant=\"outline\">ممتلئ</Badge>\n                        )}\n                      </div>\n                      <span className=\"text-xs text-muted-foreground\" dir=\"ltr\">\n                        {fvg.gapPercent.toFixed(2)}%\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\" dir=\"ltr\">\n                      ${fvg.startPrice.toFixed(2)} - ${fvg.endPrice.toFixed(2)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-liquidity-sweeps\">\n          <CardHeader className=\"flex flex-row items-center gap-2 pb-4\">\n            <Zap className=\"w-5 h-5 text-primary\" />\n            <CardTitle className=\"text-lg\">Liquidity Sweeps</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {!analysis ? (\n              <div className=\"text-center py-8\">\n                <AlertCircle className=\"w-10 h-10 mx-auto mb-3 text-muted-foreground opacity-50\" />\n                <p className=\"text-muted-foreground text-sm\">اضغط تحليل لعرض Liquidity Sweeps</p>\n              </div>\n            ) : analysis.liquiditySweeps.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-muted-foreground text-sm\">لا توجد Liquidity Sweeps حالياً</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {analysis.liquiditySweeps.map((sweep, index) => (\n                  <div \n                    key={index}\n                    className={cn(\n                      \"p-3 rounded-md border\",\n                      sweep.reversal \n                        ? sweep.type === \"sell_side\" ? \"bg-success/5 border-success/20\" : \"bg-destructive/5 border-destructive/20\"\n                        : \"bg-muted border-border\"\n                    )}\n                    data-testid={`sweep-${index}`}\n                  >\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium\">\n                          {sweep.type === \"buy_side\" ? \"Buy Side\" : \"Sell Side\"}\n                        </span>\n                        {sweep.reversal && (\n                          <Badge className={sweep.type === \"sell_side\" ? \"bg-success/20 text-success\" : \"bg-destructive/20 text-destructive\"}>\n                            انعكاس\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\" dir=\"ltr\">\n                      Level: ${sweep.level.toFixed(2)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":20559,"size_tokens":null},"server/smc.ts":{"content":"import { mexcService } from \"./mexc\";\n\nexport interface Candle {\n  time: number;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n  volume: number;\n}\n\nexport interface KillZone {\n  name: string;\n  nameAr: string;\n  startHour: number;\n  endHour: number;\n  isActive: boolean;\n  description: string;\n}\n\nexport interface FairValueGap {\n  type: \"bullish\" | \"bearish\";\n  startPrice: number;\n  endPrice: number;\n  gapSize: number;\n  gapPercent: number;\n  timestamp: number;\n  filled: boolean;\n}\n\nexport interface OrderBlock {\n  type: \"bullish\" | \"bearish\";\n  priceHigh: number;\n  priceLow: number;\n  strength: number;\n  timestamp: number;\n  tested: boolean;\n}\n\nexport interface LiquiditySweep {\n  type: \"buy_side\" | \"sell_side\";\n  level: number;\n  sweptAt: number;\n  priceAfterSweep: number;\n  reversal: boolean;\n}\n\nexport interface SMCAnalysis {\n  symbol: string;\n  timestamp: number;\n  killZones: KillZone[];\n  activeKillZone: KillZone | null;\n  fairValueGaps: FairValueGap[];\n  orderBlocks: OrderBlock[];\n  liquiditySweeps: LiquiditySweep[];\n  marketStructure: \"bullish\" | \"bearish\" | \"ranging\";\n  bias: \"long\" | \"short\" | \"neutral\";\n  confidenceScore: number;\n}\n\nconst KILL_ZONES: Omit<KillZone, \"isActive\">[] = [\n  {\n    name: \"Asian Session\",\n    nameAr: \"الجلسة الآسيوية\",\n    startHour: 0,\n    endHour: 8,\n    description: \"Low volatility consolidation phase\",\n  },\n  {\n    name: \"London Session\",\n    nameAr: \"جلسة لندن\",\n    startHour: 8,\n    endHour: 12,\n    description: \"High volatility, major moves initiate here\",\n  },\n  {\n    name: \"NY AM Session\",\n    nameAr: \"جلسة نيويورك الصباحية\",\n    startHour: 13,\n    endHour: 16,\n    description: \"Continuation or reversal of London moves\",\n  },\n  {\n    name: \"NY PM Session\",\n    nameAr: \"جلسة نيويورك المسائية\",\n    startHour: 19,\n    endHour: 21,\n    description: \"Late day reversals and position squaring\",\n  },\n];\n\nfunction getActiveKillZones(): KillZone[] {\n  const now = new Date();\n  const utcHour = now.getUTCHours();\n\n  return KILL_ZONES.map((kz) => ({\n    ...kz,\n    isActive: utcHour >= kz.startHour && utcHour < kz.endHour,\n  }));\n}\n\nfunction detectFairValueGaps(candles: Candle[]): FairValueGap[] {\n  const gaps: FairValueGap[] = [];\n\n  for (let i = 2; i < candles.length; i++) {\n    const candle1 = candles[i - 2];\n    const candle2 = candles[i - 1];\n    const candle3 = candles[i];\n\n    if (candle1.low > candle3.high) {\n      const gapSize = candle1.low - candle3.high;\n      const gapPercent = (gapSize / candle2.close) * 100;\n\n      if (gapPercent > 0.1) {\n        gaps.push({\n          type: \"bearish\",\n          startPrice: candle3.high,\n          endPrice: candle1.low,\n          gapSize,\n          gapPercent,\n          timestamp: candle2.time,\n          filled: false,\n        });\n      }\n    }\n\n    if (candle3.low > candle1.high) {\n      const gapSize = candle3.low - candle1.high;\n      const gapPercent = (gapSize / candle2.close) * 100;\n\n      if (gapPercent > 0.1) {\n        gaps.push({\n          type: \"bullish\",\n          startPrice: candle1.high,\n          endPrice: candle3.low,\n          gapSize,\n          gapPercent,\n          timestamp: candle2.time,\n          filled: false,\n        });\n      }\n    }\n  }\n\n  return gaps.slice(-10);\n}\n\nfunction detectOrderBlocks(candles: Candle[]): OrderBlock[] {\n  const blocks: OrderBlock[] = [];\n\n  for (let i = 3; i < candles.length; i++) {\n    const candle = candles[i - 1];\n    const prevCandles = candles.slice(i - 3, i - 1);\n    const nextCandle = candles[i];\n\n    const isBullishCandle = candle.close > candle.open;\n    const isBearishCandle = candle.close < candle.open;\n\n    const prevTrend = prevCandles.reduce((acc, c) => acc + (c.close - c.open), 0);\n\n    if (isBullishCandle && prevTrend < 0) {\n      const bodySize = Math.abs(candle.close - candle.open);\n      const range = candle.high - candle.low;\n      const strength = (bodySize / range) * 100;\n\n      if (strength > 50) {\n        blocks.push({\n          type: \"bullish\",\n          priceHigh: Math.max(candle.open, candle.close),\n          priceLow: Math.min(candle.open, candle.close),\n          strength: Math.min(strength, 100),\n          timestamp: candle.time,\n          tested: nextCandle.low <= candle.high,\n        });\n      }\n    }\n\n    if (isBearishCandle && prevTrend > 0) {\n      const bodySize = Math.abs(candle.close - candle.open);\n      const range = candle.high - candle.low;\n      const strength = (bodySize / range) * 100;\n\n      if (strength > 50) {\n        blocks.push({\n          type: \"bearish\",\n          priceHigh: Math.max(candle.open, candle.close),\n          priceLow: Math.min(candle.open, candle.close),\n          strength: Math.min(strength, 100),\n          timestamp: candle.time,\n          tested: nextCandle.high >= candle.low,\n        });\n      }\n    }\n  }\n\n  return blocks.slice(-10);\n}\n\nfunction detectLiquiditySweeps(candles: Candle[]): LiquiditySweep[] {\n  const sweeps: LiquiditySweep[] = [];\n\n  const recentHighs: { price: number; index: number }[] = [];\n  const recentLows: { price: number; index: number }[] = [];\n\n  for (let i = 2; i < candles.length - 1; i++) {\n    const prev = candles[i - 1];\n    const curr = candles[i];\n    const next = candles[i + 1];\n\n    if (prev.high < curr.high && next.high < curr.high) {\n      recentHighs.push({ price: curr.high, index: i });\n    }\n\n    if (prev.low > curr.low && next.low > curr.low) {\n      recentLows.push({ price: curr.low, index: i });\n    }\n  }\n\n  for (let i = 5; i < candles.length; i++) {\n    const candle = candles[i];\n\n    for (const high of recentHighs) {\n      if (high.index < i - 3 && candle.high > high.price * 1.001) {\n        const nextCandle = candles[i + 1] || candle;\n        const reversal = nextCandle.close < high.price;\n\n        sweeps.push({\n          type: \"buy_side\",\n          level: high.price,\n          sweptAt: candle.time,\n          priceAfterSweep: nextCandle.close,\n          reversal,\n        });\n      }\n    }\n\n    for (const low of recentLows) {\n      if (low.index < i - 3 && candle.low < low.price * 0.999) {\n        const nextCandle = candles[i + 1] || candle;\n        const reversal = nextCandle.close > low.price;\n\n        sweeps.push({\n          type: \"sell_side\",\n          level: low.price,\n          sweptAt: candle.time,\n          priceAfterSweep: nextCandle.close,\n          reversal,\n        });\n      }\n    }\n  }\n\n  return sweeps.slice(-10);\n}\n\nfunction determineMarketStructure(\n  candles: Candle[]\n): \"bullish\" | \"bearish\" | \"ranging\" {\n  if (candles.length < 10) return \"ranging\";\n\n  const recentCandles = candles.slice(-20);\n\n  let higherHighs = 0;\n  let lowerLows = 0;\n  let higherLows = 0;\n  let lowerHighs = 0;\n\n  for (let i = 4; i < recentCandles.length; i++) {\n    const curr = recentCandles[i];\n    const prev = recentCandles[i - 4];\n\n    if (curr.high > prev.high) higherHighs++;\n    if (curr.low < prev.low) lowerLows++;\n    if (curr.low > prev.low) higherLows++;\n    if (curr.high < prev.high) lowerHighs++;\n  }\n\n  const bullishScore = higherHighs + higherLows;\n  const bearishScore = lowerLows + lowerHighs;\n\n  if (bullishScore > bearishScore * 1.3) return \"bullish\";\n  if (bearishScore > bullishScore * 1.3) return \"bearish\";\n  return \"ranging\";\n}\n\nfunction determineBias(\n  structure: \"bullish\" | \"bearish\" | \"ranging\",\n  orderBlocks: OrderBlock[],\n  fvgs: FairValueGap[],\n  sweeps: LiquiditySweep[]\n): { bias: \"long\" | \"short\" | \"neutral\"; confidence: number } {\n  let bullishScore = 0;\n  let bearishScore = 0;\n\n  if (structure === \"bullish\") bullishScore += 30;\n  else if (structure === \"bearish\") bearishScore += 30;\n\n  const recentOBs = orderBlocks.slice(-5);\n  for (const ob of recentOBs) {\n    if (ob.type === \"bullish\" && !ob.tested) bullishScore += 10;\n    if (ob.type === \"bearish\" && !ob.tested) bearishScore += 10;\n  }\n\n  const recentFVGs = fvgs.slice(-5);\n  for (const fvg of recentFVGs) {\n    if (fvg.type === \"bullish\" && !fvg.filled) bullishScore += 8;\n    if (fvg.type === \"bearish\" && !fvg.filled) bearishScore += 8;\n  }\n\n  const recentSweeps = sweeps.slice(-3);\n  for (const sweep of recentSweeps) {\n    if (sweep.type === \"sell_side\" && sweep.reversal) bullishScore += 15;\n    if (sweep.type === \"buy_side\" && sweep.reversal) bearishScore += 15;\n  }\n\n  const totalScore = bullishScore + bearishScore;\n  const maxScore = 100;\n\n  if (bullishScore > bearishScore * 1.2) {\n    return {\n      bias: \"long\",\n      confidence: Math.min((bullishScore / maxScore) * 100, 95),\n    };\n  }\n  if (bearishScore > bullishScore * 1.2) {\n    return {\n      bias: \"short\",\n      confidence: Math.min((bearishScore / maxScore) * 100, 95),\n    };\n  }\n\n  return {\n    bias: \"neutral\",\n    confidence: Math.min((Math.max(bullishScore, bearishScore) / maxScore) * 100, 50),\n  };\n}\n\nexport async function analyzeSMC(\n  symbol: string,\n  candles: Candle[]\n): Promise<SMCAnalysis> {\n  const killZones = getActiveKillZones();\n  const activeKillZone = killZones.find((kz) => kz.isActive) || null;\n\n  const fairValueGaps = detectFairValueGaps(candles);\n  const orderBlocks = detectOrderBlocks(candles);\n  const liquiditySweeps = detectLiquiditySweeps(candles);\n  const marketStructure = determineMarketStructure(candles);\n\n  const { bias, confidence } = determineBias(\n    marketStructure,\n    orderBlocks,\n    fairValueGaps,\n    liquiditySweeps\n  );\n\n  return {\n    symbol,\n    timestamp: Date.now(),\n    killZones,\n    activeKillZone,\n    fairValueGaps,\n    orderBlocks,\n    liquiditySweeps,\n    marketStructure,\n    bias,\n    confidenceScore: confidence,\n  };\n}\n\nexport function generateSMCSignal(analysis: SMCAnalysis): {\n  action: \"buy\" | \"sell\" | \"hold\";\n  reason: string;\n  confidence: number;\n  killZoneBonus: boolean;\n} {\n  const isInKillZone = analysis.activeKillZone !== null;\n  let action: \"buy\" | \"sell\" | \"hold\" = \"hold\";\n  let reason = \"\";\n  let confidence = analysis.confidenceScore;\n\n  if (isInKillZone) {\n    confidence = Math.min(confidence * 1.2, 95);\n  }\n\n  if (analysis.bias === \"long\" && confidence >= 60) {\n    const recentBullishOB = analysis.orderBlocks\n      .filter((ob) => ob.type === \"bullish\" && !ob.tested)\n      .slice(-1)[0];\n    const recentBullishFVG = analysis.fairValueGaps\n      .filter((fvg) => fvg.type === \"bullish\" && !fvg.filled)\n      .slice(-1)[0];\n    const sellSideSweep = analysis.liquiditySweeps\n      .filter((s) => s.type === \"sell_side\" && s.reversal)\n      .slice(-1)[0];\n\n    if (sellSideSweep) {\n      action = \"buy\";\n      reason = `Sell-side liquidity swept with reversal confirmation. Market structure is ${analysis.marketStructure}.`;\n    } else if (recentBullishOB && recentBullishFVG) {\n      action = \"buy\";\n      reason = `Bullish order block and FVG confluence. Price expected to fill the gap.`;\n    } else if (recentBullishOB) {\n      action = \"buy\";\n      reason = `Untested bullish order block in ${analysis.marketStructure} market structure.`;\n    }\n  } else if (analysis.bias === \"short\" && confidence >= 60) {\n    const recentBearishOB = analysis.orderBlocks\n      .filter((ob) => ob.type === \"bearish\" && !ob.tested)\n      .slice(-1)[0];\n    const recentBearishFVG = analysis.fairValueGaps\n      .filter((fvg) => fvg.type === \"bearish\" && !fvg.filled)\n      .slice(-1)[0];\n    const buySideSweep = analysis.liquiditySweeps\n      .filter((s) => s.type === \"buy_side\" && s.reversal)\n      .slice(-1)[0];\n\n    if (buySideSweep) {\n      action = \"sell\";\n      reason = `Buy-side liquidity swept with reversal confirmation. Market structure is ${analysis.marketStructure}.`;\n    } else if (recentBearishOB && recentBearishFVG) {\n      action = \"sell\";\n      reason = `Bearish order block and FVG confluence. Price expected to fill the gap.`;\n    } else if (recentBearishOB) {\n      action = \"sell\";\n      reason = `Untested bearish order block in ${analysis.marketStructure} market structure.`;\n    }\n  }\n\n  if (action === \"hold\") {\n    reason = `No clear SMC setup. Market structure is ${analysis.marketStructure}. Waiting for confluence.`;\n    confidence = Math.min(confidence, 40);\n  }\n\n  if (isInKillZone && action !== \"hold\") {\n    reason += ` Active during ${analysis.activeKillZone?.name} - higher probability setup.`;\n  }\n\n  return {\n    action,\n    reason,\n    confidence: Math.round(confidence),\n    killZoneBonus: isInKillZone,\n  };\n}\n\nexport const smcService = {\n  analyzeSMC,\n  generateSMCSignal,\n  getActiveKillZones,\n  detectFairValueGaps,\n  detectOrderBlocks,\n  detectLiquiditySweeps,\n  determineMarketStructure,\n};\n","path":null,"size_bytes":12516,"size_tokens":null},"client/src/pages/wallet.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Wallet, ArrowUpCircle, ArrowDownCircle, Copy, CheckCircle, Clock, XCircle, RefreshCw, AlertTriangle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { Transaction, WalletAddress } from \"@shared/schema\";\n\ninterface MexcBalance {\n  asset: string;\n  free: string;\n  locked: string;\n}\n\ninterface CoinNetwork {\n  network: string;\n  isDefault: boolean;\n  depositEnable: boolean;\n  withdrawEnable: boolean;\n  withdrawFee: string;\n  withdrawMin: string;\n  withdrawMax: string;\n}\n\ninterface CoinInfo {\n  coin: string;\n  name: string;\n  networkList: CoinNetwork[];\n}\n\nexport default function WalletPage() {\n  const { toast } = useToast();\n  const [selectedCoin, setSelectedCoin] = useState<string>(\"USDT\");\n  const [selectedNetwork, setSelectedNetwork] = useState<string>(\"\");\n  const [withdrawAddress, setWithdrawAddress] = useState(\"\");\n  const [withdrawAmount, setWithdrawAmount] = useState(\"\");\n  const [withdrawMemo, setWithdrawMemo] = useState(\"\");\n  const [isDepositDialogOpen, setIsDepositDialogOpen] = useState(false);\n  const [isWithdrawDialogOpen, setIsWithdrawDialogOpen] = useState(false);\n  const [copiedAddress, setCopiedAddress] = useState(false);\n\n  const { data: balances = [], isLoading: loadingBalances, refetch: refetchBalances } = useQuery<MexcBalance[]>({\n    queryKey: [\"/api/mexc/balance\"],\n  });\n\n  const { data: coins = [], isLoading: loadingCoins } = useQuery<CoinInfo[]>({\n    queryKey: [\"/api/mexc/coins\"],\n  });\n\n  const { data: transactions = [], isLoading: loadingTx } = useQuery<Transaction[]>({\n    queryKey: [\"/api/user/transactions\"],\n  });\n\n  const { data: walletAddresses = [] } = useQuery<WalletAddress[]>({\n    queryKey: [\"/api/wallet/addresses\"],\n  });\n\n  const selectedCoinInfo = coins.find(c => c.coin === selectedCoin);\n  const availableNetworks = selectedCoinInfo?.networkList.filter(n => n.depositEnable || n.withdrawEnable) || [];\n\n  const getDepositAddressMutation = useMutation({\n    mutationFn: async ({ coin, network }: { coin: string; network: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/mexc/deposit/address\", { coin, network });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet/addresses\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في الحصول على عنوان الإيداع\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const withdrawMutation = useMutation({\n    mutationFn: async (data: { coin: string; address: string; amount: string; network: string; memo?: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/mexc/withdraw\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"تم الإرسال\",\n        description: \"تم إرسال طلب السحب بنجاح\",\n      });\n      setIsWithdrawDialogOpen(false);\n      setWithdrawAddress(\"\");\n      setWithdrawAmount(\"\");\n      setWithdrawMemo(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/transactions\"] });\n      refetchBalances();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في معالجة طلب السحب\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const syncMarketMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/mexc/sync-market\", {});\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"تم التحديث\",\n        description: \"تم تحديث بيانات السوق بنجاح\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/market\"] });\n    },\n  });\n\n  const syncDepositsMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/mexc/reconcile/deposits\", {});\n      return res.json();\n    },\n    onSuccess: (data: { created: number; updated: number; skipped: number }) => {\n      toast({\n        title: \"تم المزامنة\",\n        description: `تم إضافة ${data.created} ايداع وتحديث ${data.updated} عملية`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/shares\"] });\n      refetchBalances();\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في مزامنة الإيداعات\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const syncWithdrawalsMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/mexc/reconcile/withdrawals\", {});\n      return res.json();\n    },\n    onSuccess: (data: { updated: number; skipped: number }) => {\n      toast({\n        title: \"تم المزامنة\",\n        description: `تم تحديث ${data.updated} عملية سحب`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/transactions\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في مزامنة السحوبات\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGetDepositAddress = async () => {\n    if (!selectedCoin || !selectedNetwork) {\n      toast({\n        title: \"خطأ\",\n        description: \"يرجى اختيار العملة والشبكة\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    await getDepositAddressMutation.mutateAsync({ coin: selectedCoin, network: selectedNetwork });\n  };\n\n  const handleWithdraw = async () => {\n    if (!selectedCoin || !selectedNetwork || !withdrawAddress || !withdrawAmount) {\n      toast({\n        title: \"خطأ\",\n        description: \"يرجى ملء جميع الحقول المطلوبة\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const networkInfo = availableNetworks.find(n => n.network === selectedNetwork);\n    if (networkInfo) {\n      const amount = parseFloat(withdrawAmount);\n      const minAmount = parseFloat(networkInfo.withdrawMin);\n      if (amount < minAmount) {\n        toast({\n          title: \"خطأ\",\n          description: `الحد الأدنى للسحب هو ${minAmount} ${selectedCoin}`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n    }\n\n    await withdrawMutation.mutateAsync({\n      coin: selectedCoin,\n      address: withdrawAddress,\n      amount: withdrawAmount,\n      network: selectedNetwork,\n      memo: withdrawMemo || undefined,\n    });\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedAddress(true);\n    setTimeout(() => setCopiedAddress(false), 2000);\n    toast({\n      title: \"تم النسخ\",\n      description: \"تم نسخ العنوان إلى الحافظة\",\n    });\n  };\n\n  const currentDepositAddress = walletAddresses.find(\n    a => a.coin === selectedCoin && a.network === selectedNetwork\n  );\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"confirmed\":\n        return <Badge variant=\"outline\" className=\"bg-success/10 text-success border-success/20\"><CheckCircle className=\"w-3 h-3 ml-1\" />مؤكد</Badge>;\n      case \"pending\":\n        return <Badge variant=\"outline\" className=\"bg-warning/10 text-warning border-warning/20\"><Clock className=\"w-3 h-3 ml-1\" />قيد الانتظار</Badge>;\n      case \"failed\":\n      case \"cancelled\":\n        return <Badge variant=\"outline\" className=\"bg-destructive/10 text-destructive border-destructive/20\"><XCircle className=\"w-3 h-3 ml-1\" />فشل</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const formatNumber = (value: string | number, decimals = 8) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    if (isNaN(num)) return \"0\";\n    return num.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: decimals });\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">المحفظة</h1>\n          <p className=\"text-muted-foreground text-sm\">إدارة الإيداعات والسحوبات</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => {\n              refetchBalances();\n              syncMarketMutation.mutate();\n            }}\n            disabled={syncMarketMutation.isPending}\n            data-testid=\"button-refresh-balance\"\n          >\n            <RefreshCw className={cn(\"w-4 h-4 ml-2\", syncMarketMutation.isPending && \"animate-spin\")} />\n            تحديث\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => {\n              syncDepositsMutation.mutate();\n              syncWithdrawalsMutation.mutate();\n            }}\n            disabled={syncDepositsMutation.isPending || syncWithdrawalsMutation.isPending}\n            data-testid=\"button-sync-transactions\"\n          >\n            <RefreshCw className={cn(\"w-4 h-4 ml-2\", (syncDepositsMutation.isPending || syncWithdrawalsMutation.isPending) && \"animate-spin\")} />\n            مزامنة المعاملات\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card data-testid=\"card-balances\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Wallet className=\"w-5 h-5\" />\n                أرصدة MEXC\n              </CardTitle>\n              <CardDescription>أرصدتك على منصة MEXC</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingBalances ? (\n                <div className=\"space-y-3\">\n                  {[1, 2, 3].map(i => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : balances.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Wallet className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                  <p>لا توجد أرصدة حالياً</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {balances.map((balance) => (\n                    <div\n                      key={balance.asset}\n                      className=\"flex items-center justify-between p-4 rounded-md bg-muted/50\"\n                      data-testid={`balance-${balance.asset}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center font-bold text-primary\">\n                          {balance.asset.slice(0, 2)}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{balance.asset}</p>\n                          <p className=\"text-xs text-muted-foreground\">متاح للتداول</p>\n                        </div>\n                      </div>\n                      <div className=\"text-left\" dir=\"ltr\">\n                        <p className=\"font-bold\">{formatNumber(balance.free)}</p>\n                        {parseFloat(balance.locked) > 0 && (\n                          <p className=\"text-xs text-muted-foreground\">مقفل: {formatNumber(balance.locked)}</p>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-transactions\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">سجل المعاملات</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingTx ? (\n                <div className=\"space-y-3\">\n                  {[1, 2, 3].map(i => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : transactions.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <p>لا توجد معاملات</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {transactions.slice(0, 10).map((tx) => (\n                    <div\n                      key={tx.id}\n                      className=\"flex items-center justify-between p-4 rounded-md bg-muted/50\"\n                      data-testid={`transaction-${tx.id}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className={cn(\n                          \"p-2 rounded-md\",\n                          tx.type === \"deposit\" ? \"bg-success/10\" : \"bg-destructive/10\"\n                        )}>\n                          {tx.type === \"deposit\" ? (\n                            <ArrowUpCircle className=\"w-4 h-4 text-success\" />\n                          ) : (\n                            <ArrowDownCircle className=\"w-4 h-4 text-destructive\" />\n                          )}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{tx.type === \"deposit\" ? \"إيداع\" : \"سحب\"}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {tx.createdAt ? new Date(tx.createdAt).toLocaleString(\"ar-SA\") : \"-\"}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-4\">\n                        {getStatusBadge(tx.status)}\n                        <span className={cn(\n                          \"font-bold\",\n                          tx.type === \"deposit\" ? \"text-success\" : \"text-destructive\"\n                        )} dir=\"ltr\">\n                          {tx.type === \"deposit\" ? \"+\" : \"-\"}${formatNumber(tx.amount, 2)}\n                        </span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-actions\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">العمليات</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Dialog open={isDepositDialogOpen} onOpenChange={setIsDepositDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button className=\"w-full gap-2\" data-testid=\"button-deposit-open\">\n                    <ArrowUpCircle className=\"w-4 h-4\" />\n                    إيداع\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>إيداع أموال</DialogTitle>\n                    <DialogDescription>\n                      اختر العملة والشبكة للحصول على عنوان الإيداع\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <Label>العملة</Label>\n                      <Select value={selectedCoin} onValueChange={(v) => { setSelectedCoin(v); setSelectedNetwork(\"\"); }}>\n                        <SelectTrigger data-testid=\"select-deposit-coin\">\n                          <SelectValue placeholder=\"اختر العملة\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {loadingCoins ? (\n                            <SelectItem value=\"loading\" disabled>جاري التحميل...</SelectItem>\n                          ) : (\n                            <>\n                              <SelectItem value=\"USDT\">USDT</SelectItem>\n                              <SelectItem value=\"BTC\">BTC</SelectItem>\n                              <SelectItem value=\"ETH\">ETH</SelectItem>\n                              {coins.filter(c => ![\"USDT\", \"BTC\", \"ETH\"].includes(c.coin)).slice(0, 20).map(c => (\n                                <SelectItem key={c.coin} value={c.coin}>{c.coin}</SelectItem>\n                              ))}\n                            </>\n                          )}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>الشبكة</Label>\n                      <Select value={selectedNetwork} onValueChange={setSelectedNetwork}>\n                        <SelectTrigger data-testid=\"select-deposit-network\">\n                          <SelectValue placeholder=\"اختر الشبكة\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {availableNetworks.filter(n => n.depositEnable).map(n => (\n                            <SelectItem key={n.network} value={n.network}>\n                              {n.network} {n.isDefault && \"(افتراضي)\"}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    {selectedNetwork && (\n                      <Button\n                        onClick={handleGetDepositAddress}\n                        disabled={getDepositAddressMutation.isPending}\n                        className=\"w-full\"\n                        data-testid=\"button-get-address\"\n                      >\n                        {getDepositAddressMutation.isPending ? \"جاري التحميل...\" : \"الحصول على العنوان\"}\n                      </Button>\n                    )}\n\n                    {currentDepositAddress && (\n                      <div className=\"space-y-3 p-4 bg-muted rounded-md\">\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <Label className=\"text-xs text-muted-foreground\">عنوان الإيداع</Label>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(currentDepositAddress.address)}\n                            data-testid=\"button-copy-address\"\n                          >\n                            {copiedAddress ? <CheckCircle className=\"w-4 h-4 text-success\" /> : <Copy className=\"w-4 h-4\" />}\n                          </Button>\n                        </div>\n                        <p className=\"text-xs font-mono break-all bg-background p-2 rounded\" dir=\"ltr\" data-testid=\"text-deposit-address\">\n                          {currentDepositAddress.address}\n                        </p>\n                        {currentDepositAddress.memo && (\n                          <>\n                            <Label className=\"text-xs text-muted-foreground\">Memo/Tag</Label>\n                            <p className=\"text-xs font-mono bg-background p-2 rounded\" dir=\"ltr\">\n                              {currentDepositAddress.memo}\n                            </p>\n                          </>\n                        )}\n                        <div className=\"flex items-start gap-2 p-2 bg-warning/10 rounded text-warning text-xs\">\n                          <AlertTriangle className=\"w-4 h-4 shrink-0 mt-0.5\" />\n                          <span>تأكد من إرسال {selectedCoin} فقط عبر شبكة {selectedNetwork}. إرسال عملات أخرى قد يؤدي لفقدانها.</span>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </DialogContent>\n              </Dialog>\n\n              <Dialog open={isWithdrawDialogOpen} onOpenChange={setIsWithdrawDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" className=\"w-full gap-2\" data-testid=\"button-withdraw-open\">\n                    <ArrowDownCircle className=\"w-4 h-4\" />\n                    سحب\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>سحب أموال</DialogTitle>\n                    <DialogDescription>\n                      أدخل تفاصيل السحب\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <Label>العملة</Label>\n                      <Select value={selectedCoin} onValueChange={(v) => { setSelectedCoin(v); setSelectedNetwork(\"\"); }}>\n                        <SelectTrigger data-testid=\"select-withdraw-coin\">\n                          <SelectValue placeholder=\"اختر العملة\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {balances.map(b => (\n                            <SelectItem key={b.asset} value={b.asset}>\n                              {b.asset} (متاح: {formatNumber(b.free)})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>الشبكة</Label>\n                      <Select value={selectedNetwork} onValueChange={setSelectedNetwork}>\n                        <SelectTrigger data-testid=\"select-withdraw-network\">\n                          <SelectValue placeholder=\"اختر الشبكة\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {availableNetworks.filter(n => n.withdrawEnable).map(n => (\n                            <SelectItem key={n.network} value={n.network}>\n                              {n.network} (رسوم: {n.withdrawFee})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>عنوان المحفظة</Label>\n                      <Input\n                        placeholder=\"أدخل عنوان المحفظة\"\n                        value={withdrawAddress}\n                        onChange={(e) => setWithdrawAddress(e.target.value)}\n                        dir=\"ltr\"\n                        data-testid=\"input-withdraw-address\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>المبلغ</Label>\n                      <Input\n                        type=\"number\"\n                        placeholder=\"أدخل المبلغ\"\n                        value={withdrawAmount}\n                        onChange={(e) => setWithdrawAmount(e.target.value)}\n                        dir=\"ltr\"\n                        data-testid=\"input-withdraw-amount\"\n                      />\n                      {selectedNetwork && (() => {\n                        const networkInfo = availableNetworks.find(n => n.network === selectedNetwork);\n                        if (networkInfo) {\n                          return (\n                            <p className=\"text-xs text-muted-foreground\">\n                              الحد الأدنى: {networkInfo.withdrawMin} | رسوم السحب: {networkInfo.withdrawFee} {selectedCoin}\n                            </p>\n                          );\n                        }\n                        return null;\n                      })()}\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>Memo/Tag (اختياري)</Label>\n                      <Input\n                        placeholder=\"أدخل Memo إذا لزم الأمر\"\n                        value={withdrawMemo}\n                        onChange={(e) => setWithdrawMemo(e.target.value)}\n                        dir=\"ltr\"\n                        data-testid=\"input-withdraw-memo\"\n                      />\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      onClick={handleWithdraw}\n                      disabled={withdrawMutation.isPending || !withdrawAddress || !withdrawAmount || !selectedNetwork}\n                      className=\"w-full\"\n                      data-testid=\"button-confirm-withdraw\"\n                    >\n                      {withdrawMutation.isPending ? \"جاري المعالجة...\" : \"تأكيد السحب\"}\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-quick-stats\">\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">ملخص سريع</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">إجمالي الأصول</span>\n                <span className=\"font-bold\">{balances.length}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">المعاملات</span>\n                <span className=\"font-bold\">{transactions.length}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">قيد الانتظار</span>\n                <span className=\"font-bold\">{transactions.filter(t => t.status === \"pending\").length}</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":27189,"size_tokens":null},"server/mexc.ts":{"content":"import crypto from \"crypto\";\n\nconst MEXC_BASE_URL = \"https://api.mexc.com\";\nconst API_KEY = process.env.MEXC_API_KEY || \"\";\nconst API_SECRET = process.env.MEXC_API_SECRET || \"\";\n\ninterface MexcDepositAddress {\n  coin: string;\n  network: string;\n  address: string;\n  memo: string | null;\n}\n\ninterface MexcWithdrawResult {\n  id: string;\n}\n\ninterface MexcDepositRecord {\n  id: string;\n  amount: string;\n  coin: string;\n  network: string;\n  status: number;\n  address: string;\n  txId: string;\n  insertTime: number;\n  confirmTimes: string;\n}\n\ninterface MexcWithdrawRecord {\n  id: string;\n  amount: string;\n  coin: string;\n  network: string;\n  status: string;\n  address: string;\n  txId: string;\n  applyTime: number;\n  confirmNo: number;\n  transactionFee: string;\n}\n\ninterface MexcAccountBalance {\n  asset: string;\n  free: string;\n  locked: string;\n}\n\ninterface MexcCoinInfo {\n  coin: string;\n  name: string;\n  networkList: {\n    network: string;\n    isDefault: boolean;\n    depositEnable: boolean;\n    withdrawEnable: boolean;\n    withdrawFee: string;\n    withdrawMin: string;\n    withdrawMax: string;\n    minConfirm: number;\n    depositDesc?: string;\n    withdrawDesc?: string;\n    depositTips?: string;\n    withdrawTips?: string;\n  }[];\n}\n\ninterface MexcTickerPrice {\n  symbol: string;\n  price: string;\n}\n\ninterface MexcTicker24h {\n  symbol: string;\n  priceChange: string;\n  priceChangePercent: string;\n  lastPrice: string;\n  volume: string;\n  quoteVolume: string;\n  highPrice: string;\n  lowPrice: string;\n}\n\nexport interface MexcKline {\n  openTime: number;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n  volume: number;\n  closeTime: number;\n  quoteVolume: number;\n  trades: number;\n}\n\ntype KlineInterval = \"1m\" | \"5m\" | \"15m\" | \"30m\" | \"60m\" | \"4h\" | \"1d\" | \"1w\";\n\nfunction generateSignature(queryString: string): string {\n  return crypto\n    .createHmac(\"sha256\", API_SECRET)\n    .update(queryString)\n    .digest(\"hex\");\n}\n\nfunction sortParams(params: Record<string, string | number>): string {\n  const sorted = Object.keys(params)\n    .sort()\n    .map((key) => `${key}=${encodeURIComponent(params[key])}`)\n    .join(\"&\");\n  return sorted;\n}\n\nasync function makeSignedRequest<T>(\n  method: \"GET\" | \"POST\" | \"DELETE\",\n  endpoint: string,\n  params: Record<string, string | number> = {}\n): Promise<T> {\n  const timestamp = Date.now();\n  const allParams = { ...params, timestamp, recvWindow: 60000 };\n  const queryString = sortParams(allParams);\n  const signature = generateSignature(queryString);\n  const finalQueryString = `${queryString}&signature=${signature}`;\n\n  const url = `${MEXC_BASE_URL}${endpoint}?${finalQueryString}`;\n\n  const response = await fetch(url, {\n    method,\n    headers: {\n      \"X-MEXC-APIKEY\": API_KEY,\n      \"Content-Type\": \"application/json\",\n    },\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    console.error(`MEXC API Error: ${response.status} - ${errorText}`);\n    throw new Error(`MEXC API Error: ${response.status} - ${errorText}`);\n  }\n\n  return response.json();\n}\n\nasync function makePublicRequest<T>(endpoint: string): Promise<T> {\n  const url = `${MEXC_BASE_URL}${endpoint}`;\n  const response = await fetch(url);\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`MEXC API Error: ${response.status} - ${errorText}`);\n  }\n\n  return response.json();\n}\n\nexport const mexcService = {\n  async getDepositAddress(\n    coin: string,\n    network: string\n  ): Promise<MexcDepositAddress[]> {\n    return makeSignedRequest<MexcDepositAddress[]>(\n      \"POST\",\n      \"/api/v3/capital/deposit/address\",\n      { coin: coin.toUpperCase(), network: network.toUpperCase() }\n    );\n  },\n\n  async getDepositHistory(\n    coin?: string,\n    status?: number,\n    startTime?: number,\n    endTime?: number,\n    limit: number = 100\n  ): Promise<MexcDepositRecord[]> {\n    const params: Record<string, string | number> = { limit };\n    if (coin) params.coin = coin.toUpperCase();\n    if (status !== undefined) params.status = status;\n    if (startTime) params.startTime = startTime;\n    if (endTime) params.endTime = endTime;\n\n    return makeSignedRequest<MexcDepositRecord[]>(\n      \"GET\",\n      \"/api/v3/capital/deposit/hisrec\",\n      params\n    );\n  },\n\n  async withdraw(\n    coin: string,\n    address: string,\n    amount: string,\n    network: string,\n    memo?: string\n  ): Promise<MexcWithdrawResult> {\n    const params: Record<string, string | number> = {\n      coin: coin.toUpperCase(),\n      address,\n      amount,\n      network: network.toUpperCase(),\n    };\n    if (memo) params.withdrawOrderId = memo;\n\n    return makeSignedRequest<MexcWithdrawResult>(\n      \"POST\",\n      \"/api/v3/capital/withdraw/apply\",\n      params\n    );\n  },\n\n  async getWithdrawHistory(\n    coin?: string,\n    status?: string,\n    startTime?: number,\n    endTime?: number,\n    limit: number = 100\n  ): Promise<MexcWithdrawRecord[]> {\n    const params: Record<string, string | number> = { limit };\n    if (coin) params.coin = coin.toUpperCase();\n    if (status) params.status = status;\n    if (startTime) params.startTime = startTime;\n    if (endTime) params.endTime = endTime;\n\n    return makeSignedRequest<MexcWithdrawRecord[]>(\n      \"GET\",\n      \"/api/v3/capital/withdraw/history\",\n      params\n    );\n  },\n\n  async getAccountBalance(): Promise<MexcAccountBalance[]> {\n    const result = await makeSignedRequest<{ balances: MexcAccountBalance[] }>(\n      \"GET\",\n      \"/api/v3/account\"\n    );\n    return result.balances.filter(\n      (b) => parseFloat(b.free) > 0 || parseFloat(b.locked) > 0\n    );\n  },\n\n  async getCoinInfo(): Promise<MexcCoinInfo[]> {\n    return makeSignedRequest<MexcCoinInfo[]>(\n      \"GET\",\n      \"/api/v3/capital/config/getall\"\n    );\n  },\n\n  async getNetworksForCoin(coin: string): Promise<MexcCoinInfo | undefined> {\n    const coins = await this.getCoinInfo();\n    return coins.find((c) => c.coin.toUpperCase() === coin.toUpperCase());\n  },\n\n  async getTickerPrice(symbol?: string): Promise<MexcTickerPrice[]> {\n    const endpoint = symbol\n      ? `/api/v3/ticker/price?symbol=${symbol}`\n      : \"/api/v3/ticker/price\";\n    return makePublicRequest<MexcTickerPrice[]>(endpoint);\n  },\n\n  async getTicker24h(symbol?: string): Promise<MexcTicker24h[]> {\n    const endpoint = symbol\n      ? `/api/v3/ticker/24hr?symbol=${symbol}`\n      : \"/api/v3/ticker/24hr\";\n    const result = await makePublicRequest<MexcTicker24h | MexcTicker24h[]>(\n      endpoint\n    );\n    return Array.isArray(result) ? result : [result];\n  },\n\n  async getKlines(\n    symbol: string,\n    interval: KlineInterval = \"15m\",\n    limit: number = 100\n  ): Promise<MexcKline[]> {\n    const formattedSymbol = symbol.replace(\"/\", \"\").toUpperCase();\n    const endpoint = `/api/v3/klines?symbol=${formattedSymbol}&interval=${interval}&limit=${limit}`;\n    \n    const rawData = await makePublicRequest<(string | number)[][]>(endpoint);\n    \n    return rawData.map((kline) => ({\n      openTime: Number(kline[0]),\n      open: parseFloat(String(kline[1])),\n      high: parseFloat(String(kline[2])),\n      low: parseFloat(String(kline[3])),\n      close: parseFloat(String(kline[4])),\n      volume: parseFloat(String(kline[5])),\n      closeTime: Number(kline[6]),\n      quoteVolume: parseFloat(String(kline[7])),\n      trades: Number(kline[8]),\n    }));\n  },\n\n  async testConnection(): Promise<boolean> {\n    try {\n      const balance = await this.getAccountBalance();\n      console.log(\"MEXC API connection successful\");\n      console.log(\n        `Found ${balance.length} assets with balance`\n      );\n      return true;\n    } catch (error) {\n      console.error(\"MEXC API connection failed:\", error);\n      return false;\n    }\n  },\n\n  async syncMarketData(): Promise<\n    { symbol: string; price: string; data: MexcTicker24h }[]\n  > {\n    const tradingPairs = [\n      \"BTCUSDT\",\n      \"ETHUSDT\",\n      \"SOLUSDT\",\n      \"XRPUSDT\",\n      \"BNBUSDT\",\n      \"ADAUSDT\",\n      \"DOGEUSDT\",\n      \"AVAXUSDT\",\n    ];\n\n    const results: { symbol: string; price: string; data: MexcTicker24h }[] =\n      [];\n\n    for (const pair of tradingPairs) {\n      try {\n        const tickers = await this.getTicker24h(pair);\n        if (tickers.length > 0) {\n          const ticker = tickers[0];\n          results.push({\n            symbol: pair.replace(\"USDT\", \"/USDT\"),\n            price: ticker.lastPrice,\n            data: ticker,\n          });\n        }\n      } catch (error) {\n        console.error(`Failed to get ticker for ${pair}:`, error);\n      }\n    }\n\n    return results;\n  },\n};\n\nexport type {\n  MexcDepositAddress,\n  MexcWithdrawResult,\n  MexcDepositRecord,\n  MexcWithdrawRecord,\n  MexcAccountBalance,\n  MexcCoinInfo,\n  MexcTickerPrice,\n  MexcTicker24h,\n  KlineInterval,\n};\n","path":null,"size_bytes":8730,"size_tokens":null},"server/telegram.ts":{"content":"import { storage } from \"./storage\";\n\ninterface TelegramMessage {\n  chatId: string;\n  text: string;\n  parseMode?: \"HTML\" | \"Markdown\";\n}\n\ninterface TradeNotification {\n  pair: string;\n  type: \"buy\" | \"sell\";\n  amount: string;\n  price: string;\n  total: string;\n  strategy?: string;\n  profitLoss?: string;\n}\n\ninterface PortfolioNotification {\n  totalValue: string;\n  dailyChange: string;\n  dailyChangePercent: string;\n}\n\ninterface SentimentNotification {\n  symbol: string;\n  sentiment: string;\n  score: string;\n  summary: string;\n  confidence: string;\n}\n\ninterface RlPredictionNotification {\n  symbol: string;\n  action: string;\n  confidence: string;\n  price: string;\n}\n\ninterface DepositWithdrawalNotification {\n  type: \"deposit\" | \"withdrawal\";\n  amount: string;\n  status: string;\n  coin?: string;\n  network?: string;\n}\n\nclass TelegramService {\n  private botToken: string | undefined;\n  private baseUrl: string = \"https://api.telegram.org\";\n\n  constructor() {\n    this.botToken = process.env.TELEGRAM_BOT_TOKEN;\n  }\n\n  private isConfigured(): boolean {\n    return !!this.botToken;\n  }\n\n  private async sendMessage(message: TelegramMessage): Promise<boolean> {\n    if (!this.isConfigured()) {\n      console.log(\"Telegram bot not configured - skipping notification\");\n      return false;\n    }\n\n    try {\n      const url = `${this.baseUrl}/bot${this.botToken}/sendMessage`;\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          chat_id: message.chatId,\n          text: message.text,\n          parse_mode: message.parseMode || \"HTML\",\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        console.error(\"Telegram API error:\", error);\n        return false;\n      }\n\n      return true;\n    } catch (error) {\n      console.error(\"Error sending Telegram message:\", error);\n      return false;\n    }\n  }\n\n  async sendTradeNotification(trade: TradeNotification): Promise<void> {\n    const subscribers = await storage.getUsersWithTelegramEnabled();\n    const subscribersWithTrades = subscribers.filter(s => s.tradeNotifications && s.telegramChatId);\n\n    const typeArabic = trade.type === \"buy\" ? \"شراء\" : \"بيع\";\n    const profitText = trade.profitLoss \n      ? `\\nالربح/الخسارة: ${parseFloat(trade.profitLoss) >= 0 ? \"+\" : \"\"}${trade.profitLoss} USDT`\n      : \"\";\n\n    const message = `\n<b>صفقة جديدة - ${typeArabic}</b>\n\nالزوج: ${trade.pair}\nالكمية: ${trade.amount}\nالسعر: ${trade.price}\nالإجمالي: ${trade.total} USDT\n${trade.strategy ? `الاستراتيجية: ${trade.strategy}` : \"\"}${profitText}\n\nMexAI Trader\n    `.trim();\n\n    for (const subscriber of subscribersWithTrades) {\n      if (subscriber.telegramChatId) {\n        await this.sendMessage({\n          chatId: subscriber.telegramChatId,\n          text: message,\n        });\n      }\n    }\n  }\n\n  async sendPortfolioUpdate(portfolio: PortfolioNotification): Promise<void> {\n    const subscribers = await storage.getUsersWithTelegramEnabled();\n    \n    const changeSign = parseFloat(portfolio.dailyChange) >= 0 ? \"+\" : \"\";\n\n    const message = `\n<b>تحديث المحفظة</b>\n\nالقيمة الإجمالية: ${portfolio.totalValue} USDT\nالتغير اليومي: ${changeSign}${portfolio.dailyChange} USDT (${changeSign}${portfolio.dailyChangePercent}%)\n\nMexAI Trader\n    `.trim();\n\n    for (const subscriber of subscribers) {\n      if (subscriber.telegramChatId) {\n        await this.sendMessage({\n          chatId: subscriber.telegramChatId,\n          text: message,\n        });\n      }\n    }\n  }\n\n  async sendAiSignal(sentiment: SentimentNotification): Promise<void> {\n    const subscribers = await storage.getUsersWithTelegramEnabled();\n    const subscribersWithAiSignals = subscribers.filter(s => s.aiSignalNotifications && s.telegramChatId);\n\n    const sentimentArabic = sentiment.sentiment === \"bullish\" ? \"صاعد\" : \n                           sentiment.sentiment === \"bearish\" ? \"هابط\" : \"محايد\";\n\n    const message = `\n<b>تحليل الذكاء الاصطناعي</b>\n\nالرمز: ${sentiment.symbol}\nالاتجاه: ${sentimentArabic}\nالدرجة: ${sentiment.score}/100\nالثقة: ${sentiment.confidence}%\n\nالملخص: ${sentiment.summary}\n\nMexAI Trader\n    `.trim();\n\n    for (const subscriber of subscribersWithAiSignals) {\n      if (subscriber.telegramChatId) {\n        await this.sendMessage({\n          chatId: subscriber.telegramChatId,\n          text: message,\n        });\n      }\n    }\n  }\n\n  async sendRlPrediction(prediction: RlPredictionNotification): Promise<void> {\n    const subscribers = await storage.getUsersWithTelegramEnabled();\n    const subscribersWithAiSignals = subscribers.filter(s => s.aiSignalNotifications && s.telegramChatId);\n\n    const actionArabic = prediction.action === \"buy\" ? \"شراء\" : \n                        prediction.action === \"sell\" ? \"بيع\" : \"انتظار\";\n\n    const message = `\n<b>توقع وكيل التعلم الآلي</b>\n\nالرمز: ${prediction.symbol}\nالإجراء: ${actionArabic}\nالثقة: ${(parseFloat(prediction.confidence) * 100).toFixed(1)}%\nالسعر الحالي: ${prediction.price}\n\nMexAI Trader\n    `.trim();\n\n    for (const subscriber of subscribersWithAiSignals) {\n      if (subscriber.telegramChatId) {\n        await this.sendMessage({\n          chatId: subscriber.telegramChatId,\n          text: message,\n        });\n      }\n    }\n  }\n\n  async sendDepositWithdrawalNotification(userId: string, notification: DepositWithdrawalNotification): Promise<void> {\n    const settings = await storage.getNotificationSettings(userId);\n    if (!settings?.telegramEnabled || !settings?.telegramChatId) {\n      return;\n    }\n\n    const isDeposit = notification.type === \"deposit\";\n    if ((isDeposit && !settings.depositNotifications) || (!isDeposit && !settings.withdrawalNotifications)) {\n      return;\n    }\n\n    const typeArabic = isDeposit ? \"إيداع\" : \"سحب\";\n    const statusArabic = notification.status === \"confirmed\" ? \"مؤكد\" : \n                        notification.status === \"pending\" ? \"قيد الانتظار\" : \"فشل\";\n\n    const message = `\n<b>${typeArabic}</b>\n\nالمبلغ: ${notification.amount} ${notification.coin || \"USDT\"}\nالحالة: ${statusArabic}\n${notification.network ? `الشبكة: ${notification.network}` : \"\"}\n\nMexAI Trader\n    `.trim();\n\n    await this.sendMessage({\n      chatId: settings.telegramChatId,\n      text: message,\n    });\n  }\n\n  async sendTestNotification(chatId: string): Promise<boolean> {\n    const message = `\n<b>اختبار الإشعارات</b>\n\nتم إعداد إشعارات Telegram بنجاح!\nستتلقى الآن تنبيهات فورية حول:\n- الصفقات الجديدة\n- تحديثات المحفظة\n- إشارات الذكاء الاصطناعي\n- الإيداعات والسحوبات\n\nMexAI Trader\n    `.trim();\n\n    return await this.sendMessage({\n      chatId,\n      text: message,\n    });\n  }\n\n  getBotUsername(): string | null {\n    return this.isConfigured() ? \"MexAITraderBot\" : null;\n  }\n\n  isEnabled(): boolean {\n    return this.isConfigured();\n  }\n}\n\nexport const telegramService = new TelegramService();\n","path":null,"size_bytes":7292,"size_tokens":null},"client/src/pages/telegram.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { \n  Send,\n  Bell, \n  BellOff,\n  MessageSquare,\n  TrendingUp,\n  Wallet,\n  Brain,\n  CheckCircle2,\n  XCircle,\n  Copy,\n  ExternalLink\n} from \"lucide-react\";\nimport type { NotificationSettings } from \"@shared/schema\";\n\nexport default function TelegramNotifications() {\n  const { toast } = useToast();\n  const [chatId, setChatId] = useState(\"\");\n  \n  const { data: telegramStatus, isLoading: statusLoading } = useQuery<{ enabled: boolean; botUsername: string | null }>({\n    queryKey: [\"/api/telegram/status\"],\n  });\n\n  const { data: settings, isLoading: settingsLoading } = useQuery<NotificationSettings>({\n    queryKey: [\"/api/telegram/settings\"],\n  });\n\n  const subscribeMutation = useMutation({\n    mutationFn: async (chatId: string) => {\n      return apiRequest(\"POST\", \"/api/telegram/subscribe\", { chatId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/telegram/settings\"] });\n      toast({\n        title: \"تم الاتصال\",\n        description: \"تم ربط حساب Telegram بنجاح\",\n      });\n      setChatId(\"\");\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في ربط حساب Telegram\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const unsubscribeMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/telegram/unsubscribe\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/telegram/settings\"] });\n      toast({\n        title: \"تم إلغاء الاتصال\",\n        description: \"تم فصل حساب Telegram\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في فصل حساب Telegram\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (data: Partial<NotificationSettings>) => {\n      return apiRequest(\"PATCH\", \"/api/telegram/settings\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/telegram/settings\"] });\n      toast({\n        title: \"تم الحفظ\",\n        description: \"تم تحديث إعدادات الإشعارات\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في تحديث الإعدادات\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const testMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/telegram/test\");\n    },\n    onSuccess: () => {\n      toast({\n        title: \"تم الإرسال\",\n        description: \"تم إرسال إشعار تجريبي إلى Telegram\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"خطأ\",\n        description: error.message || \"فشل في إرسال الإشعار التجريبي\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggle = (key: keyof NotificationSettings, value: boolean) => {\n    updateSettingsMutation.mutate({ [key]: value });\n  };\n\n  const handleSubscribe = () => {\n    if (chatId.trim()) {\n      subscribeMutation.mutate(chatId.trim());\n    }\n  };\n\n  const copyBotLink = () => {\n    const botUsername = telegramStatus?.botUsername || \"MexAITraderBot\";\n    navigator.clipboard.writeText(`https://t.me/${botUsername}`);\n    toast({\n      title: \"تم النسخ\",\n      description: \"تم نسخ رابط البوت\",\n    });\n  };\n\n  const isLoading = statusLoading || settingsLoading;\n  const isConnected = settings?.telegramEnabled && settings?.telegramChatId;\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 md:p-6 space-y-6\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"h-8 bg-muted rounded w-48\" />\n          <div className=\"h-64 bg-muted rounded\" />\n          <div className=\"h-64 bg-muted rounded\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 mb-2\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">إشعارات Telegram</h1>\n          <p className=\"text-muted-foreground text-sm\">تلقي تنبيهات فورية عبر Telegram</p>\n        </div>\n        <Badge \n          variant={isConnected ? \"default\" : \"secondary\"}\n          className={isConnected ? \"bg-success text-success-foreground\" : \"\"}\n        >\n          {isConnected ? \"متصل\" : \"غير متصل\"}\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-telegram-connect\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Send className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">ربط Telegram</CardTitle>\n            </div>\n            <CardDescription>\n              {isConnected \n                ? \"حسابك متصل بـ Telegram\" \n                : \"قم بربط حساب Telegram لتلقي الإشعارات\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {!isConnected ? (\n              <>\n                <div className=\"p-4 bg-muted rounded-md space-y-3\">\n                  <p className=\"text-sm font-medium\">خطوات الربط:</p>\n                  <ol className=\"text-sm text-muted-foreground space-y-2 list-decimal list-inside\">\n                    <li>افتح تطبيق Telegram</li>\n                    <li>ابحث عن البوت أو اضغط على الرابط أدناه</li>\n                    <li>اضغط على Start للبدء</li>\n                    <li>أرسل الأمر /start للحصول على Chat ID</li>\n                    <li>أدخل Chat ID هنا</li>\n                  </ol>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={copyBotLink}\n                    className=\"flex-1\"\n                    data-testid=\"button-copy-bot-link\"\n                  >\n                    <Copy className=\"w-4 h-4 ml-2\" />\n                    نسخ رابط البوت\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => window.open(`https://t.me/${telegramStatus?.botUsername || \"MexAITraderBot\"}`, \"_blank\")}\n                    data-testid=\"button-open-telegram\"\n                  >\n                    <ExternalLink className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Chat ID</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      type=\"text\"\n                      value={chatId}\n                      onChange={(e) => setChatId(e.target.value)}\n                      placeholder=\"أدخل Chat ID الخاص بك\"\n                      dir=\"ltr\"\n                      className=\"font-mono\"\n                      data-testid=\"input-chat-id\"\n                    />\n                    <Button\n                      onClick={handleSubscribe}\n                      disabled={!chatId.trim() || subscribeMutation.isPending}\n                      data-testid=\"button-subscribe\"\n                    >\n                      {subscribeMutation.isPending ? \"جاري الربط...\" : \"ربط\"}\n                    </Button>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-3 p-4 bg-success/10 border border-success/30 rounded-md\">\n                  <CheckCircle2 className=\"w-5 h-5 text-success\" />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium\">متصل بنجاح</p>\n                    <p className=\"text-xs text-muted-foreground font-mono\" dir=\"ltr\">\n                      Chat ID: {settings?.telegramChatId}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => testMutation.mutate()}\n                    disabled={testMutation.isPending}\n                    className=\"flex-1\"\n                    data-testid=\"button-test-notification\"\n                  >\n                    <Bell className=\"w-4 h-4 ml-2\" />\n                    {testMutation.isPending ? \"جاري الإرسال...\" : \"إرسال إشعار تجريبي\"}\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    onClick={() => unsubscribeMutation.mutate()}\n                    disabled={unsubscribeMutation.isPending}\n                    data-testid=\"button-unsubscribe\"\n                  >\n                    <BellOff className=\"w-4 h-4 ml-2\" />\n                    فصل\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-notification-settings\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Bell className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">أنواع الإشعارات</CardTitle>\n            </div>\n            <CardDescription>اختر الإشعارات التي تريد تلقيها</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">إشعارات التداول</p>\n                  <p className=\"text-xs text-muted-foreground\">صفقات الشراء والبيع</p>\n                </div>\n              </div>\n              <Switch\n                checked={settings?.tradeNotifications ?? true}\n                onCheckedChange={(checked) => handleToggle(\"tradeNotifications\", checked)}\n                disabled={!isConnected || updateSettingsMutation.isPending}\n                data-testid=\"switch-trade-notifications\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Wallet className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">إشعارات الإيداع</p>\n                  <p className=\"text-xs text-muted-foreground\">تأكيد الإيداعات</p>\n                </div>\n              </div>\n              <Switch\n                checked={settings?.depositNotifications ?? true}\n                onCheckedChange={(checked) => handleToggle(\"depositNotifications\", checked)}\n                disabled={!isConnected || updateSettingsMutation.isPending}\n                data-testid=\"switch-deposit-notifications\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Wallet className=\"w-4 h-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm font-medium\">إشعارات السحب</p>\n                  <p className=\"text-xs text-muted-foreground\">تأكيد السحوبات</p>\n                </div>\n              </div>\n              <Switch\n                checked={settings?.withdrawalNotifications ?? true}\n                onCheckedChange={(checked) => handleToggle(\"withdrawalNotifications\", checked)}\n                disabled={!isConnected || updateSettingsMutation.isPending}\n                data-testid=\"switch-withdrawal-notifications\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-3 bg-primary/5 border border-primary/20 rounded-md\">\n              <div className=\"flex items-center gap-2\">\n                <Brain className=\"w-4 h-4 text-primary\" />\n                <div>\n                  <p className=\"text-sm font-medium\">إشعارات الذكاء الاصطناعي</p>\n                  <p className=\"text-xs text-muted-foreground\">تحليلات وتوقعات AI</p>\n                </div>\n              </div>\n              <Switch\n                checked={settings?.aiSignalNotifications ?? true}\n                onCheckedChange={(checked) => handleToggle(\"aiSignalNotifications\", checked)}\n                disabled={!isConnected || updateSettingsMutation.isPending}\n                data-testid=\"switch-ai-notifications\"\n              />\n            </div>\n\n            {!isConnected && (\n              <div className=\"flex items-center gap-2 p-3 bg-warning/10 border border-warning/30 rounded-md\">\n                <XCircle className=\"w-4 h-4 text-warning\" />\n                <p className=\"text-xs text-muted-foreground\">\n                  قم بربط حساب Telegram أولاً لتفعيل الإشعارات\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\" data-testid=\"card-notification-info\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <MessageSquare className=\"w-5 h-5 text-primary\" />\n              <CardTitle className=\"text-lg\">حول الإشعارات</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"p-4 bg-muted/50 rounded-md\">\n                <h4 className=\"font-medium mb-2\">ماذا ستتلقى؟</h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  <li>• تنبيهات فورية عند تنفيذ صفقات جديدة</li>\n                  <li>• إشعارات تأكيد الإيداعات والسحوبات</li>\n                  <li>• تحليلات الذكاء الاصطناعي للسوق</li>\n                  <li>• توقعات وكيل التعلم الآلي</li>\n                </ul>\n              </div>\n              <div className=\"p-4 bg-muted/50 rounded-md\">\n                <h4 className=\"font-medium mb-2\">الخصوصية والأمان</h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  <li>• لا نشارك بياناتك مع أي طرف ثالث</li>\n                  <li>• الإشعارات تُرسل فقط إلى Chat ID الخاص بك</li>\n                  <li>• يمكنك إلغاء الاشتراك في أي وقت</li>\n                  <li>• لا نخزن رسائل Telegram الخاصة بك</li>\n                </ul>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":15705,"size_tokens":null},"server/rl-agent.ts":{"content":"import type { Candle } from \"./smc\";\n\nexport type Action = \"buy\" | \"sell\" | \"hold\";\n\ninterface State {\n  priceChange: number;\n  rsi: number;\n  macdSignal: number;\n  volumeChange: number;\n  trendStrength: number;\n  volatility: number;\n}\n\ninterface Experience {\n  state: State;\n  action: Action;\n  reward: number;\n  nextState: State;\n  done: boolean;\n}\n\ninterface QTable {\n  [stateKey: string]: {\n    buy: number;\n    sell: number;\n    hold: number;\n  };\n}\n\ninterface AgentConfig {\n  learningRate: number;\n  discountFactor: number;\n  explorationRate: number;\n  explorationDecay: number;\n  minExploration: number;\n  batchSize: number;\n  memorySize: number;\n}\n\ninterface TrainingResult {\n  episodeNumber: number;\n  totalReward: number;\n  totalActions: number;\n  buyActions: number;\n  sellActions: number;\n  holdActions: number;\n  startingCapital: number;\n  endingCapital: number;\n  profitLoss: number;\n  profitLossPercent: number;\n  maxDrawdown: number;\n  winRate: number;\n  explorationRate: number;\n}\n\ninterface Prediction {\n  action: Action;\n  confidence: number;\n  qValues: { buy: number; sell: number; hold: number };\n  stateFeatures: State;\n}\n\nfunction calculateRSI(candles: Candle[], period: number = 14): number {\n  if (candles.length < period + 1) return 50;\n\n  let gains = 0;\n  let losses = 0;\n\n  for (let i = candles.length - period; i < candles.length; i++) {\n    const change = candles[i].close - candles[i - 1].close;\n    if (change > 0) {\n      gains += change;\n    } else {\n      losses += Math.abs(change);\n    }\n  }\n\n  const avgGain = gains / period;\n  const avgLoss = losses / period;\n\n  if (avgLoss === 0) return 100;\n  const rs = avgGain / avgLoss;\n  return 100 - 100 / (1 + rs);\n}\n\nfunction calculateMACD(candles: Candle[]): { macd: number; signal: number; histogram: number } {\n  if (candles.length < 26) {\n    return { macd: 0, signal: 0, histogram: 0 };\n  }\n\n  const closes = candles.map((c) => c.close);\n\n  function ema(data: number[], period: number): number {\n    const k = 2 / (period + 1);\n    let emaValue = data.slice(0, period).reduce((a, b) => a + b, 0) / period;\n    for (let i = period; i < data.length; i++) {\n      emaValue = data[i] * k + emaValue * (1 - k);\n    }\n    return emaValue;\n  }\n\n  const ema12 = ema(closes, 12);\n  const ema26 = ema(closes, 26);\n  const macd = ema12 - ema26;\n\n  const macdLine: number[] = [];\n  let ema12Val = closes.slice(0, 12).reduce((a, b) => a + b, 0) / 12;\n  let ema26Val = closes.slice(0, 26).reduce((a, b) => a + b, 0) / 26;\n  const k12 = 2 / 13;\n  const k26 = 2 / 27;\n\n  for (let i = 0; i < closes.length; i++) {\n    if (i >= 12) {\n      ema12Val = closes[i] * k12 + ema12Val * (1 - k12);\n    }\n    if (i >= 26) {\n      ema26Val = closes[i] * k26 + ema26Val * (1 - k26);\n      macdLine.push(ema12Val - ema26Val);\n    }\n  }\n\n  const signal = macdLine.length >= 9 ? ema(macdLine, 9) : 0;\n\n  return { macd, signal, histogram: macd - signal };\n}\n\nfunction calculateVolatility(candles: Candle[], period: number = 14): number {\n  if (candles.length < period) return 0;\n\n  const returns: number[] = [];\n  for (let i = candles.length - period; i < candles.length; i++) {\n    const ret = (candles[i].close - candles[i - 1].close) / candles[i - 1].close;\n    returns.push(ret);\n  }\n\n  const mean = returns.reduce((a, b) => a + b, 0) / returns.length;\n  const variance = returns.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / returns.length;\n  return Math.sqrt(variance) * 100;\n}\n\nfunction calculateTrendStrength(candles: Candle[], period: number = 20): number {\n  if (candles.length < period) return 0;\n\n  const recentCandles = candles.slice(-period);\n  const sma = recentCandles.reduce((sum, c) => sum + c.close, 0) / period;\n  const currentPrice = candles[candles.length - 1].close;\n\n  return ((currentPrice - sma) / sma) * 100;\n}\n\nexport class RLTradingAgent {\n  private qTable: QTable;\n  private config: AgentConfig;\n  private replayMemory: Experience[];\n  private totalEpisodes: number;\n  private totalReward: number;\n\n  constructor(config?: Partial<AgentConfig>, existingQTable?: QTable) {\n    this.config = {\n      learningRate: config?.learningRate ?? 0.001,\n      discountFactor: config?.discountFactor ?? 0.95,\n      explorationRate: config?.explorationRate ?? 0.1,\n      explorationDecay: config?.explorationDecay ?? 0.995,\n      minExploration: config?.minExploration ?? 0.01,\n      batchSize: config?.batchSize ?? 32,\n      memorySize: config?.memorySize ?? 10000,\n    };\n    this.qTable = existingQTable ?? {};\n    this.replayMemory = [];\n    this.totalEpisodes = 0;\n    this.totalReward = 0;\n  }\n\n  extractState(candles: Candle[]): State {\n    if (candles.length < 27) {\n      return {\n        priceChange: 0,\n        rsi: 50,\n        macdSignal: 0,\n        volumeChange: 0,\n        trendStrength: 0,\n        volatility: 0,\n      };\n    }\n\n    const currentPrice = candles[candles.length - 1].close;\n    const prevPrice = candles[candles.length - 2].close;\n    const priceChange = ((currentPrice - prevPrice) / prevPrice) * 100;\n\n    const rsi = calculateRSI(candles);\n    const macd = calculateMACD(candles);\n    const macdSignal = macd.histogram > 0 ? 1 : macd.histogram < 0 ? -1 : 0;\n\n    const currentVolume = candles[candles.length - 1].volume;\n    const prevVolume = candles[candles.length - 2].volume;\n    const volumeChange = prevVolume > 0 ? ((currentVolume - prevVolume) / prevVolume) * 100 : 0;\n\n    const trendStrength = calculateTrendStrength(candles);\n    const volatility = calculateVolatility(candles);\n\n    return {\n      priceChange: Math.max(-10, Math.min(10, priceChange)),\n      rsi,\n      macdSignal,\n      volumeChange: Math.max(-100, Math.min(100, volumeChange)),\n      trendStrength: Math.max(-10, Math.min(10, trendStrength)),\n      volatility: Math.min(10, volatility),\n    };\n  }\n\n  private discretizeState(state: State): string {\n    const priceLevel = Math.floor(state.priceChange / 2);\n    const rsiLevel = Math.floor(state.rsi / 20);\n    const macdLevel = state.macdSignal;\n    const volumeLevel = state.volumeChange > 50 ? 2 : state.volumeChange > -50 ? 1 : 0;\n    const trendLevel = state.trendStrength > 2 ? 2 : state.trendStrength > -2 ? 1 : 0;\n    const volLevel = state.volatility > 5 ? 2 : state.volatility > 2 ? 1 : 0;\n\n    return `${priceLevel}_${rsiLevel}_${macdLevel}_${volumeLevel}_${trendLevel}_${volLevel}`;\n  }\n\n  private getQValues(stateKey: string): { buy: number; sell: number; hold: number } {\n    if (!this.qTable[stateKey]) {\n      this.qTable[stateKey] = { buy: 0, sell: 0, hold: 0 };\n    }\n    return this.qTable[stateKey];\n  }\n\n  selectAction(state: State, explore: boolean = true): Action {\n    const stateKey = this.discretizeState(state);\n    const qValues = this.getQValues(stateKey);\n\n    if (explore && Math.random() < this.config.explorationRate) {\n      const actions: Action[] = [\"buy\", \"sell\", \"hold\"];\n      return actions[Math.floor(Math.random() * actions.length)];\n    }\n\n    if (qValues.buy >= qValues.sell && qValues.buy >= qValues.hold) {\n      return \"buy\";\n    } else if (qValues.sell >= qValues.buy && qValues.sell >= qValues.hold) {\n      return \"sell\";\n    }\n    return \"hold\";\n  }\n\n  predict(candles: Candle[]): Prediction {\n    const state = this.extractState(candles);\n    const stateKey = this.discretizeState(state);\n    const qValues = this.getQValues(stateKey);\n    const action = this.selectAction(state, false);\n\n    const maxQ = Math.max(qValues.buy, qValues.sell, qValues.hold);\n    const sumQ = Math.abs(qValues.buy) + Math.abs(qValues.sell) + Math.abs(qValues.hold);\n    const confidence = sumQ > 0 ? Math.abs(qValues[action]) / sumQ : 0.33;\n\n    return {\n      action,\n      confidence,\n      qValues,\n      stateFeatures: state,\n    };\n  }\n\n  private updateQValue(\n    state: State,\n    action: Action,\n    reward: number,\n    nextState: State\n  ): void {\n    const stateKey = this.discretizeState(state);\n    const nextStateKey = this.discretizeState(nextState);\n\n    const currentQ = this.getQValues(stateKey)[action];\n    const nextQValues = this.getQValues(nextStateKey);\n    const maxNextQ = Math.max(nextQValues.buy, nextQValues.sell, nextQValues.hold);\n\n    const newQ =\n      currentQ +\n      this.config.learningRate *\n        (reward + this.config.discountFactor * maxNextQ - currentQ);\n\n    this.qTable[stateKey][action] = newQ;\n  }\n\n  private addExperience(experience: Experience): void {\n    this.replayMemory.push(experience);\n    if (this.replayMemory.length > this.config.memorySize) {\n      this.replayMemory.shift();\n    }\n  }\n\n  private replayBatch(): void {\n    if (this.replayMemory.length < this.config.batchSize) return;\n\n    const batch: Experience[] = [];\n    for (let i = 0; i < this.config.batchSize; i++) {\n      const idx = Math.floor(Math.random() * this.replayMemory.length);\n      batch.push(this.replayMemory[idx]);\n    }\n\n    for (const experience of batch) {\n      this.updateQValue(\n        experience.state,\n        experience.action,\n        experience.reward,\n        experience.nextState\n      );\n    }\n  }\n\n  train(candles: Candle[], initialCapital: number = 10000): TrainingResult {\n    if (candles.length < 50) {\n      throw new Error(\"Need at least 50 candles for training\");\n    }\n\n    let capital = initialCapital;\n    let position = 0;\n    let entryPrice = 0;\n    let totalReward = 0;\n    let maxCapital = initialCapital;\n    let maxDrawdown = 0;\n    let buyActions = 0;\n    let sellActions = 0;\n    let holdActions = 0;\n    let wins = 0;\n    let trades = 0;\n\n    const windowSize = 30;\n    const actions: { action: Action; profit: number }[] = [];\n\n    for (let i = windowSize; i < candles.length - 1; i++) {\n      const windowCandles = candles.slice(i - windowSize, i + 1);\n      const state = this.extractState(windowCandles);\n      const action = this.selectAction(state, true);\n      const currentPrice = candles[i].close;\n      const nextPrice = candles[i + 1].close;\n\n      let reward = 0;\n      let tradeProfit = 0;\n\n      switch (action) {\n        case \"buy\":\n          buyActions++;\n          if (position === 0) {\n            position = capital / currentPrice;\n            entryPrice = currentPrice;\n            capital = 0;\n          }\n          if (position > 0) {\n            reward = ((nextPrice - currentPrice) / currentPrice) * 100;\n          }\n          break;\n\n        case \"sell\":\n          sellActions++;\n          if (position > 0) {\n            const exitValue = position * currentPrice;\n            tradeProfit = exitValue - position * entryPrice;\n            capital = exitValue;\n            \n            if (tradeProfit > 0) wins++;\n            trades++;\n            \n            position = 0;\n            entryPrice = 0;\n            reward = (tradeProfit / (position > 0 ? position * entryPrice : capital)) * 100;\n          } else {\n            reward = -0.1;\n          }\n          break;\n\n        case \"hold\":\n          holdActions++;\n          if (position > 0) {\n            reward = ((nextPrice - currentPrice) / currentPrice) * 50;\n          } else {\n            reward = -0.05;\n          }\n          break;\n      }\n\n      const currentValue = capital + position * currentPrice;\n      maxCapital = Math.max(maxCapital, currentValue);\n      const drawdown = ((maxCapital - currentValue) / maxCapital) * 100;\n      maxDrawdown = Math.max(maxDrawdown, drawdown);\n\n      totalReward += reward;\n      actions.push({ action, profit: reward });\n\n      const nextWindowCandles = candles.slice(i - windowSize + 1, i + 2);\n      const nextState = this.extractState(nextWindowCandles);\n\n      this.addExperience({\n        state,\n        action,\n        reward,\n        nextState,\n        done: i === candles.length - 2,\n      });\n\n      if (this.replayMemory.length >= this.config.batchSize) {\n        this.replayBatch();\n      }\n    }\n\n    if (position > 0) {\n      capital = position * candles[candles.length - 1].close;\n      position = 0;\n    }\n\n    this.config.explorationRate = Math.max(\n      this.config.minExploration,\n      this.config.explorationRate * this.config.explorationDecay\n    );\n\n    this.totalEpisodes++;\n    this.totalReward += totalReward;\n\n    const profitLoss = capital - initialCapital;\n    const profitLossPercent = (profitLoss / initialCapital) * 100;\n    const winRate = trades > 0 ? (wins / trades) * 100 : 0;\n\n    return {\n      episodeNumber: this.totalEpisodes,\n      totalReward,\n      totalActions: buyActions + sellActions + holdActions,\n      buyActions,\n      sellActions,\n      holdActions,\n      startingCapital: initialCapital,\n      endingCapital: capital,\n      profitLoss,\n      profitLossPercent,\n      maxDrawdown,\n      winRate,\n      explorationRate: this.config.explorationRate,\n    };\n  }\n\n  getQTable(): QTable {\n    return { ...this.qTable };\n  }\n\n  getConfig(): AgentConfig {\n    return { ...this.config };\n  }\n\n  getStats(): {\n    totalEpisodes: number;\n    totalReward: number;\n    avgReward: number;\n    explorationRate: number;\n    statesLearned: number;\n  } {\n    return {\n      totalEpisodes: this.totalEpisodes,\n      totalReward: this.totalReward,\n      avgReward: this.totalEpisodes > 0 ? this.totalReward / this.totalEpisodes : 0,\n      explorationRate: this.config.explorationRate,\n      statesLearned: Object.keys(this.qTable).length,\n    };\n  }\n\n  setConfig(config: Partial<AgentConfig>): void {\n    Object.assign(this.config, config);\n  }\n\n  loadQTable(qTable: QTable): void {\n    this.qTable = { ...qTable };\n  }\n\n  reset(): void {\n    this.qTable = {};\n    this.replayMemory = [];\n    this.totalEpisodes = 0;\n    this.totalReward = 0;\n    this.config.explorationRate = 0.1;\n  }\n}\n\nexport const rlAgentInstances = new Map<string, RLTradingAgent>();\n\nexport function getOrCreateAgent(\n  symbol: string,\n  config?: Partial<AgentConfig>,\n  existingQTable?: QTable\n): RLTradingAgent {\n  const key = symbol.toUpperCase();\n  if (!rlAgentInstances.has(key)) {\n    rlAgentInstances.set(key, new RLTradingAgent(config, existingQTable));\n  }\n  return rlAgentInstances.get(key)!;\n}\n\nexport function resetAgent(symbol: string): void {\n  const key = symbol.toUpperCase();\n  const agent = rlAgentInstances.get(key);\n  if (agent) {\n    agent.reset();\n  }\n}\n","path":null,"size_bytes":14154,"size_tokens":null},"client/src/pages/rl-agent.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  Cpu,\n  Play,\n  RotateCcw,\n  TrendingUp,\n  TrendingDown,\n  Minus,\n  Activity,\n  Target,\n  Zap,\n  Brain,\n  BarChart3,\n  Clock,\n  RefreshCw,\n} from \"lucide-react\";\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  AreaChart,\n  Area,\n} from \"recharts\";\nimport type { RlAgentConfig, RlTrainingEpisode, RlDecision } from \"@shared/schema\";\n\nconst AVAILABLE_SYMBOLS = [\n  \"BTCUSDT\",\n  \"ETHUSDT\",\n  \"BNBUSDT\",\n  \"XRPUSDT\",\n  \"SOLUSDT\",\n  \"ADAUSDT\",\n  \"DOGEUSDT\",\n  \"DOTUSDT\",\n];\n\nexport default function RLAgent() {\n  const { toast } = useToast();\n  const [selectedSymbol, setSelectedSymbol] = useState(\"BTCUSDT\");\n  const [trainEpisodes, setTrainEpisodes] = useState(100);\n  const [initialCapital, setInitialCapital] = useState(10000);\n\n  const { data: agents, isLoading: agentsLoading } = useQuery<RlAgentConfig[]>({\n    queryKey: [\"/api/rl/agents\"],\n  });\n\n  const { data: agentData, isLoading: agentLoading } = useQuery<{\n    config: RlAgentConfig;\n    stats: {\n      totalEpisodes: number;\n      totalReward: number;\n      avgReward: number;\n      explorationRate: number;\n      statesLearned: number;\n    };\n  }>({\n    queryKey: [\"/api/rl/agent\", selectedSymbol],\n    enabled: !!selectedSymbol,\n    retry: false,\n  });\n\n  const { data: episodes } = useQuery<RlTrainingEpisode[]>({\n    queryKey: [\"/api/rl/episodes\", selectedSymbol],\n    enabled: !!selectedSymbol,\n  });\n\n  const { data: decisions } = useQuery<RlDecision[]>({\n    queryKey: [\"/api/rl/decisions\", selectedSymbol],\n    enabled: !!selectedSymbol,\n  });\n\n  const createAgentMutation = useMutation({\n    mutationFn: async (symbol: string) => {\n      return apiRequest(\"POST\", \"/api/rl/agent\", { symbol });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/agents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/agent\", selectedSymbol] });\n      toast({\n        title: \"تم إنشاء الوكيل\",\n        description: `تم إنشاء وكيل التعلم الآلي لـ ${selectedSymbol}`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في إنشاء الوكيل\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const trainMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/rl/train/${selectedSymbol}`, {\n        episodes: trainEpisodes,\n        initialCapital,\n      });\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/agent\", selectedSymbol] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/episodes\", selectedSymbol] });\n      toast({\n        title: \"اكتمل التدريب\",\n        description: `تم تدريب الوكيل على ${data.trainingResults?.length || trainEpisodes} حلقة`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في التدريب\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const predictMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/rl/predict/${selectedSymbol}`, {});\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/decisions\", selectedSymbol] });\n      const actionLabels: Record<string, string> = {\n        buy: \"شراء\",\n        sell: \"بيع\",\n        hold: \"انتظار\",\n      };\n      toast({\n        title: \"توقع جديد\",\n        description: `التوصية: ${actionLabels[data.decision?.action] || data.decision?.action} بثقة ${((data.decision?.confidence || 0) * 100).toFixed(1)}%`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في الحصول على توقع\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/rl/reset/${selectedSymbol}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/agent\", selectedSymbol] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/episodes\", selectedSymbol] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/rl/decisions\", selectedSymbol] });\n      toast({\n        title: \"تم إعادة الضبط\",\n        description: \"تم إعادة ضبط الوكيل بنجاح\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"خطأ\",\n        description: \"فشل في إعادة الضبط\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const agentExists = agents?.some((a) => a.symbol === selectedSymbol);\n\n  const episodeChartData =\n    episodes?.map((ep, idx) => ({\n      episode: idx + 1,\n      reward: Number(ep.totalReward) || 0,\n      endingCapital: Number(ep.endingCapital) || 0,\n    })) || [];\n\n  const getActionIcon = (action: string) => {\n    switch (action) {\n      case \"buy\":\n        return <TrendingUp className=\"w-4 h-4 text-green-500\" />;\n      case \"sell\":\n        return <TrendingDown className=\"w-4 h-4 text-red-500\" />;\n      default:\n        return <Minus className=\"w-4 h-4 text-muted-foreground\" />;\n    }\n  };\n\n  const getActionLabel = (action: string) => {\n    switch (action) {\n      case \"buy\":\n        return \"شراء\";\n      case \"sell\":\n        return \"بيع\";\n      default:\n        return \"انتظار\";\n    }\n  };\n\n  const getActionBadgeVariant = (action: string) => {\n    switch (action) {\n      case \"buy\":\n        return \"default\";\n      case \"sell\":\n        return \"destructive\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" dir=\"rtl\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold flex items-center gap-2\" data-testid=\"text-page-title\">\n            <Cpu className=\"w-7 h-7 text-primary\" />\n            وكيل التعلم الآلي\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            نظام تداول ذكي يتعلم من أنماط السوق باستخدام Q-Learning\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <Select value={selectedSymbol} onValueChange={setSelectedSymbol}>\n            <SelectTrigger className=\"w-40\" data-testid=\"select-symbol\">\n              <SelectValue placeholder=\"اختر العملة\" />\n            </SelectTrigger>\n            <SelectContent>\n              {AVAILABLE_SYMBOLS.map((symbol) => (\n                <SelectItem key={symbol} value={symbol}>\n                  {symbol}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          {!agentExists && (\n            <Button\n              onClick={() => createAgentMutation.mutate(selectedSymbol)}\n              disabled={createAgentMutation.isPending}\n              data-testid=\"button-create-agent\"\n            >\n              <Zap className=\"w-4 h-4 ml-2\" />\n              إنشاء وكيل\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {agentLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <RefreshCw className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n        </div>\n      ) : agentData?.config ? (\n        <>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  حلقات التدريب\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center gap-2\">\n                  <Activity className=\"w-5 h-5 text-primary\" />\n                  <span className=\"text-2xl font-bold\" data-testid=\"text-total-episodes\">\n                    {agentData.stats?.totalEpisodes ?? 0}\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  متوسط المكافأة\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center gap-2\">\n                  <Target className=\"w-5 h-5 text-primary\" />\n                  <span className=\"text-2xl font-bold\" data-testid=\"text-avg-reward\">\n                    {(agentData.stats?.avgReward ?? 0).toFixed(2)}\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  إجمالي المكافأة\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"w-5 h-5 text-green-500\" />\n                  <span className=\"text-2xl font-bold\" data-testid=\"text-total-reward\">\n                    {(agentData.stats?.totalReward ?? 0).toFixed(2)}\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  معدل الاستكشاف\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center gap-2\">\n                  <Brain className=\"w-5 h-5 text-primary\" />\n                  <span className=\"text-2xl font-bold\" data-testid=\"text-exploration-rate\">\n                    {((agentData.stats?.explorationRate ?? 0) * 100).toFixed(1)}%\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Tabs defaultValue=\"training\" className=\"space-y-4\">\n            <TabsList>\n              <TabsTrigger value=\"training\" data-testid=\"tab-training\">\n                <Play className=\"w-4 h-4 ml-2\" />\n                التدريب\n              </TabsTrigger>\n              <TabsTrigger value=\"history\" data-testid=\"tab-history\">\n                <BarChart3 className=\"w-4 h-4 ml-2\" />\n                سجل التدريب\n              </TabsTrigger>\n              <TabsTrigger value=\"decisions\" data-testid=\"tab-decisions\">\n                <Clock className=\"w-4 h-4 ml-2\" />\n                القرارات\n              </TabsTrigger>\n              <TabsTrigger value=\"config\" data-testid=\"tab-config\">\n                <Cpu className=\"w-4 h-4 ml-2\" />\n                الإعدادات\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"training\" className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Play className=\"w-5 h-5\" />\n                      تدريب الوكيل\n                    </CardTitle>\n                    <CardDescription>\n                      قم بتدريب الوكيل على بيانات السوق الحالية\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>عدد حلقات التدريب</Label>\n                      <div className=\"flex items-center gap-4\">\n                        <Slider\n                          value={[trainEpisodes]}\n                          onValueChange={([val]) => setTrainEpisodes(val)}\n                          min={10}\n                          max={500}\n                          step={10}\n                          className=\"flex-1\"\n                          data-testid=\"slider-episodes\"\n                        />\n                        <Input\n                          type=\"number\"\n                          value={trainEpisodes}\n                          onChange={(e) => setTrainEpisodes(Number(e.target.value))}\n                          className=\"w-20\"\n                          data-testid=\"input-episodes\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>رأس المال الأولي (USDT)</Label>\n                      <Input\n                        type=\"number\"\n                        value={initialCapital}\n                        onChange={(e) => setInitialCapital(Number(e.target.value))}\n                        data-testid=\"input-capital\"\n                      />\n                    </div>\n\n                    <div className=\"flex gap-3 pt-2\">\n                      <Button\n                        onClick={() => trainMutation.mutate()}\n                        disabled={trainMutation.isPending}\n                        className=\"flex-1\"\n                        data-testid=\"button-train\"\n                      >\n                        {trainMutation.isPending ? (\n                          <RefreshCw className=\"w-4 h-4 ml-2 animate-spin\" />\n                        ) : (\n                          <Play className=\"w-4 h-4 ml-2\" />\n                        )}\n                        بدء التدريب\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => resetMutation.mutate()}\n                        disabled={resetMutation.isPending}\n                        data-testid=\"button-reset\"\n                      >\n                        <RotateCcw className=\"w-4 h-4 ml-2\" />\n                        إعادة ضبط\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Target className=\"w-5 h-5\" />\n                      الحصول على توقع\n                    </CardTitle>\n                    <CardDescription>\n                      استخدم الوكيل المدرب للحصول على توصية تداول\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"p-4 rounded-md bg-muted/50 space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-muted-foreground\">العملة</span>\n                        <Badge variant=\"outline\">{selectedSymbol}</Badge>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-muted-foreground\">حالة الوكيل</span>\n                        <Badge variant={(agentData.stats?.totalEpisodes ?? 0) > 0 ? \"default\" : \"secondary\"}>\n                          {(agentData.stats?.totalEpisodes ?? 0) > 0 ? \"مُدرَّب\" : \"غير مُدرَّب\"}\n                        </Badge>\n                      </div>\n                      {decisions && decisions.length > 0 && (\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-muted-foreground\">آخر توصية</span>\n                          <div className=\"flex items-center gap-2\">\n                            {getActionIcon(decisions[0].action)}\n                            <Badge variant={getActionBadgeVariant(decisions[0].action)}>\n                              {getActionLabel(decisions[0].action)}\n                            </Badge>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    <Button\n                      onClick={() => predictMutation.mutate()}\n                      disabled={predictMutation.isPending || (agentData.stats?.totalEpisodes ?? 0) === 0}\n                      className=\"w-full\"\n                      data-testid=\"button-predict\"\n                    >\n                      {predictMutation.isPending ? (\n                        <RefreshCw className=\"w-4 h-4 ml-2 animate-spin\" />\n                      ) : (\n                        <Zap className=\"w-4 h-4 ml-2\" />\n                      )}\n                      الحصول على توقع\n                    </Button>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"history\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <BarChart3 className=\"w-5 h-5\" />\n                    سجل التدريب\n                  </CardTitle>\n                  <CardDescription>\n                    أداء الوكيل عبر حلقات التدريب المختلفة\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {episodeChartData.length > 0 ? (\n                    <div className=\"h-80\">\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <AreaChart data={episodeChartData}>\n                          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                          <XAxis\n                            dataKey=\"episode\"\n                            tick={{ fontSize: 12 }}\n                            className=\"text-muted-foreground\"\n                          />\n                          <YAxis tick={{ fontSize: 12 }} className=\"text-muted-foreground\" />\n                          <Tooltip\n                            contentStyle={{\n                              backgroundColor: \"hsl(var(--card))\",\n                              border: \"1px solid hsl(var(--border))\",\n                              borderRadius: \"8px\",\n                            }}\n                            labelFormatter={(val) => `الحلقة ${val}`}\n                          />\n                          <Area\n                            type=\"monotone\"\n                            dataKey=\"reward\"\n                            name=\"المكافأة\"\n                            stroke=\"hsl(var(--primary))\"\n                            fill=\"hsl(var(--primary) / 0.2)\"\n                          />\n                        </AreaChart>\n                      </ResponsiveContainer>\n                    </div>\n                  ) : (\n                    <div className=\"h-80 flex items-center justify-center text-muted-foreground\">\n                      لا توجد بيانات تدريب بعد\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"decisions\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Clock className=\"w-5 h-5\" />\n                    سجل القرارات\n                  </CardTitle>\n                  <CardDescription>القرارات التي اتخذها الوكيل</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {decisions && decisions.length > 0 ? (\n                    <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                      {decisions.slice(0, 20).map((decision, idx) => (\n                        <div\n                          key={decision.id}\n                          className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\"\n                          data-testid={`decision-row-${idx}`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            {getActionIcon(decision.action)}\n                            <div>\n                              <div className=\"font-medium\">\n                                {getActionLabel(decision.action)}\n                              </div>\n                              <div className=\"text-xs text-muted-foreground\">\n                                {decision.createdAt ? new Date(decision.createdAt).toLocaleString(\"ar-SA\") : \"-\"}\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"text-left\">\n                            <Badge variant=\"outline\">\n                              ثقة: {((Number(decision.confidence) || 0) * 100).toFixed(1)}%\n                            </Badge>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"py-12 text-center text-muted-foreground\">\n                      لا توجد قرارات بعد\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"config\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Cpu className=\"w-5 h-5\" />\n                    إعدادات الوكيل\n                  </CardTitle>\n                  <CardDescription>معاملات خوارزمية Q-Learning</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">معدل التعلم</span>\n                        <span className=\"font-mono font-medium\" data-testid=\"text-learning-rate\">\n                          {(Number(agentData.config?.learningRate) || 0.001).toFixed(4)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">معامل الخصم</span>\n                        <span className=\"font-mono font-medium\" data-testid=\"text-discount-factor\">\n                          {(Number(agentData.config?.discountFactor) || 0.95).toFixed(4)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">معدل الاستكشاف</span>\n                        <span className=\"font-mono font-medium\">\n                          {(Number(agentData.config?.explorationRate) || 0.1).toFixed(4)}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">انحلال الاستكشاف</span>\n                        <span className=\"font-mono font-medium\" data-testid=\"text-exploration-decay\">\n                          {(Number(agentData.config?.explorationDecay) || 0.995).toFixed(4)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">الحد الأدنى للاستكشاف</span>\n                        <span className=\"font-mono font-medium\" data-testid=\"text-min-exploration\">\n                          {(Number(agentData.config?.minExploration) || 0.01).toFixed(4)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\">\n                        <span className=\"text-muted-foreground\">حالة الوكيل</span>\n                        <Badge variant={agentData.config?.isActive ? \"default\" : \"secondary\"}>\n                          {agentData.config?.isActive ? \"نشط\" : \"غير نشط\"}\n                        </Badge>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </>\n      ) : (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Cpu className=\"w-16 h-16 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-medium mb-2\">لا يوجد وكيل لـ {selectedSymbol}</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              قم بإنشاء وكيل تعلم آلي جديد للبدء في التدريب والتداول\n            </p>\n            <Button\n              onClick={() => createAgentMutation.mutate(selectedSymbol)}\n              disabled={createAgentMutation.isPending}\n              data-testid=\"button-create-agent-empty\"\n            >\n              <Zap className=\"w-4 h-4 ml-2\" />\n              إنشاء وكيل جديد\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":26353,"size_tokens":null}},"version":2}